<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">

  <head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta charset="utf-8">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  <!-- Enable responsiveness on mobile devices-->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>
    
      Doohyun Kim &middot; Blog
    
  </title>
  <!-- meta -->
  <link rel="author" href="https://plus.google.com/u/0/+sglee"/>
  <meta name="description" content="이성관 블로그">
  <meta name="naver-site-verification" content="589ef55a64f45cb4651dbf19ef610ca67fa3bdab"/>

  <!-- meta for facebook -->
  <meta property="og:url" content="http://localhost:4000/categories/dev/"/>
  <meta property="og:image" content="https://s3-us-west-2.amazonaws.com/sg-rails-sample-app/main.jpg"/>
  <meta property="og:description" content="이성관 블로그">

  <!-- CSS theme -->
  <!-- <link rel="stylesheet"  href="/css/poole.css"> -->
  <link rel="stylesheet" href="/css/syntax.css">
  <link rel="stylesheet" href="/css/lanyon.css">
  <link rel="stylesheet" href="http://fonts.googleapis.com/css?family=PT+Serif:400,400italic,700|PT+Sans:400">
  <!-- CSS custom -->
  <link rel="stylesheet" href="/css/style.css">

  <!-- Icons -->
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/public/apple-touch-icon-144-precomposed.png">
  <link rel="shortcut icon" href="/public/favicon.ico">

  <!-- RSS -->
  <link rel="alternate" type="application/rss+xml" title="RSS" href="/feed.xml">

  <!-- Google Analytics Tag -->
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-47572822-3', 'auto');
    ga('send', 'pageview');

  </script>

  <!-- bootstrap -->
  <!-- <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous"> -->
  <!-- <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script> -->
</head>


  <body>

    <!-- Wrap is the content to shift when toggling the sidebar. We wrap the
         content to avoid any CSS collisions with our real content. -->
    <div class="wrap">
      <div class="masthead">
        <div class="container">
          <!-- <label for="sidebar-checkbox" class="sidebar-toggle"></label> -->

          <h3 class="masthead-title">
            <a href="/" title="Home">Doohyun Kim</a>
            <!-- <small>Blog</small> -->
          </h3>
          <div class="search-box">
            <form action="/search" method="get">
              <input type="text" id="search-box" name="query" placeholder="search">
            </form>
          </div>
          <div class="pull-right category-box">
            <a href="/about" class="category-menu"><small>ABOUT</small></a>
            <!-- <a href="/categories/dev" class="category-menu"><small>DEV</small></a> -->
            <!-- <a href="/categories/biz" class="category-menu"><small>BIZ</small></a> -->
            <a href="/categories/algorithm" class="category-menu"><small>ALROGITHM</small></a>
            <a href="/categories/database" class="category-menu"><small>DATABASE</small></a>
            <a href="/categories/frontend" class="category-menu"><small>FRONTEND</small></a>
            <a href="/categories/backend" class="category-menu"><small>BACKEND</small></a>
            <a href="/categories/growth" class="category-menu"><small>GROWTH</small></a>
          </div>
        </div>
      </div>

      <div class="container content">
        







  <div class="posts post-list">
  
    <div class="category">
      <a href="#aws">AWS (1)</a>
    </div>
    
      <div class="post">
        <h4 class="post-title">
          <a href="/dev/aws/2018/05/27/copy-aws-rds-pg-to-local/">
            AWS RDS를 로컬에 복사하기
          </a>
        </h4>
        <div class="post-description">
          <small><span class="post-date">27 May 2018</span></small>
        </div>
        <!-- <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Change your database RDS instance security group to allow your machine to access it.
Add your ip to the security group to acces the instance via Postgres.
Make a copy of the database using pg_dump
$ pg_dump -h &lt;public dns&gt; -U &lt;my username&gt; -f &lt;name of dump file .sql&gt; &lt;name of my database&gt;
you will be asked for postgressql password.
a dump file(.sql) will be created
Restore that dump file to your local database.
but you might need to drop the database and create it first
$ psql -U &lt;postgresql username&gt; -d &lt;database name&gt; -f &lt;dump file that you want to restore&gt;
the database is restored
pg_restore -h &lt;host&gt; -U &lt;username&gt; -c -d &lt;database name&gt; &lt;filename to be restored&gt;
</code></pre></div></div>

<p><a href="https://gist.github.com/syafiqfaiz/5273cd41df6f08fdedeb96e12af70e3b">solution credit</a></p>

 -->
      </div>
    
  
    <div class="category">
      <a href="#bootstrap">BOOTSTRAP (2)</a>
    </div>
    
      <div class="post">
        <h4 class="post-title">
          <a href="/dev/rails/bootstrap/2016/08/21/initial-settings-rails-bootstrap/">
            Rails(레일즈) bootstrap 세팅.
          </a>
        </h4>
        <div class="post-description">
          <small><span class="post-date">21 Aug 2016</span></small>
        </div>
        <!-- <p><a href="https://github.com/twbs/bootstrap-sass">bootstrap-sass</a> gem 초기 세팅 과정이다.</p>

<p><strong>Stylesheets</strong></p>

<ul>
  <li>application.css를 application.scss로 바꾼다.</li>
  <li>application.scss에 추가.</li>
</ul>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby">    <span class="vi">@import</span> <span class="s2">"bootstrap-sprockets"</span><span class="p">;</span>
    <span class="vi">@import</span> <span class="s2">"bootstrap"</span><span class="p">;</span>  
  </code></pre></figure>

<ul>
  <li>application.css에 있었던 require문 제거</li>
</ul>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby">    <span class="o">*=</span> <span class="n">require_self</span>
    <span class="o">*=</span> <span class="n">require_tree</span> <span class="o">.</span>
  </code></pre></figure>

<p><strong>Javascripts</strong></p>

<ul>
  <li>application.js에 추가.</li>
</ul>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby">    <span class="sr">//</span><span class="o">=</span> <span class="nb">require</span> <span class="n">jquery</span>
    <span class="sr">//</span><span class="o">=</span> <span class="nb">require</span> <span class="n">bootstrap</span><span class="o">-</span><span class="n">sprockets</span>
  </code></pre></figure>
 -->
      </div>
    
      <div class="post">
        <h4 class="post-title">
          <a href="/dev/bootstrap/2016/07/24/bootrap-collapse/">
            Bootstrap collapse의 event handler 사용하기
          </a>
        </h4>
        <div class="post-description">
          <small><span class="post-date">24 Jul 2016</span></small>
        </div>
        <!-- <p>우선 만든것을 먼저 보여드린다.</p>

<p>감춰진 상태
<img src="/assets/collapse1.png" alt="collapsed" /></p>

<p>펼쳐진 상태
<img src="/assets/collapse2.png" alt="expanded" /></p>

<p>bootstrap collapse에서 저 화살표를 만들어주지 않는다.
대신에 감춰지거나, 펼쳐질 때 event handler를 제공한다.</p>

<p>bootstrap 2와 bootstrap 3의 event 이름이 달라졌다.
저 처럼 bootstrap3 이용하면서 bootstrap 2 manual 보는 사람이 없기를…</p>

<figure class="highlight"><pre><code class="language-js" data-lang="js">  <span class="nx">$</span><span class="p">(</span><span class="s1">'.collapse'</span><span class="p">).</span><span class="nx">on</span><span class="p">(</span><span class="s1">'show.bs.collapse'</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
      <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">siblings</span><span class="p">(</span><span class="s2">"a"</span><span class="p">).</span><span class="nx">find</span><span class="p">(</span><span class="s2">"h4 &gt; i"</span><span class="p">).</span><span class="nx">removeClass</span><span class="p">(</span><span class="s2">"fa-angle-right"</span><span class="p">).</span><span class="nx">addClass</span><span class="p">(</span><span class="s2">"fa-angle-down"</span><span class="p">);</span>
  <span class="p">});</span>
  <span class="nx">$</span><span class="p">(</span><span class="s1">'.collapse'</span><span class="p">).</span><span class="nx">on</span><span class="p">(</span><span class="s1">'hidden.bs.collapse'</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
      <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">siblings</span><span class="p">(</span><span class="s2">"a"</span><span class="p">).</span><span class="nx">find</span><span class="p">(</span><span class="s2">"h4 &gt; i"</span><span class="p">).</span><span class="nx">removeClass</span><span class="p">(</span><span class="s2">"fa-angle-down"</span><span class="p">).</span><span class="nx">addClass</span><span class="p">(</span><span class="s2">"fa-angle-right"</span><span class="p">);</span>
  <span class="p">});</span></code></pre></figure>

<p><code class="highlighter-rouge">siglings("a")</code>로 collapse되지 않는 부분을 찾고, <code class="highlighter-rouge">find("h4 &gt; i")</code>로 fond awsome의 i tag를 선택한다.
i tag의 class를 바꿔주면 화살표가 바뀌게 된다.</p>

<p>보여줄 때는 화살표가 먼저 바뀌고 보여지는게 왠지 익숙하고, 감춰질 때는 감춰지고 난 뒤에 화살표가 바뀌는게 익숙하다.
(왜 그런지는.. 잘 모르겠지만)</p>

<p><code class="highlighter-rouge">show</code>, <code class="highlighter-rouge">hide</code> 는 animation을 기다리지 않고 바로 전달되는 event이고, <code class="highlighter-rouge">shown</code>, <code class="highlighter-rouge">hidden</code>은 animation이 다 완료된 이후에 전달되는 event이다.</p>

<p>적절하게 <code class="highlighter-rouge">show</code>와 <code class="highlighter-rouge">hidden</code> event를 사용했다.</p>

<hr />
<p><small>Google it!</small></p>

<p><small>bootstrap 3 collapse</small><br />
<small>jquery addClass</small></p>

 -->
      </div>
    
  
    <div class="category">
      <a href="#css">CSS (1)</a>
    </div>
    
      <div class="post">
        <h4 class="post-title">
          <a href="/dev/css/2016/11/03/remove-webkit-padding-start/">
            webkit-pading-start 제거하기
          </a>
        </h4>
        <div class="post-description">
          <small><span class="post-date">03 Nov 2016</span></small>
        </div>
        <!-- <h3 id="solution">Solution</h3>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>* {
    margin: 0;
    padding: 0;
}
</code></pre></div></div>

<hr />

<p>all credit : <a href="http://stackoverflow.com/questions/29307357/get-rid-of-webkit-padding-start-40px">http://stackoverflow.com/questions/29307357/get-rid-of-webkit-padding-start-40px</a></p>
 -->
      </div>
    
  
    <div class="category">
      <a href="#eslint">ESLINT (1)</a>
    </div>
    
      <div class="post">
        <h4 class="post-title">
          <a href="/dev/react/eslint/vscode/2019/05/09/eslint-setup/">
            React + ESLint + VSCode
          </a>
        </h4>
        <div class="post-description">
          <small><span class="post-date">09 May 2019</span></small>
        </div>
        <!-- <h2 id="vscode-eslint-설치">VSCode eslint 설치</h2>

<ul>
  <li>command + shift + p</li>
  <li>Install Extensions</li>
  <li>Search ‘ESLint’</li>
  <li>Click Install</li>
</ul>

<h2 id="저장시-eslint-자동-고침-설정">저장시 eslint 자동 고침 설정</h2>

<ul>
  <li>command + ,</li>
  <li>Search ‘ESLint’</li>
  <li>Turn on auto fix on save</li>
</ul>

<h2 id="eslint-config-airbnb-적용">eslint-config-airbnb 적용</h2>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>// Package 확인
npm info "eslint-config-airbnb@latest" peerDependencies
// with CRA v2.0
npm install eslint-config-airbnb --save
// without CRA
npx install-peerdeps --dev eslint-config-airbnb
</code></pre></div></div>

<h2 id="eslint-config-prettier-적용">eslint-config-prettier 적용</h2>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>npm install eslint-config-prettier --save
</code></pre></div></div>

<p><code class="highlighter-rouge">.eslintrc</code></p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  extends: [
    prettier
  ]
</code></pre></div></div>

<h2 id="eslint-config">eslint config</h2>

<p><code class="highlighter-rouge">.eslintrc</code> 파일 생성</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>module.exports = {
  env: {
    browser: true,
    es6: true,
    jest: true
  },
  extends: [
    "eslint:recommended",
    "plugin:react/recommended",
    "airbnb",
    "prettier",
    "prettier/babel",
    "prettier/react",
    "prettier/standard",
    "prettier/unicorn",
    "prettier/vue"
  ],
  globals: {
    Atomics: "readonly",
    SharedArrayBuffer: "readonly"
  },
  parser: "babel-eslint",
  parserOptions: {
    ecmaFeatures: {
      jsx: true
    },
    ecmaVersion: 2018,
    sourceType: "module"
  },
  plugins: ["react"],
  rules: {
    "react/prefer-stateless-function": 0,
    "import/no-named-as-default": 0,
    "react/jsx-filename-extension": 0,
    "import/no-extraneous-dependencies": [2, { devDependencies: true }]
  }
};

</code></pre></div></div>

<h2 id="특정-lint-rule-제거하기">특정 lint rule 제거하기</h2>

<p><code class="highlighter-rouge">.eslintrc</code></p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code> rules: {
    "react/prefer-stateless-function": 0,
 }
</code></pre></div></div>

<h2 id="dev-save-module-이-project-외부에-있다고-나올-때">dev save module 이 project 외부에 있다고 나올 때</h2>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  rules: {
    "import/no-extraneous-dependencies": [2, { devDependencies: true }]
  }
</code></pre></div></div>

<h2 id="jest-사용시-it-이-undefined-로-나올-때">Jest 사용시, ‘it’ 이 undefined 로 나올 때</h2>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  env: {
    jest: true
  },
</code></pre></div></div>

<h2 id="document-undefined">document undefined</h2>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  env: {
    browser: true
  }
</code></pre></div></div>

<hr />

<p>credit : <a href="https://velog.io/@velopert/eslint-and-prettier-in-react">Velopert-리액트 프로젝트에 ESLint 와 Prettier 끼얹기</a></p>
 -->
      </div>
    
  
    <div class="category">
      <a href="#git">GIT (3)</a>
    </div>
    
      <div class="post">
        <h4 class="post-title">
          <a href="/dev/git/2017/01/18/git-pull-remote-branch/">
            Git - Remote branch로 local branch 만들기
          </a>
        </h4>
        <div class="post-description">
          <small><span class="post-date">18 Jan 2017</span></small>
        </div>
        <!-- <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git pull
git checkout -b remote_branch origin/remote_branch
</code></pre></div></div>

<hr />
 -->
      </div>
    
      <div class="post">
        <h4 class="post-title">
          <a href="/dev/git/2016/12/23/git-merge-vs-rebase/">
            Git - merge vs. rebase
          </a>
        </h4>
        <div class="post-description">
          <small><span class="post-date">23 Dec 2016</span></small>
        </div>
        <!-- <h3 id="rebase">Rebase</h3>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git checkout feature
git rebase master
</code></pre></div></div>

<p><img src="https://www.atlassian.com/git/images/tutorials/advanced/merging-vs-rebasing/03.svg" alt="git rebase" /></p>

<h3 id="merge">Merge</h3>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git merge master feature
</code></pre></div></div>

<p><img src="https://www.atlassian.com/git/images/tutorials/advanced/merging-vs-rebasing/02.svg" alt="git merge" /></p>

<hr />
<p><a href="https://www.atlassian.com/git/tutorials/merging-vs-rebasing">from git tutorial</a></p>

 -->
      </div>
    
      <div class="post">
        <h4 class="post-title">
          <a href="/dev/git/2016/08/19/git-remove-staging-files/">
            git local strorage에 staging 파일을 제거.
          </a>
        </h4>
        <div class="post-description">
          <small><span class="post-date">19 Aug 2016</span></small>
        </div>
        <!-- <ul>
  <li><code class="highlighter-rouge">git rm --cached &lt;file_name&gt;</code></li>
  <li>directory인경우 <code class="highlighter-rouge">-r</code> 옵션을 사용
    <ul>
      <li><code class="highlighter-rouge">git rm -r --cached &lt;directory_name&gt;</code></li>
    </ul>
  </li>
</ul>

<hr />

<p><a href="http://clubmate.fi/git-removing-files-from-the-staging-area-and-the-tree/">Clubmate.fi</a></p>
 -->
      </div>
    
  
    <div class="category">
      <a href="#google analytics">GOOGLE ANALYTICS (2)</a>
    </div>
    
      <div class="post">
        <h4 class="post-title">
          <a href="/dev/google%20analytics/2016/12/19/prevent-ghost-spam-in-google-analytics/">
            .xyz 때문에 짜증이 나신다면 - GA에서 스팸제거하기
          </a>
        </h4>
        <div class="post-description">
          <small><span class="post-date">19 Dec 2016</span></small>
        </div>
        <!-- <h3 id="ghost-spam">Ghost Spam</h3>

<p>주로 referral report에 나타나는 스팸성 트래픽은 랜덤하게 Google anlaytics(GA) ID를 만들어서 트래픽을 보낸다.
주요 목적은 GA 담당자가 보고서에 나온 트래픽을 보고 해당 사이트에 방문하도록 만드는 것이다.</p>

<p>스패머는 랜덤하게 만들어진 GA ID를 사용하기 때문에, 해당 ID를 사용하는 사이트가 어떤 사이트인지 모른다.
그래서 hostname이 정해져있지 않거나, 유명한 사이트의 도메인으로 채워넣곤 한다.
Referral report에서 2nd dimension을 hostname으로 놓고 보면, 스팸여부를 확인할 수 있다.</p>

<p><img src="/public/2016-12-19/xyz_spam.png" alt="구글 애널리틱스 추천 리포트 고스트 스팸 (google analytics referral report - ghost spam)" /></p>

<p class="center">[결국 모든 referral 트래픽이 다 스팸 트래픽..]</p>

<p><br /></p>

<h3 id="filter-to-prevent-ghost-spam">Filter to prevent ghost spam</h3>

<p>whitelist 형태의 filter를 이용해서 유효한 hostname을 가진 트래픽만 GA에서 받아들이도록 하면
하나의 filter로 ghost spam traffic을 모두 차단 할 수 있다.</p>

<p><code class="highlighter-rouge">Audience &gt; Technology &gt; Network</code> 에서 Primary dimension을 hostname으로 설정하면, GA로 들어온 모든 트래픽의 hostname을 확인할 수 있다.</p>

<p>여기서 자기 소유의 도메인과 관련된 hostname, 결제관련 서비스의 hostname, 번역서비스의 hostname 등을 확인한다.</p>

<p><img src="/public/2016-12-19/hostname.png" alt="구글 애널리틱스 호스트명 확인 (google analytics check host name)" /></p>

<p><br /></p>

<p>이제 필터를 만들 차례다.</p>

<p><code class="highlighter-rouge">Admin &gt; Filters &gt; Add filter</code></p>

<p>Custom을 선택하고, Include를 선택한다. 앞서 말했듯이 이 필터는 whitelist필터이다. 허용한 traffic만 들어온다. 오타에 주의하자.</p>

<p>Filter field를 hostname으로 설정하고</p>

<p>아래 filter pattern에 앞서 확인한 hostname을 적어준다.</p>

<p><img src="/public/2016-12-19/filter.png" alt="구글 애널리틱스 스팸 필터 - Google analytics ghost spam filter" /></p>

<p>만약 확인한 hostname이 “www.example.com”, “example.com” 이었다면 아래와 같이 정규표현식으로 적어주어야 한다.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>www\.example\.com|example\.com
</code></pre></div></div>

<p>hostname사이에  | 이 표시를 꼭 넣어줘야 한다. 
CS쪽 지식이 있는 사람이라면 단번에 or 연산자라는 걸 알것이다.</p>

<p>주의해야 할 것은 hostname사이에 빈칸이 들어가서는 안된다. 다른 hostname으로 인식하더라.</p>

<hr />

<p><a href="https://moz.com/blog/stop-ghost-spam-in-google-analytics-with-one-filter">reference - moz blog</a></p>

 -->
      </div>
    
      <div class="post">
        <h4 class="post-title">
          <a href="/dev/rails/google%20analytics/2016/09/09/turbolinks-google-analytics/">
            Turbolinks & Google analytics
          </a>
        </h4>
        <div class="post-description">
          <small><span class="post-date">09 Sep 2016</span></small>
        </div>
        <!-- <p>Turbolink는 AJAX로 <code class="highlighter-rouge">&lt;body&gt;</code> tag내 컨텐츠만 바꿔서 page loading time을 줄여준다.
GA는 page load시 마다 서버로 pageview 데이터를 전달하기 때문에 Turbolink를 사용하면 ajax로 이동한 page에 대해서는 GA로 분석 할 수 없다.</p>

<p><code class="highlighter-rouge">turbolinks:load</code> 이벤트가 발생될 때 마다 GA로 pageview를 보내는 javascript code를 추가해서 해결할 수 있다.</p>

<p>application.html.erb</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;head&gt;
  &lt;%= render 'layouts/google_analytics' %&gt;
&lt;/head&gt;
</code></pre></div></div>

<p>laytouts/_google_analytics.html.erb</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="o">&lt;%</span> <span class="k">if</span> <span class="nx">Rails</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">production</span><span class="p">?</span> <span class="o">%&gt;</span>
  <span class="o">&lt;</span><span class="nx">script</span><span class="o">&gt;</span>
    <span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">i</span><span class="p">,</span><span class="nx">s</span><span class="p">,</span><span class="nx">o</span><span class="p">,</span><span class="nx">g</span><span class="p">,</span><span class="nx">r</span><span class="p">,</span><span class="nx">a</span><span class="p">,</span><span class="nx">m</span><span class="p">){</span><span class="nx">i</span><span class="p">[</span><span class="s1">'GoogleAnalyticsObject'</span><span class="p">]</span><span class="o">=</span><span class="nx">r</span><span class="p">;</span><span class="nx">i</span><span class="p">[</span><span class="nx">r</span><span class="p">]</span><span class="o">=</span><span class="nx">i</span><span class="p">[</span><span class="nx">r</span><span class="p">]</span><span class="o">||</span><span class="kd">function</span><span class="p">(){</span>
    <span class="p">(</span><span class="nx">i</span><span class="p">[</span><span class="nx">r</span><span class="p">].</span><span class="nx">q</span><span class="o">=</span><span class="nx">i</span><span class="p">[</span><span class="nx">r</span><span class="p">].</span><span class="nx">q</span><span class="o">||</span><span class="p">[]).</span><span class="nx">push</span><span class="p">(</span><span class="kr">arguments</span><span class="p">)},</span><span class="nx">i</span><span class="p">[</span><span class="nx">r</span><span class="p">].</span><span class="nx">l</span><span class="o">=</span><span class="mi">1</span><span class="o">*</span><span class="k">new</span> <span class="nb">Date</span><span class="p">();</span><span class="nx">a</span><span class="o">=</span><span class="nx">s</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="nx">o</span><span class="p">),</span>
    <span class="nx">m</span><span class="o">=</span><span class="nx">s</span><span class="p">.</span><span class="nx">getElementsByTagName</span><span class="p">(</span><span class="nx">o</span><span class="p">)[</span><span class="mi">0</span><span class="p">];</span><span class="nx">a</span><span class="p">.</span><span class="k">async</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span><span class="nx">a</span><span class="p">.</span><span class="nx">src</span><span class="o">=</span><span class="nx">g</span><span class="p">;</span><span class="nx">m</span><span class="p">.</span><span class="nx">parentNode</span><span class="p">.</span><span class="nx">insertBefore</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span><span class="nx">m</span><span class="p">)</span>
    <span class="p">})(</span><span class="nb">window</span><span class="p">,</span><span class="nb">document</span><span class="p">,</span><span class="s1">'script'</span><span class="p">,</span><span class="s1">'https://www.google-analytics.com/analytics.js'</span><span class="p">,</span><span class="s1">'ga'</span><span class="p">);</span>

    <span class="nx">ga</span><span class="p">(</span><span class="s1">'create'</span><span class="p">,</span> <span class="s1">'XX-XXXXXXXX-X'</span><span class="p">,</span> <span class="s1">'auto'</span><span class="p">);</span>
    <span class="nx">ga</span><span class="p">(</span><span class="s1">'send'</span><span class="p">,</span> <span class="s1">'pageview'</span><span class="p">);</span>
  <span class="o">&lt;</span><span class="sr">/script</span><span class="err">&gt;
</span>
<span class="o">&lt;%</span> <span class="k">else</span> <span class="o">%&gt;</span>
  <span class="o">&lt;</span><span class="nx">script</span><span class="o">&gt;</span>
    <span class="kd">function</span> <span class="nx">ga</span> <span class="p">()</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">params</span> <span class="o">=</span> <span class="nb">Array</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">slice</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="kr">arguments</span><span class="p">,</span> <span class="nx">ga</span><span class="p">.</span><span class="nx">length</span><span class="p">);</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">"GoogleAnalytics: "</span> <span class="o">+</span> <span class="nx">params</span><span class="p">);</span>
    <span class="p">};</span>
  <span class="o">&lt;</span><span class="sr">/script</span><span class="err">&gt;
</span><span class="o">&lt;%</span> <span class="nx">end</span> <span class="o">%&gt;</span></code></pre></figure>

<p>app/assets/javascripts/google_analytics.js.coffee</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nb">document</span><span class="p">.</span><span class="nx">addEventListener</span> <span class="s2">"turbolinks:load"</span><span class="p">,</span> <span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="o">-&gt;</span>
  <span class="k">if</span> <span class="k">typeof</span> <span class="nx">ga</span> <span class="nx">is</span> <span class="s2">"function"</span>
  <span class="nx">ga</span><span class="p">(</span><span class="s2">"set"</span><span class="p">,</span> <span class="s2">"location"</span><span class="p">,</span> <span class="nx">event</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">url</span><span class="p">)</span>
  <span class="nx">ga</span><span class="p">(</span><span class="s2">"send"</span><span class="p">,</span> <span class="s2">"pageview"</span><span class="p">)</span></code></pre></figure>

<hr />
<p><a href="https://sheharyar.me/blog/using-google-analytics-in-rails-4-with-turbolinks/">credit: sheharyar</a></p>

<p><a href="http://stackoverflow.com/questions/18945464/rails-4-turbolinks-with-google-analytics/25050377#25050377">credit: scottwb</a></p>
 -->
      </div>
    
  
    <div class="category">
      <a href="#google sheet">GOOGLE SHEET (1)</a>
    </div>
    
      <div class="post">
        <h4 class="post-title">
          <a href="/dev/google%20sheet/2016/12/14/google-sheet-return-blank-cell/">
            Google Sheet - 함수에서 blank cell 반환하기
          </a>
        </h4>
        <div class="post-description">
          <small><span class="post-date">14 Dec 2016</span></small>
        </div>
        <!-- <p>꼼수</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>= iferror(1/0)
</code></pre></div></div>

<p>Error가 발생시 Blank cell return</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>= iferror(operation_you_want, iferror(1/0))
</code></pre></div></div>

<hr />
<p>credit : <a href="http://googledocsforlife.blogspot.kr/2011/08/iferror10-in-spreadsheets.html">http://googledocsforlife.blogspot.kr/2011/08/iferror10-in-spreadsheets.html</a></p>

 -->
      </div>
    
  
    <div class="category">
      <a href="#google-chart">GOOGLE-CHART (1)</a>
    </div>
    
      <div class="post">
        <h4 class="post-title">
          <a href="/dev/google-chart/2018/05/06/google-chart/">
            Google Chart 로 그래프 그리기
          </a>
        </h4>
        <div class="post-description">
          <small><span class="post-date">06 May 2018</span></small>
        </div>
        <!-- <h2 id="gem-google_visualr">Gem ‘google_visualr’</h2>

<p>Google chart를 사용할 수 있는 gem이 여러개 있는데, 그중에 google_visualr를 사용한 이유는 ‘stepped_area_chart’ 같은
새로운 chart를 지원하고 있는 gem이어서 선택하게 되었다.</p>

<p>사용법은 간단한데,</p>
<ol>
  <li>datatable에 data를 넣고</li>
  <li>option을 설정하고</li>
  <li>원하는 차트 class의 object를 만들 때, data_table과 option을 넘겨주고</li>
  <li>view에서는 <code class="highlighter-rouge">render_chart</code>를</li>
</ol>

<controller>

    data_table = GoogleVisualr::DataTable.new
    data_table.new_column('string', 'date')
    data_table.new_column('number', 'rank')

    data_table.add_rows(rows)

    option = {...}

    @chart = GoogleVisualr::Interactive::SteppedAreaChart.new(data_table, option)

    respond_to do |format|
      format.js
    end


<view>
	
	$('.item-ranks__chart').append('&lt;%= j render_chart(@chart, "item-ranks__chart") %&gt;');


---
</view></controller>
 -->
      </div>
    
  
    <div class="category">
      <a href="#heroku">HEROKU (9)</a>
    </div>
    
      <div class="post">
        <h4 class="post-title">
          <a href="/dev/heroku/2017/03/02/heroku-no-app-option/">
            Heroku - app option을 사용하라고 error 발생시
          </a>
        </h4>
        <div class="post-description">
          <small><span class="post-date">02 Mar 2017</span></small>
        </div>
        <!-- <p>heroku cli를 세팅하는 경우에, 다음과 같은 error가 나올 때가 있음.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Run this command from inside an app folder or specify which app to use with --app APP
</code></pre></div></div>

<p>heroku cli는 git remote로 등록된 heroku git repository 주소를 보고 어떤 app인지를 판단함.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&gt; git remote
origin
</code></pre></div></div>

<p>머신을 새로 세팅하는 경우 remote에 heroku가 없어서 app을 지정해 달라는 error를 발생시킴
다음과 같이 remote repository를 등록하면 더 이상 <code class="highlighter-rouge">-app</code> 옵션이 필요없다.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&gt; git remote add heroku YOUR_HEROKU_REPOSITORY
&gt; git remote
origin
remote
</code></pre></div></div>

 -->
      </div>
    
      <div class="post">
        <h4 class="post-title">
          <a href="/dev/rails/heroku/2017/03/01/heroku-rails-migration-when-release/">
            Heroku - Deploy시에 자동으로 migration 하기
          </a>
        </h4>
        <div class="post-description">
          <small><span class="post-date">01 Mar 2017</span></small>
        </div>
        <!-- <p>Profile 을 root directory에 추가</p>

<p>Procfile</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>release: bundle exec rake db:migrate
</code></pre></div></div>

<hr />

<p>all credit [aspiringwebdev.com][1]
[1]: http://aspiringwebdev.com/run-rails-migrations-automatically-on-heroku/</p>
 -->
      </div>
    
      <div class="post">
        <h4 class="post-title">
          <a href="/dev/heroku/2017/02/13/heroku-ssl-lets-encrypted/">
            Heroku SSL 적용 - Let's encrypt CA
          </a>
        </h4>
        <div class="post-description">
          <small><span class="post-date">13 Feb 2017</span></small>
        </div>
        <!-- <h2 id="무료-ssl-certificate">무료 SSL certificate</h2>

<p><a href="https://letsencrypt.org/">let’s encrypt</a> 에서 무료 SSL certificate 을 발급받을 수 있다.</p>

<h2 id="ssl-certificate-발급">SSL certificate 발급</h2>

<p><code class="highlighter-rouge">certbot</code> 을 설치.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>brew install certbot
</code></pre></div></div>

<p><code class="highlighter-rouge">manual</code> 방식으로 cerbot을 실행
이 때 <code class="highlighter-rouge">-d</code> 옵션으로 도메인을 지정할 수 있다.
기본도메인과 함꼐 <code class="highlighter-rouge">www</code> hostname에 대해서도 함께 추가해야, 웹 브라우저에서 비공개 커넥션 에러를 방지 할 수 있다.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sudo certbot certonly --manual -d bebetem.com -d www.bebetem.com
</code></pre></div></div>

<p>로그들</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Saving debug log to /var/log/letsencrypt/letsencrypt.log
-------------------------------------------------------------------------------
You have an existing certificate that contains a portion of the domains you
requested (ref: /etc/letsencrypt/renewal/bebetem.com.conf)

It contains these names: bebetem.com

You requested these names for the new certificate: bebetem.com, www.bebetem.com.

Do you want to expand and replace this existing certificate with the new
certificate?
-------------------------------------------------------------------------------
(E)xpand/(C)ancel: E
Renewing an existing certificate
Performing the following challenges:
http-01 challenge for bebetem.com
http-01 challenge for www.bebetem.com

-------------------------------------------------------------------------------
NOTE: The IP of this machine will be publicly logged as having requested this
certificate. If you're running certbot in manual mode on a machine that is not
your server, please ensure you're okay with that.

Are you OK with your IP being logged?
-------------------------------------------------------------------------------
(Y)es/(N)o: Y

-------------------------------------------------------------------------------
Make sure your web server displays the following content at
http://bebetem.com/.well-known/acme-challenge/R9CHAx3oXTzw0NhYX-YMM2cKgP4hErSy92CUO4HUSRE before continuing:

R9CHAx3oXTzw0NhYX-YMM2cKgP4hErSy92CUO4HUSRE.YOUR_RANDOM_KEY

If you don't have HTTP server configured, you can run the following
command on the target server (as root):

mkdir -p /tmp/certbot/public_html/.well-known/acme-challenge
cd /tmp/certbot/public_html
printf "%s" R9CHAx3oXTzw0NhYX-YMM2cKgP4hErSy92CUO4HUSRE.YOUR_RANDOM_KEY &gt; .well-known/acme-challenge/R9CHAx3oXTzw0NhYX-YMM2cKgP4hErSy92CUO4HUSRE
# run only once per server:
$(command -v python2 || command -v python2.7 || command -v python2.6) -c \
"import BaseHTTPServer, SimpleHTTPServer; \
s = BaseHTTPServer.HTTPServer(('', 80), SimpleHTTPServer.SimpleHTTPRequestHandler); \
s.serve_forever()" 
-------------------------------------------------------------------------------
Press Enter to Continue
</code></pre></div></div>

<p>여기서 잠깐 멈추고.</p>

<p>SSL CA인 lets encrypt가 어떻게 도메인 주인을 확인하냐면,</p>

<p>http://bebetem.com/.well-known/acme-challenge/R9CHAx3oXTzw0NhYX-YMM2cKgP4hErSy92CUO4HUSRE</p>

<p>이 주소로 접근했을 때,</p>

<p>R9CHAx3oXTzw0NhYX-YMM2cKgP4hErSy92CUO4HUSRE.YOUR_RANDOM_KEY</p>

<p>이 값을 받으면 해당 도메인 주인이 SSL certificate을 발급받는게 맞구나 하고 인식한다.</p>

<h2 id="well-known-url-설정">well-known url 설정</h2>

<p>routes.rb</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>get '.well-known/acme-challenge/:id' =&gt; 'static#letsencrypt' 
</code></pre></div></div>

<p>static_controller.rb</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>class StaticController &lt; ApplicationController
def letsencrypt
    render text: "#{params[:id]}.YOUR_RANDOM_KEY"
end
</code></pre></div></div>

<p>heroku에 배포 후 SSL certificate 발급 절차를 다시 진행하면 아래와 같은 log를 확인할 수 있다</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Waiting for verification...
Cleaning up challenges
Generating key (2048 bits): /etc/letsencrypt/keys/0001_key-certbot.pem
Creating CSR: /etc/letsencrypt/csr/0001_csr-certbot.pem

IMPORTANT NOTES:
 - Congratulations! Your certificate and chain have been saved at
   /etc/letsencrypt/live/bebetem.com/fullchain.pem. Your cert will
   expire on 2017-05-14. To obtain a new or tweaked version of this
   certificate in the future, simply run certbot again. To
   non-interactively renew *all* of your certificates, run "certbot
   renew"
 - If you like Certbot, please consider supporting our work by:

   Donating to ISRG / Let's Encrypt:   https://letsencrypt.org/donate
   Donating to EFF:                    https://eff.org/donate-le
</code></pre></div></div>

<h2 id="heroku에-certificate-등록">Heroku에 certificate 등록</h2>

<p>Heroku에서는 paid server를 사용하면 무료로 certificate을 등록할 수 있게 해주고 있다.
free server를 사용하는 경우는 잘 모름.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>heroku certs:add /etc/letsencrypt/live/bebetem.com/fullchain.pem /etc/letsencrypt/live/bebetem.com/privkey.pem
</code></pre></div></div>

<h2 id="dns-변경">DNS 변경</h2>

<p>SSL certificate을 등록하고 나면 herokuapp의 end-point URL이 변경됩니다.
bebetem.herokuapp.com 에서 bebetem.com.herokudns.com으로 변경됨.</p>

<p>사용하는 DNS 서비스를 이용해서 CNAME을 your_app_name.herokuapp.com 에서 your_domain.herokudns.com 으로 변경해주어야 합니다.</p>

<p>dns 변경 확인</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&gt; dig www.bebetem.com +short
www.bebetem.com.herokudns.com
</code></pre></div></div>

<h2 id="issue">Issue</h2>

<h3 id="an-unexpected-error-occurred-attributeerror-entrypoint-object-has-no-attribute-resolve">An unexpected error occurred: AttributeError: ‘EntryPoint’ object has no attribute ‘resolve’</h3>

<p><a href="https://github.com/certbot/certbot/issues/3140#issuecomment-225274500">github issue link</a></p>

<p>brew를 최신버전으로 update 후에 certbot을 다시 설치</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>brew update                 // brew update
brew unlink certbot         // 설치된 certbot의 symbolic link 제거
brew install certbot        // cerbot 재설치
</code></pre></div></div>

<hr />

<p><a href="https://devcenter.heroku.com/articles/ssl#overview">Heroku SSL</a>
<a href="https://wiki.kldp.org/HOWTO/html/SSL-Certificates-HOWTO/x70.html">SSL에 대한 쉬운 설명 - kldp wiki</a>
<a href="https://letsencrypt.org/how-it-works/">Let’s encrypt CA 작동 설명</a>
<a href="https://collectiveidea.com/blog/archives/2016/01/12/lets-encrypt-with-a-rails-app-on-heroku">Rails codes reference - Daniel Morrison</a></p>

 -->
      </div>
    
      <div class="post">
        <h4 class="post-title">
          <a href="/dev/heroku/2017/01/11/heroku-database-upgrade/">
            Heroku database 업그레이드
          </a>
        </h4>
        <div class="post-description">
          <small><span class="post-date">11 Jan 2017</span></small>
        </div>
        <!-- <p>무료버전인 Hobby-Dev에서 $9인 Hobby-Basic 버전으로 변경하는 경우</p>

<p><br /></p>

<h3 id="우선-백업부터">우선 백업부터.</h3>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>heroku pg:backups capture
</code></pre></div></div>

<p><br /></p>

<h3 id="코드">코드.</h3>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>heroku pg:info

    === HEROKU_POSTGRESQL_XXXXXX_URL
    Plan:        Hobby-dev

heroku addons:create heroku-postgresql:hobby-basic

    Created postgresql-xxxxxx-xxxxx as HEROKU_POSTGRESQL_AQUA_URL

heroku maintenance:on
heroku pg:copy HEROKU_POSTGRESQL_XXXXXX_URL HEROKU_POSTGRESQL_AQUA_URL --app your_app_name
heroku pg:promote HEROKU_POSTGRESQL_AQUA_URL
heroku maintenance:off
</code></pre></div></div>

<p><br /></p>

<h3 id="설명">설명.</h3>

<p>a. 사용중인 database url 확인</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>heroku pg:info

    === HEROKU_POSTGRESQL_XXXXXX_URL
    Plan:        Hobby-dev
</code></pre></div></div>

<p><br /></p>

<p>b. 새로운 postgresql add-on 설치</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>heroku addons:create heroku-postgresql:hobby-basic

    Created postgresql-xxxxxx-xxxxx as HEROKU_POSTGRESQL_AQUA_URL
</code></pre></div></div>

<p><br /></p>

<p>c. 데이터베이스 복사 전에 서버점검 모드로 변환</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>heroku maintenance:on
</code></pre></div></div>

<p><br /></p>

<p>d. 이전 데이터베이스를 새로운 데이터베이스로 복사
heroku에서 database 생성시, 긴 url 대신에 alias를 제공.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>heroku pg:copy HEROKU_POSTGRESQL_XXXXXX_URL HEROKU_POSTGRESQL_AQUA_URL --app your_app_name
</code></pre></div></div>

<p><br /></p>

<p>e. 새로운 데이터베이스를 주 사용 데이터베이스로 선택</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>heroku pg:promote HEROKU_POSTGRESQL_AQUA_URL
</code></pre></div></div>

<p><br /></p>

<p>f. 서버점검 모드 해제</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>heroku maintenance:off
</code></pre></div></div>

<hr />

<p><a href="https://devcenter.heroku.com/articles/upgrading-heroku-postgres-databases">Upgrading Heroku Postgres Databases
</a></p>

 -->
      </div>
    
      <div class="post">
        <h4 class="post-title">
          <a href="/dev/heroku/2017/01/05/heroku-restart/">
            Heroku 서버 재시작
          </a>
        </h4>
        <div class="post-description">
          <small><span class="post-date">05 Jan 2017</span></small>
        </div>
        <!-- <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>heroku restart
</code></pre></div></div>

<hr />

<p><a href="http://stackoverflow.com/questions/14612695/how-to-restart-a-rails-server-on-heroku">http://stackoverflow.com/questions/14612695/how-to-restart-a-rails-server-on-heroku</a></p>

 -->
      </div>
    
      <div class="post">
        <h4 class="post-title">
          <a href="/dev/heroku/2016/11/30/set-timezone-on-heroku/">
            Heroku에서 Timezone 설정하기
          </a>
        </h4>
        <div class="post-description">
          <small><span class="post-date">30 Nov 2016</span></small>
        </div>
        <!-- <h3 id="0-codes">0. Codes</h3>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>heroku config:add TZ="Asia/Seoul"
</code></pre></div></div>

<p><a href="https://en.wikipedia.org/wiki/List_of_tz_database_time_zones">tz database timezone</a></p>

<hr />
<p>full credit - <a href="http://blog.pardner.com/2012/08/setting-the-default-time-zone-for-a-heroku-app/">http://blog.pardner.com/2012/08/setting-the-default-time-zone-for-a-heroku-app/</a></p>

 -->
      </div>
    
      <div class="post">
        <h4 class="post-title">
          <a href="/dev/heroku/2016/10/28/godaddy-heroku-dns-forwarding/">
            Godaddy에서 Heroku로 DNS 설정하기
          </a>
        </h4>
        <div class="post-description">
          <small><span class="post-date">28 Oct 2016</span></small>
        </div>
        <!-- <ol>
  <li>Godaddy DNS 관리페이지에서 모든 레코드를 삭제.</li>
  <li>다음 레코드 추가
    <ul>
      <li>유형 : CNAME</li>
      <li>이름 : www</li>
      <li>값 : your-heroku-app-name.herokuapp.com</li>
      <li>TTL : 1시간</li>
    </ul>
  </li>
  <li>포워딩 설정
    <ul>
      <li>여기로 전달 : http://www.your_new_domain</li>
      <li>전달 유형 : 301 (영구)</li>
      <li>설정 : 포워딩만 가능</li>
    </ul>
  </li>
  <li><code class="highlighter-rouge">Heroku dashboard &gt; Settings</code> 에 Custom Domains에 추가
    <ul>
      <li>Domain name : www.your_new_domain.com</li>
    </ul>
  </li>
</ol>

<h2 id="ssl-설정시">SSL 설정시</h2>

<ol>
  <li>다음 레코드 추가
    <ul>
      <li>유형 : CNAME</li>
      <li>이름 : www</li>
      <li>값 : your-doamin.herokudns.com</li>
      <li>TTL : 1시간</li>
    </ul>
  </li>
  <li>포워딩 설정
    <ul>
      <li>여기로 전달 : https://www.your_new_domain</li>
      <li>전달 유형 : 301 (영구)</li>
      <li>설정 : 포워딩만 가능</li>
    </ul>
  </li>
</ol>

<hr />

<p>all credit : <a href="http://stackoverflow.com/questions/11492563/heroku-godaddy-send-naked-domain-to-www">http://stackoverflow.com/questions/11492563/heroku-godaddy-send-naked-domain-to-www</a></p>
 -->
      </div>
    
      <div class="post">
        <h4 class="post-title">
          <a href="/dev/rails/heroku/2016/09/21/Heroku-database-dump-out/">
            Heroku database로 local database 세팅하기
          </a>
        </h4>
        <div class="post-description">
          <small><span class="post-date">21 Sep 2016</span></small>
        </div>
        <!-- <h2 id="0codes-first">0.Codes first</h2>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>heroku pg:backups capture
curl -o latest.dump `heroku pg:backups public-url`
bin/rake db:reset
pg_restore --verbose --clean --no-acl --no-owner -h localhost -U myuser -d mydb latest.dump
</code></pre></div></div>

<h2 id="1-heroku-version-확인">1. Heroku version 확인</h2>
<p>legacy heroku gem을 사용하고 있다면, gem을 제거하고 Heroku CLI를 다시 설치해야 합니다.</p>

<ul>
  <li>legacy heroku gem 제거 : <code class="highlighter-rouge">gem uninstall heroku --all</code></li>
  <li>Heroku toolbelk 설치 <a href="https://devcenter.heroku.com/articles/heroku-command-line">https://devcenter.heroku.com/articles/heroku-command-line</a></li>
</ul>

<h2 id="2-heroku-db-dump-out">2. Heroku db dump-out</h2>

<p>CLI를 이용한 방법 (heroku version: 3.43.12)</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>heroku pg:backups capture

curl -o latest.dump `heroku pg:backups public-url`
</code></pre></div></div>

<p>heroku.com을 이용한 방법</p>

<ul>
  <li>visit <a href="https://postgres.heroku.com/databases">https://postgres.heroku.com/databases</a></li>
  <li>app의 database 선택</li>
  <li>PG Backups &gt; Capture &gt; Download</li>
</ul>

<h2 id="3-local-database-생성재생성">3. local database 생성/재생성</h2>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>bin/rake db:create

또는

bin/rake db:reset (기존 development db의 데이터는 삭제됩니다.)
</code></pre></div></div>

<h2 id="4-heroku-backup-db를-local-db에-복구시키기">4. Heroku backup db를 local db에 복구시키기</h2>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>pg_restore --verbose --clean --no-acl --no-owner -h localhost -U myuser -d mydb latest.dump
</code></pre></div></div>
 -->
      </div>
    
      <div class="post">
        <h4 class="post-title">
          <a href="/dev/heroku/2016/07/25/Heroku-multi-build-packs/">
            Heroku에 ffmpeg 설치하기 (Multi buildpack 사용하기)
          </a>
        </h4>
        <div class="post-description">
          <small><span class="post-date">25 Jul 2016</span></small>
        </div>
        <!-- <p>Video 파일 변환을 위해서 <code class="highlighter-rouge">carrierwave-video</code> gem을 사용했다. 이 gem은 ffmpeg를 사용하기 때문에, Heroku에도 ffmpeg를 설치해 주어야 한다.</p>

<p>carrierwave-video는 audio codec으로 fdk-aac를 사용한다. License 문제로 fdk-aac를 포함한 binary file을 공식적으로 배포하지는 않고, 직접 compile해서 사용해야 한다.</p>

<p>ffmpeg 3.0 부터는 audio codec이 안정화 되었다고 하니, 기본 audio codec인 <code class="highlighter-rouge">aac</code>를 사용하기로 했다.</p>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby">  <span class="n">process_extensions</span> <span class="no">VIDEO_EXTENSIONS</span><span class="p">,</span> <span class="ss">encode_video: </span><span class="p">[</span><span class="ss">:mp4</span><span class="p">,</span> <span class="ss">audio_codec: </span><span class="s2">"aac"</span><span class="p">]</span></code></pre></figure>

<p>Heroku에 ffmpeg를 설치하기 위해서는 buildpack을 이용해야 한다.
여러개의 buildpack을 이젠 deprecated되었지만, 아직 잘 동작하는 ddollar의 <a href="https://github.com/ddollar/heroku-buildpack-multi">heroku-buildpack-multi</a>를 사용했다.</p>

<p>.buildpacks에 buildpack 정보를 넣는다. buildpack은 직접 생성할 수도 있고, <a href="https://elements.heroku.com/buildpacks">Heroku element</a>에서 다른 사람이 만든 buildpack을 검색할 수도 있다.</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text">  &lt;.buildpacks&gt;
    https://github.com/jonathanong/heroku-buildpack-ffmpeg-latest.git</code></pre></figure>

<p>heroku에 ddollar의 buildpack을 추가한다.</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text">  &gt; heroku buildpacks:add https://github.com/ddollar/heroku-buildpack-multi</code></pre></figure>

<figure class="highlight"><pre><code class="language-text" data-lang="text">  &gt; git push heroku master</code></pre></figure>

 -->
      </div>
    
  
    <div class="category">
      <a href="#html">HTML (1)</a>
    </div>
    
      <div class="post">
        <h4 class="post-title">
          <a href="/dev/html/2016/07/19/set-viewport/">
            모바일 Layout - View port
          </a>
        </h4>
        <div class="post-description">
          <small><span class="post-date">19 Jul 2016</span></small>
        </div>
        <!-- <p>Viewport는 웹페이지에서 눈에 보이는 영역을 말한다.</p>

<p>Desktop기준으로 만들어 둔 web page는 모바일의 viewport보다 훨씬 큰데,
모바일 브라우저는 이걸 화면크기에 맞게 축소시켜서 보여준다.</p>

<figure class="highlight"><pre><code class="language-html" data-lang="html"><span class="nt">&lt;meta</span> <span class="na">name=</span><span class="s">"viewport"</span> <span class="na">content=</span><span class="s">"width=device-width, initial-scale=1.0, maximum-scale=1"</span><span class="nt">&gt;</span></code></pre></figure>

<p>HTML5부터 viewport를 개발자가 제어 할 수 있게 되었다.</p>

<p><code class="highlighter-rouge">width=device-width</code>는 모바일 기기의 화면 크기를 web page의 width로 맞추고,</p>

<p><code class="highlighter-rouge">initial-scale=1.0</code>은 모바일 브라우저에서 처음 로딩 될 때, 축소하거나 확대하지 않게한다.</p>

<p>Viewport 적용 전
<img src="http://www.w3schools.com/css/img_viewport1.png" alt="before-viewport" /></p>

<p>Viewport 적용 후
<img src="http://www.w3schools.com/css/img_viewport2.png" alt="after-viewport" /></p>

<hr />
<p><small>참고링크</small></p>

<p><small><a href="http://www.w3schools.com/css/css_rwd_viewport.asp">w3schools viewport</a></small>
<small><a href="http://www.telerik.com/blogs/responsive-design-with-twitter-bootstrap">Responsive design with twitter bootstrap</a></small></p>
 -->
      </div>
    
  
    <div class="category">
      <a href="#javascript">JAVASCRIPT (4)</a>
    </div>
    
      <div class="post">
        <h4 class="post-title">
          <a href="/dev/react/javascript/2019/05/28/manage-constants-in-javascript/">
            Javascript에서 constants 관리하기
          </a>
        </h4>
        <div class="post-description">
          <small><span class="post-date">28 May 2019</span></small>
        </div>
        <!-- <p><code class="highlighter-rouge">/components/users/constants.js</code></p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">userStatesActive</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="kd">const</span> <span class="nx">userStatesInActive</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
<span class="kd">const</span> <span class="nx">userStatesLabels</span> <span class="o">=</span> <span class="p">{</span>
  <span class="p">[</span><span class="nx">userStatesActive</span><span class="p">]:</span> <span class="s2">"active user"</span><span class="p">,</span>
  <span class="p">[</span><span class="nx">userStatesActive</span><span class="p">]:</span> <span class="s2">"active user"</span>
<span class="p">};</span>
<span class="k">export</span> <span class="k">default</span> <span class="p">{</span>
  <span class="nx">userStatesActive</span><span class="p">,</span>
  <span class="nx">userStatesInActive</span><span class="p">,</span>
  <span class="nx">userStatesLabels</span>
<span class="p">};</span>
</code></pre></div></div>

<p><code class="highlighter-rouge">/components/users/userStates.jsx</code></p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="p">{</span><span class="nx">userStatesLabels</span><span class="p">}</span> <span class="k">from</span> <span class="s1">'./constants'</span>

<span class="p">...</span>

  <span class="nx">render</span><span class="p">{</span>
    <span class="kd">const</span> <span class="p">{</span><span class="nx">state</span><span class="p">}</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">;</span>
    <span class="k">return</span> <span class="p">(</span>
      <span class="o">&lt;</span><span class="nx">span</span><span class="o">&gt;</span><span class="p">{</span><span class="nx">userStatesLabels</span><span class="p">[</span><span class="nx">state</span><span class="p">]}</span><span class="o">&lt;</span><span class="sr">/span</span><span class="err">&gt;
</span>    <span class="p">)</span>
  <span class="p">};</span>
</code></pre></div></div>
 -->
      </div>
    
      <div class="post">
        <h4 class="post-title">
          <a href="/dev/javascript/2017/04/14/javascript-namespace/">
            Javascript - Namespace 사용하기
          </a>
        </h4>
        <div class="post-description">
          <small><span class="post-date">14 Apr 2017</span></small>
        </div>
        <!-- <h2 id="anti-pattern--glbal-variable">Anti-Pattern : glbal variable</h2>

<p>당연시 되어야 될 click event가 동자하지 않았다.
이유는 다른 파일이지만 같은 함수명을 사용하였기 때문!</p>

<p>모든 함수를 전역변수로 설정해서 사용했기에 일어나는 문제다.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>//a.js
var add_to_checklist = function(){
    $('.footer__checklist__link').click( function(e) {
        e.preventDefault();
        console.log("A");
    });
}

//b.js
var add_to_checklist = function(){
    $('.header__checklist__link').click( function(e) {
        e.preventDefault();
        console.log("B");
    });
}

// event handling
add_to_checklist();     // not working.
                        // from a.js? from b.js?
</code></pre></div></div>

<h2 id="namespace">NameSpace</h2>

<p>NameSpace를 설정하면, 같은 함수명을 사용해도 겹치지 않게 사용할 수 있다.
사실 Javascript 코드 양이 얼마 되지 않을 것 같아서 NameSpace를 사용하지 않았는데
이런 저런 기능들을 붙이다 보니 어느 덧 파일수도 늘어나고, 어떤 함수명을 썼는지도 기억하지 못하게 된 것.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>//a.js
var footer = {
    add_to_checklist : function(){
        $('.footer__checklist__link').click( function(e) {
            e.preventDefault();
            console.log("A");
        });
    }
}

//b.js
var header = {
    add_to_checklist : function(){
        $('.header__checklist__link').click( function(e) {
            e.preventDefault();
            console.log("B");
        });
    }
}

//event handling
footer.add_to_checklist();      // from a.js
header.add_to_checklist();      // from b.js
</code></pre></div></div>

<hr />

 -->
      </div>
    
      <div class="post">
        <h4 class="post-title">
          <a href="/dev/javascript/2016/12/23/check-undefined/">
            Javascript 'undefined' 체크
          </a>
        </h4>
        <div class="post-description">
          <small><span class="post-date">23 Dec 2016</span></small>
        </div>
        <!-- <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>typeof myVar != 'undefined'
</code></pre></div></div>

<hr />
 -->
      </div>
    
      <div class="post">
        <h4 class="post-title">
          <a href="/dev/javascript/2016/12/09/javascript-encoding/">
            Javascript Unicdoe/UTF-8 인코딩
          </a>
        </h4>
        <div class="post-description">
          <small><span class="post-date">09 Dec 2016</span></small>
        </div>
        <!-- <h3 id="unicode">Unicode</h3>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>String.prototype.toUnicode = function(){
    var result = "";
    for(var i = 0; i &lt; this.length; i++){
        result += "\\u" + ("000" + this[i].charCodeAt(0).toString(16)).substr(-4);
    }
    return result;
};

var output = input.toUnicode();
</code></pre></div></div>

<h3 id="utf-8">UTF-8</h3>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>var output = encodeURI(input);
</code></pre></div></div>

<hr />

<p><a href="http://stackoverflow.com/questions/21014476/javascript-convert-unicode-string-to-javascript-escape">stackoverflow</a></p>

 -->
      </div>
    
  
    <div class="category">
      <a href="#jekyll">JEKYLL (8)</a>
    </div>
    
      <div class="post">
        <h4 class="post-title">
          <a href="/dev/jekyll/2017/02/14/jekyll-search/">
            Jekyll에 Search 기능 넣기 Lunrjs
          </a>
        </h4>
        <div class="post-description">
          <small><span class="post-date">14 Feb 2017</span></small>
        </div>
        <!-- <p>house201 블로그는 jekyll을 이용해서 만들었다.
다 좋은데 static page 기반이라 검색이 안된다는게 조금은 불만.</p>

<p><a href="http://jekyll.tips/jekyll-casts/jekyll-search-using-lunr-js/">Jekyll.tips</a>에 올라온 screen cast를 보고 검색기능을 넣어보기로 했다.</p>

<h2 id="jekyll-tips-codes">Jekyll tips codes</h2>

<p>search.html</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>---
layout: search
---

&lt;div id="search-results"&gt;&lt;/div&gt;

&lt;script&gt;
  window.store = {
    {% for post in site.posts %}
      "{{ post.url | slugify }}": {
        "title": "{{ post.title | xml_escape }}",
        "category": "{{ post.categories | xml_escape }}",
        "published_at" : "{{post.date | date: '%b %d, %y' }}",
        "url": "{{ post.url | xml_escape }}"
      }
      {% unless forloop.last %},{% endunless %}
    {% endfor %}
  };
&lt;/script&gt;
&lt;script src="/js/lunr.min.js"&gt;&lt;/script&gt;
&lt;script src="/js/search.js"&gt;&lt;/script&gt;
</code></pre></div></div>

<p><code class="highlighter-rouge">window.store</code> 에 모든 검색 대상을 저장하는 방식이다. post양이 엄청 많다면 browser가 느려질 수 있겠지만. 제목과 카테고리 정도라면 큰 문제는 안 될 것 같다.</p>

<p>_layouts/search.html</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>---
layout: default
---

{{content}}
</code></pre></div></div>

<p>js/search.js</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>(function() {
  function displaySearchResults(results, store) {
    var searchResults = document.getElementById('search-results');

    if (results.length) { // Are there any results?
      var appendString = '';

      for (var i = 0; i &lt; results.length; i++) {  // Iterate over the results
        var item = store[results[i].ref];
        appendString += '&lt;div class="search__result"&gt;&lt;a href="' + item.url + '"&gt;&lt;h5 class="post-title"&gt;' + item.title + '&lt;/h5&gt;&lt;/a&gt;';
        appendString += '&lt;div class="post-description"&gt;&lt;small class="post-date"&gt;' + item.published_at + '&lt;/small&gt;&lt;/div&gt;';
        appendString += '&lt;/div&gt;'
      }

      searchResults.innerHTML = appendString;
    } else {
      searchResults.innerHTML = '&lt;li&gt;No results found&lt;/li&gt;';
    }
  }

  function getQueryVariable(variable) {
    var query = window.location.search.substring(1);
    var vars = query.split('&amp;');

    for (var i = 0; i &lt; vars.length; i++) {
      var pair = vars[i].split('=');

      if (pair[0] === variable) {
        return decodeURIComponent(pair[1].replace(/\+/g, '%20'));
      }
    }
  }

  var searchTerm = getQueryVariable('query');

  if (searchTerm) {
    document.getElementById('search-box').setAttribute("value", searchTerm);

    // Initalize lunr with the fields it will be searching on. I've given title
    // a boost of 10 to indicate matches on this field are more important.
    var idx = lunr(function () {
      this.field('id');
      this.field('title', { boost: 10 });
      this.field('category');
    });

    for (var key in window.store) { // Add the data to lunr
      idx.add({
        'id': key,
        'title': window.store[key].title,
        'category': window.store[key].category,
      });

      var results = idx.search(searchTerm); // Get lunr to perform a search
      displaySearchResults(results, window.store); // We'll write this in the next section
    }
  }
})();
</code></pre></div></div>

<p><code class="highlighter-rouge">displaySearchResults</code> 이 부분은 검색결과를 어떻게 화면에다가 붙여줄 건지에 대한 부분</p>

<p><code class="highlighter-rouge">getQueryVariable</code> 이 부분은 query로 들어온 값을 검색어 배열로 바궈주는 부분</p>

<p>나머지 부분이 lurn에 모든 포스트 정보를 집어넣고, 검색어에 따라 일치하는 정보만 가져오는 부분이다.</p>

<h2 id="jslunrminjs">js/lunr.min.js</h2>

<p>공식 릴리즈 버전은 한글 검색이 지원이 안되더라. 다 만들고나서 멘붕하고 있었는데, 대부분 이럴 때 korean support보다 chinese support로 검색하면 원하는 답을 찾는 경우가 많았다.</p>

<p>정말 능력이 좋아서 korean support 버전을 척척 만들어내면 좋겠지만, 나는 어디까지나 필요한 것을 잘 조합해서 쓰고 싶은 정도니깐.</p>

<p>아래 chinese support 버전에서 lurn.min.js를 다운받아 사용해 보니 한글 검색도 잘 된다!</p>

<p><a href="https://github.com/codepiano/lunr.js">lurn chinese support version</a></p>

<p><br /></p>

<p>언제나 할 때는 헤메다가, 다 하고 블로그로 쓰니 정말 쉬워보인다.</p>

<p>–</p>

<p>references</p>

<ul>
  <li><a href="http://jekyll.tips/jekyll-casts/jekyll-search-using-lunr-js/">jekyll.tips</a></li>
  <li><a href="https://github.com/codepiano/lunr.js">lunr chinese support</a></li>
</ul>

 -->
      </div>
    
      <div class="post">
        <h4 class="post-title">
          <a href="/dev/jekyll/markdown/2017/01/14/newline-markdown/">
            markdown에서 한줄 띄어쓰기
          </a>
        </h4>
        <div class="post-description">
          <small><span class="post-date">14 Jan 2017</span></small>
        </div>
        <!-- <p>Use two spaces or two backslashes.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>this is a  
test for line breaks\\ 
in a paragraph
</code></pre></div></div>

<p>will produce</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;p&gt;this is a&lt;br /&gt;
test for line breaks&lt;br /&gt;
in a paragraph&lt;/p&gt;
</code></pre></div></div>

<hr />

<p><a href="https://github.com/gettalong/kramdown/issues/137">kramdown issue</a></p>

 -->
      </div>
    
      <div class="post">
        <h4 class="post-title">
          <a href="/dev/jekyll/2016/11/30/jekyll-post-url/">
            Jekyll에서 다른 post 링크를 넣는 방법
          </a>
        </h4>
        <div class="post-description">
          <small><span class="post-date">30 Nov 2016</span></small>
        </div>
        <!-- <p>Post에서 다른 post(2016-11-30-filename.md)의 링크를 넣는 방법.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>{% post_url 2016-11-30-filename %}
</code></pre></div></div>

<p>Jekyll documentation에서는 sub directory가 있는 경우 subDirectory를 명시하도록 되어있지만, 시도해보니, directory path를 넣으면 compile error가 발생하고 subdirectory없이 파일명으로만 하였더니, 링크가 제대로 생성되었다.</p>

<p>post_url을 이용해서 링크를 만드는 방법</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[link_text]({% post_url 2016-11-30-filename %})
</code></pre></div></div>

<hr />
<p><a href="http://jekyllrb.com/docs/templates/#post_url">jekyll doc</a>
<a href="http://stackoverflow.com/questions/4629675/jekyll-markdown-internal-links">stackoverflow</a></p>

 -->
      </div>
    
      <div class="post">
        <h4 class="post-title">
          <a href="/dev/jekyll/2016/11/30/jekyll-forloop-index/">
            Jekyll에서 forloop index 알아내기
          </a>
        </h4>
        <div class="post-description">
          <small><span class="post-date">30 Nov 2016</span></small>
        </div>
        <!-- <p>jekyll은 liquid 문법을 사용합니다.</p>

<p>for loop에서 몇번 째 iteration인지 아는 방법</p>

<p>{% for category in page.categories %}
    {{ forloop.index }}
{% endfor %}</p>

<p><code class="highlighter-rouge">forloop.index</code> 는 1 부터 시작합니다. (왜 0이 아닌거지?)</p>

<hr />
<p><a href="https://help.shopify.com/themes/liquid/objects/for-loops">liquid reference - forloop</a></p>

 -->
      </div>
    
      <div class="post">
        <h4 class="post-title">
          <a href="/dev/jekyll/seo/2016/11/13/jekyll-sitemap/">
            Jekyll 이용한 Gibhub pag에서 sitemap 생성
          </a>
        </h4>
        <div class="post-description">
          <small><span class="post-date">13 Nov 2016</span></small>
        </div>
        <!-- <p>_config.yml 파일에 아래 <em>jekyll-sitemap</em> gem을 추가해주면, github page에서 자동으로 sitemap.xml을 생성합니다.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>//_config.yml
    gems:
        - jekyll-sitemap
</code></pre></div></div>

<hr />

<p><a href="https://help.github.com/articles/sitemaps-for-github-pages/">https://help.github.com/articles/sitemaps-for-github-pages/</a></p>
 -->
      </div>
    
      <div class="post">
        <h4 class="post-title">
          <a href="/dev/jekyll/2016/11/13/jekyll-disqus/">
            Jekyll에 disqus 추가하기
          </a>
        </h4>
        <div class="post-description">
          <small><span class="post-date">13 Nov 2016</span></small>
        </div>
        <!-- <p>모든 글에 대해서 disqus를 적용하려면 <code class="highlighter-rouge">post.html</code>에 다음을 추가하면 된다.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;div id="disqus_thread"&gt;&lt;/div&gt;
&lt;script&gt;
    /**
     *  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
     *  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables
     */
    /*
    var disqus_config = function () {
        this.page.url = PAGE_URL;  // Replace PAGE_URL with your page's canonical URL variable
        this.page.identifier = PAGE_IDENTIFIER; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
    };
    */
    (function() {  // DON'T EDIT BELOW THIS LINE
        var d = document, s = d.createElement('script');
        
        s.src = '//growthhackingmeeting.disqus.com/embed.js';
        
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
&lt;/script&gt;
&lt;noscript&gt;Please enable JavaScript to view the &lt;a href="https://disqus.com/?ref_noscript" rel="nofollow"&gt;comments powered by Disqus.&lt;/a&gt;&lt;/noscript&gt;
</code></pre></div></div>

<p>글마다 disqus적용옵션을 설정하려면 <code class="highlighter-rouge">comments: true</code> 옵션을 글 머리에 넣고, <code class="highlighter-rouge">post.html</code>에는 <code class="highlighter-rouge">page.comments</code>가 있을 때만 위 코드를 삽입하면 된다.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>//some post
---
title: ###
layout: post comments: true
comments: true
...
---

//post.html
...

    여기에 disqus script 삽입
</code></pre></div></div>

<hr />

<p><a href="https://help.disqus.com/customer/portal/articles/472138-jekyll-installation-instructions">https://help.disqus.com/customer/portal/articles/472138-jekyll-installation-instructions</a></p>
 -->
      </div>
    
      <div class="post">
        <h4 class="post-title">
          <a href="/dev/jekyll/2016/09/10/Jekyll-tag-never-closed/">
            Liquid syntax error - 'highlight' tag was never closed
          </a>
        </h4>
        <div class="post-description">
          <small><span class="post-date">10 Sep 2016</span></small>
        </div>
        <!-- <p>config.yml</p>

<figure class="highlight"><pre><code class="language-yaml" data-lang="yaml"><span class="na">excerpt_separator</span><span class="pi">:</span> <span class="s2">"</span><span class="s">"</span> </code></pre></figure>

<hr />

<p>all credit: <a href="http://blog.slaks.net/2013-08-09/jekyll-tag-was-never-closed/">Slaks</a></p>
 -->
      </div>
    
      <div class="post">
        <h4 class="post-title">
          <a href="/dev/jekyll/2016/08/14/jekyll-sub-category/">
            Jekyll - category array를 sub-category처럼 사용하기
          </a>
        </h4>
        <div class="post-description">
          <small><span class="post-date">14 Aug 2016</span></small>
        </div>
        <!-- <ul>
  <li><code class="highlighter-rouge">dev</code> category의 sub category를 만들려고 했다.</li>
  <li><code class="highlighter-rouge">dev</code> category 페이지에서 sub category별로 post title을 모아서 보여주려고 했다.</li>
  <li>Jekyll의 category관련 variable
    <ul>
      <li><code class="highlighter-rouge">site.categories</code></li>
      <li><code class="highlighter-rouge">site.categories[CATEGORY_NAME] or site.categories.CATEGORY_NAME</code></li>
      <li><code class="highlighter-rouge">page.categories</code></li>
    </ul>
  </li>
  <li>각 post의 front matter에서 category를 지정할 수 있다.
    <ul>
      <li></li>
    </ul>
  </li>
</ul>
<figure class="highlight"><pre><code class="language-text" data-lang="text">      ---
      layout: post
comments: true
      title: Rails Integration Test
      category: [dev, jekyll]
      ---
    </code></pre></figure>

<ul>
  <li>Jekyll은 template language로 <a href="https://shopify.github.io/liquid/">Liquid</a>를 쓴다.</li>
  <li>폴더를 보기 좋게 만든다. (front matter에 category가 정의되어 있지 않으면, _posts 폴더 내의 폴더 구조를 category로 본다.
    <ul>
      <li>_posts
        <ul>
          <li>biz</li>
          <li>book</li>
          <li>dev</li>
        </ul>
      </li>
    </ul>
  </li>
  <li>dev category 페이지는 <code class="highlighter-rouge">categories/dev</code>로 접근하게 한다.
    <ul>
      <li><code class="highlighter-rouge">/categories/dev/index.html</code> 을 만든다.</li>
    </ul>
  </li>
  <li>/categories/dev/index.html
    <ul>
      <li>front matter에 category를 dev로 정의</li>
    </ul>
  </li>
</ul>

<figure class="highlight"><pre><code class="language-text" data-lang="text">      ---
      layout: default
      Title : Dev. Category
      category: dev
      ---
    </code></pre></figure>

<ul>
  <li>빈 array 만들기</li>
</ul>

<figure class="highlight"><pre><code class="language-liquid" data-lang="liquid">        
          <span class="p">{%</span><span class="w"> </span><span class="nt">assign</span><span class="w"> </span><span class="nv">sub_categories</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">""</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nf">split</span><span class="p">:</span><span class="w"> </span><span class="s2">""</span><span class="w"> </span><span class="p">%}</span>
        
    </code></pre></figure>

<ul>
  <li>front matter에 정의된 category 내의 모든 post에 대해 iteration</li>
</ul>

<figure class="highlight"><pre><code class="language-liquid" data-lang="liquid">        
          <span class="p">{%</span><span class="w"> </span><span class="nt">for</span><span class="w"> </span>post<span class="w"> </span>in<span class="w"> </span>site.categories[page.category]<span class="w"> </span><span class="p">%}</span>
        
      </code></pre></figure>

<ul>
  <li>dev category가 아닌 경우 sub_categories array에 추가</li>
</ul>

<figure class="highlight"><pre><code class="language-liquid" data-lang="liquid">        
          <span class="p">{%</span><span class="w"> </span><span class="kr">if</span><span class="w"> </span><span class="nv">category</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="s2">"dev"</span><span class="w"> </span><span class="p">%}</span>
            <span class="p">{%</span><span class="w"> </span><span class="nt">assign</span><span class="w"> </span><span class="nv">sub_categories</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">sub_categories</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nf">push</span><span class="p">:</span><span class="w"> </span>category<span class="w"> </span><span class="p">%}</span>
          <span class="p">{%</span><span class="w"> </span><span class="kr">endif</span><span class="w"> </span><span class="p">%}</span>
        
      </code></pre></figure>

<ul>
  <li>마지막으로 중복된 sub_category를 없애준다.</li>
</ul>

<figure class="highlight"><pre><code class="language-liquid" data-lang="liquid">      
        <span class="p">{%</span><span class="w"> </span><span class="nt">assign</span><span class="w"> </span><span class="nv">sub_categories</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">sub_categories</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nf">uniq</span><span class="w"> </span><span class="p">%}</span>
      
    </code></pre></figure>

<ul>
  <li>다른 category에서도 sub_category 배열을 만드는 코드를 쓸 거라서 <code class="highlighter-rouge">/inclues/get_sub_category.html</code>로 따로 만든다.
    <ul>
      <li><code class="highlighter-rouge">/categories/dev/index.html</code>
        <ul>
          <li></li>
        </ul>
      </li>
    </ul>
  </li>
</ul>
<figure class="highlight"><pre><code class="language-liquid" data-lang="liquid">      
        <span class="p">{%</span><span class="w"> </span><span class="nt">include</span><span class="w"> </span><span class="na">get_sub_category</span><span class="p">.</span><span class="na">html</span><span class="w"> </span><span class="p">%}</span>
      
    </code></pre></figure>

<ul>
  <li><code class="highlighter-rouge">/includes/get_sub_category.html</code>
    <ul>
      <li></li>
    </ul>
  </li>
</ul>
<figure class="highlight"><pre><code class="language-liquid" data-lang="liquid">      
        <span class="p">{%</span><span class="w"> </span><span class="nt">assign</span><span class="w"> </span><span class="nv">sub_categories</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">""</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nf">split</span><span class="p">:</span><span class="w"> </span><span class="s2">""</span><span class="w"> </span><span class="p">%}</span>
        <span class="p">{%</span><span class="w"> </span><span class="nt">for</span><span class="w"> </span>post<span class="w"> </span>in<span class="w"> </span>site.categories[page.category]<span class="w"> </span><span class="p">%}</span>
          <span class="p">{%</span><span class="w"> </span><span class="nt">for</span><span class="w"> </span>category<span class="w"> </span>in<span class="w"> </span>post.categories<span class="w"> </span><span class="p">%}</span>
            <span class="p">{%</span><span class="w"> </span><span class="kr">if</span><span class="w"> </span><span class="nv">category</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="s2">"dev"</span><span class="w"> </span><span class="p">%}</span>
              <span class="p">{%</span><span class="w"> </span><span class="nt">assign</span><span class="w"> </span><span class="nv">sub_categories</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">sub_categories</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nf">push</span><span class="p">:</span><span class="w"> </span>category<span class="w"> </span><span class="p">%}</span>
            <span class="p">{%</span><span class="w"> </span><span class="kr">endif</span><span class="w"> </span><span class="p">%}</span>
          <span class="p">{%</span><span class="w"> </span><span class="nt">endfor</span><span class="w"> </span><span class="p">%}</span>
        <span class="p">{%</span><span class="w"> </span><span class="nt">endfor</span><span class="w"> </span><span class="p">%}</span>
        <span class="p">{%</span><span class="w"> </span><span class="nt">assign</span><span class="w"> </span><span class="nv">sub_categories</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">sub_categories</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nf">uniq</span><span class="w"> </span><span class="p">%}</span>
      
    </code></pre></figure>

<hr />
<ul>
  <li>Jekyll에 대해서 알게된 것 정리</li>
  <li>liquid tag를 escaping 하는 법
    <ul>
      <li>raw tag 사용 {% raw %}  {% endraw %}
        <ul>
          <li>이 방법으론 endraw 를 escaping 하지 못함</li>
          <li>endraw는 {{ “{% endraw “ }}%} 이 방법으로 escaping.</li>
        </ul>
      </li>
    </ul>
  </li>
  <li>Array empty check
    <ul>
      <li></li>
    </ul>
  </li>
</ul>
<figure class="highlight"><pre><code class="language-liquid" data-lang="liquid">      
        <span class="p">{%</span><span class="w"> </span><span class="nt">assign</span><span class="w"> </span><span class="nv">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">sub_categories</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nf">size</span><span class="w"> </span><span class="p">%}</span>
        <span class="p">{%</span><span class="w"> </span><span class="kr">if</span><span class="w"> </span><span class="nv">size</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">%}</span>
      
    </code></pre></figure>

<hr />
<p>참고링크</p>

<ul>
  <li><a href="https://www.youtube.com/user/acinteractivedesign/search?query=jekyll">Thomas Bradley - jekyll cast</a></li>
  <li><a href="https://jekyllrb.com/docs/variables/">jekyll variable</a></li>
  <li><a href="https://gist.github.com/smutnyleszek/9803727">jekyll &amp; liquid cheat sheet</a></li>
  <li><a href="http://taylor.fausak.me/2013/02/03/escaping-liquid-tags/">Escaping liquid tags</a></li>
  <li><a href="https://shopify.github.io/liquid/">Liquid</a></li>
  <li><a href="https://github.com/jekyll/jekyll/issues/2538">Checking for empty</a></li>
</ul>
 -->
      </div>
    
  
    <div class="category">
      <a href="#jquery">JQUERY (1)</a>
    </div>
    
      <div class="post">
        <h4 class="post-title">
          <a href="/dev/jquery/2017/02/16/jquery-event/">
            JQuery Event
          </a>
        </h4>
        <div class="post-description">
          <small><span class="post-date">16 Feb 2017</span></small>
        </div>
        <!-- <h2 id="event-삭제--unbind--off">Event 삭제 / unbind / off</h2>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$(selector).off('event_name');


$('.tab').on('click', function(){...});
$('.tab').off('click');

$('.tab').on('click.mynamespace', funcion(){...});
$('.tab').off('click.mynamespace');
</code></pre></div></div>

<p>from. <a href="http://stackoverflow.com/questions/209029/best-way-to-remove-an-event-handler-in-jquery">stackoverflow</a></p>

<h2 id="hover-event-삭제--unbind--off">Hover event 삭제 / unbind / off</h2>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$(selector).hover(function(){...});
$(selector).off('mouseenter mouseleave')
</code></pre></div></div>

<p>from. <a href="http://stackoverflow.com/questions/805133/how-do-i-unbind-hover-in-jquery">stackoverflow</a></p>

<hr />

 -->
      </div>
    
  
    <div class="category">
      <a href="#markdown">MARKDOWN (1)</a>
    </div>
    
      <div class="post">
        <h4 class="post-title">
          <a href="/dev/jekyll/markdown/2017/01/14/newline-markdown/">
            markdown에서 한줄 띄어쓰기
          </a>
        </h4>
        <div class="post-description">
          <small><span class="post-date">14 Jan 2017</span></small>
        </div>
        <!-- <p>Use two spaces or two backslashes.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>this is a  
test for line breaks\\ 
in a paragraph
</code></pre></div></div>

<p>will produce</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;p&gt;this is a&lt;br /&gt;
test for line breaks&lt;br /&gt;
in a paragraph&lt;/p&gt;
</code></pre></div></div>

<hr />

<p><a href="https://github.com/gettalong/kramdown/issues/137">kramdown issue</a></p>

 -->
      </div>
    
  
    <div class="category">
      <a href="#pg">PG (1)</a>
    </div>
    
      <div class="post">
        <h4 class="post-title">
          <a href="/dev/rails/pg/2016/12/14/postgresql-korean-sort/">
            Postgresql 한글 정렬
          </a>
        </h4>
        <div class="post-description">
          <small><span class="post-date">14 Dec 2016</span></small>
        </div>
        <!-- <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Menu.order('name collate "C" asc')
</code></pre></div></div>

<hr />
<p>credit : <a href="http://susemi99.kr/2558">http://susemi99.kr/2558</a></p>

 -->
      </div>
    
  
    <div class="category">
      <a href="#rails">RAILS (56)</a>
    </div>
    
      <div class="post">
        <h4 class="post-title">
          <a href="/dev/rails/2018/05/28/rails-habtm-different-table-name/">
            Rails HABTM convention과 다른 table을 이용하기
          </a>
        </h4>
        <div class="post-description">
          <small><span class="post-date">28 May 2018</span></small>
        </div>
        <!-- <h1 id="0">0</h1>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>has_and_belongs_to_many :watching, :class_name=&gt;"Person", :join_table =&gt; :watch_people_projects
</code></pre></div></div>

<p><a href="http://tedhealey.blogspot.kr/2011/02/habtm-rails-with-different-table-name.html">solution credit</a></p>

 -->
      </div>
    
      <div class="post">
        <h4 class="post-title">
          <a href="/dev/rails/2018/05/27/rails-dev-env/">
            Rails 개발환경 설정 하기
          </a>
        </h4>
        <div class="post-description">
          <small><span class="post-date">27 May 2018</span></small>
        </div>
        <!-- <h2 id="bundler-설치">bundler 설치</h2>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>echo "gem: --no-rdoc --no-ri" &gt;&gt; ~/.gemrc

&gt; gem install bundler
</code></pre></div></div>

<h2 id="gem-설치">gem 설치</h2>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&gt; bundle install
</code></pre></div></div>

<h3 id="gem-설치---pg-관련-에러">gem 설치 - PG 관련 에러</h3>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Installing pg 0.17.1 with native extensions
Gem::Ext::BuildError: ERROR: Failed to build gem native extension.

/Users/sgwanlee/.rbenv/versions/2.2.5/bin/ruby -r ./siteconf20180527-43505-1g6vboj.rb. extconf.rb
checking for pg_config... no
No pg_config... trying anyway. If building fails, please try again with
 --with-pg-config=/path/to/pg_config
checking for libpq-fe.h... no
Can't find the 'libpq-fe.h header
*** extconf.rb failed ***
Could not create Makefile due to some reason, probably lack of necessary
libraries and/or headers.  Check the mkmf.log file for more details.  You may
need configuration options.
</code></pre></div></div>

<p><a href="https://stackoverflow.com/questions/19625487/impossible-to-install-pg-gem-on-my-mac-with-mavericks">solution</a></p>

<ol>
  <li><a href="https://postgresapp.com/">postgresql.app</a> 사용하고</li>
  <li>
    <p>아래와 같이 pg gem 설치</p>

    <p>gem install pg -v 0.17.1 – –with-pg-config=/Applications/Postgres.app/Contents/Versions/latest/bin/pg_config</p>
  </li>
  <li>
    <p>postgresql cli command</p>

    <p>sudo mkdir -p /etc/paths.d &amp;&amp;
echo /Applications/Postgres.app/Contents/Versions/latest/bin | sudo tee /etc/paths.d/postgresapp</p>
  </li>
</ol>

 -->
      </div>
    
      <div class="post">
        <h4 class="post-title">
          <a href="/dev/rails/2017/04/07/rails-permanent-login/">
            Rails - 로그인 유지하기
          </a>
        </h4>
        <div class="post-description">
          <small><span class="post-date">07 Apr 2017</span></small>
        </div>
        <!-- <p>나중에 시간이 나면 글을 다시 적기로 하고, reference만 우선 남겨준다</p>

<p><a href="https://www.railstutorial.org/book/advanced_login">https://www.railstutorial.org/book/advanced_login</a></p>

<p><a href="http://railscasts.com/episodes/274-remember-me-reset-password">http://railscasts.com/episodes/274-remember-me-reset-password</a></p>

 -->
      </div>
    
      <div class="post">
        <h4 class="post-title">
          <a href="/dev/rails/2017/03/27/rails-controller-name-in-view/">
            Rails - View에서 현재 controller 이름 사용하기
          </a>
        </h4>
        <div class="post-description">
          <small><span class="post-date">27 Mar 2017</span></small>
        </div>
        <!-- <p>controller에 따라서 뭔가 분기가 필요할 때.</p>

<p>Rails는 <code class="highlighter-rouge">controller_name</code>이라는 variable에 현재 controller 이름을 저장하고 있다.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;%= if controller_name == 'blogs' %&gt;
    ~~
&lt;% end %&gt;
</code></pre></div></div>

 -->
      </div>
    
      <div class="post">
        <h4 class="post-title">
          <a href="/dev/rails/2017/03/27/rails-bug-current-page-no-route/">
            Rails bug - current_page? No route matches
          </a>
        </h4>
        <div class="post-description">
          <small><span class="post-date">27 Mar 2017</span></small>
        </div>
        <!-- <p><code class="highlighter-rouge">current_page?</code> 사용시 No route 에러 발생</p>

<p>error
    current_page?(controller: “users”, action: “show”)</p>

<p>bug fix
    current_page?(controller: “users”, action: “show”, id: current_user.id)</p>

<p>아마도 url에서 id값을 가져오는데, root 인 경우엔 id 값이 없어서 에러가 발생
추가적으로 id 값을 전달해서 해결</p>

<hr />

<p><a href="http://stackoverflow.com/questions/5627958/no-routes-matches-when-using-current-page-in-rails-3">stackoverflow</a></p>

 -->
      </div>
    
      <div class="post">
        <h4 class="post-title">
          <a href="/dev/rails/2017/03/03/rails-habtm/">
            Rails - has_and_belongs_to_many
          </a>
        </h4>
        <div class="post-description">
          <small><span class="post-date">03 Mar 2017</span></small>
        </div>
        <!-- <h2 id="option">Option</h2>

<p><a href="http://guides.rubyonrails.org/association_basics.html#scopes-for-has-and-belongs-to-many-distinct">distinct</a>
중복 assocation 생성을 금지</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>class Ingredient &lt; ActiveRecord::Base
    has_and_belongs_to_many :items, -&gt; {distinct}
</code></pre></div></div>

<p>ingredient.items.size       // 1
ingredient.items « new_item
ingredient.items « new_item
ingredient.items            // 2</p>

<h2 id="method">Method</h2>

<p><a href="http://guides.rubyonrails.org/association_basics.html#methods-added-by-has-and-belongs-to-many-collection-delete-object">collection.delete(object)</a></p>
<ul>
  <li>assocation관계만 제거. object가 제거되지는 않음</li>
</ul>

<p>collection.delete_all</p>
<ul>
  <li>
    <p>모든 association관계 제거. object는 제거되지 않음</p>

    <p>irb(main):003:0&gt; Item.find(139).ingredients.delete_all
  Item Load (0.8ms)  SELECT  “items”.* FROM “items” WHERE “items”.”id” = $1 LIMIT 1  [[“id”, 139]]
  Ingredient Load (1.1ms)  SELECT DISTINCT “ingredients”.* FROM “ingredients” INNER JOIN “ingredients_items” ON “ingredients”.”id” = “ingredients_items”.”ingredient_id” WHERE “ingredients_items”.”item_id” = $1  [[“item_id”, 139]]
  SQL (3.3ms)  DELETE FROM “ingredients_items” WHERE “ingredients_items”.”item_id” = $1 AND “ingredients_items”.”ingredient_id” IN (54, 36, 41, 27, 28, 55, 57, 61, 62, 56, 59, 60, 58, 38)  [[“item_id”, 139]]</p>
  </li>
</ul>

<h2 id="factory_girl"><a href="http://stackoverflow.com/questions/1484374/how-to-create-has-and-belongs-to-many-associations-in-factory-girl">Factory_girl</a></h2>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>FactoryGirl.define do
  factory :company do
    #company attributes
  end

  factory :user do
   companies {[FactoryGirl.create(:company)]}
   #user attributes
  end

end


company = FactoryGirl.create(:company, #{company attributes})
user = FactoryGirl.create(:user, :companies =&gt; [company])
</code></pre></div></div>

 -->
      </div>
    
      <div class="post">
        <h4 class="post-title">
          <a href="/dev/rails/heroku/2017/03/01/heroku-rails-migration-when-release/">
            Heroku - Deploy시에 자동으로 migration 하기
          </a>
        </h4>
        <div class="post-description">
          <small><span class="post-date">01 Mar 2017</span></small>
        </div>
        <!-- <p>Profile 을 root directory에 추가</p>

<p>Procfile</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>release: bundle exec rake db:migrate
</code></pre></div></div>

<hr />

<p>all credit [aspiringwebdev.com][1]
[1]: http://aspiringwebdev.com/run-rails-migrations-automatically-on-heroku/</p>
 -->
      </div>
    
      <div class="post">
        <h4 class="post-title">
          <a href="/dev/rails/2017/02/28/how-to-disable-ssl-and-rails-force-ssl/">
            Rails - SSL 제거시 발생한 문제 (config.force_ssl의 비밀)
          </a>
        </h4>
        <div class="post-description">
          <small><span class="post-date">28 Feb 2017</span></small>
        </div>
        <!-- <p><a href="http://stackoverflow.com/questions/17776530/disabling-ssl-for-a-heroku-app">stackoverflow - Disabling SSL for a Heroku App</a> 에 모든 credit이 있습니다.</p>

<h2 id="문제와-현상">문제와 현상</h2>

<ul>
  <li>heroku에서 ssl을 설정했다가, ssl 인증서를 지워버림</li>
  <li>그 뒤부터 bebetem.herokuapp.com 으로는 접속이 되는데, bebetem.com 으로는 http를 명시해도 https로 redirect되면서 접속이 안됨</li>
  <li><code class="highlighter-rouge">heroku logs -t</code> 에서 해당 redirection이 로그로 남지 않음</li>
</ul>

<h2 id="시도한-방법">시도한 방법</h2>

<ul>
  <li>우선 rails의 <code class="highlighter-rouge">config.force_ssl=false</code>로 변경함</li>
  <li>DNS에서 https://www.bebetem.com 으로 forwarding을 해놨기 때문에, 그 때문인 것 같아서 http로 forwarding을 바꿨으나 해결되지 않음</li>
  <li>heroku에서 ssl을 사용하면 dns target이 bebetem.herokuapp.com 에서 bebetem.com.herokdns.com 으로 변경되었었음. 그래서 다시 원래와 같이 bebetem.herokuapp.com으로 dns cname을 변경하였으나 dns를 찾지 못해서 에러가 발생</li>
</ul>

<h2 id="해결책">해결책</h2>

<ul>
  <li>SSL설정시 rails에서 <code class="highlighter-rouge">config.force_ssl=true</code> 를 설정하였음</li>
  <li>이 설정은 <code class="highlighter-rouge">Strict Transport Security</code> header에 max-age 값을 1년으로 설정해버림</li>
  <li>이 header값은 브라우저가 1년동안은 서버로 접속할 때 https를 사용하도록 강제함</li>
  <li>그래서 아무리 heroku logs -t 로 로그를 보아도 http에서 https로 redirect되는 로그를 찾아볼 수가 없었음</li>
</ul>

<h2 id="trick">trick</h2>

<p>application_controller.rb</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>before_filter :expire_hsts
private
  def expire_hsts
    response.headers["Strict-Transport-Security"] = 'max-age=0'
  end
</code></pre></div></div>

<p>브라우저의 cache를 삭제하고, bebetem.com에 접속하니 http로 접속이 가능!</p>

<hr />

 -->
      </div>
    
      <div class="post">
        <h4 class="post-title">
          <a href="/dev/rails/2017/02/27/rails-datatable-pagination/">
            Rails - jQuery DataTable pagination
          </a>
        </h4>
        <div class="post-description">
          <small><span class="post-date">27 Feb 2017</span></small>
        </div>
        <!-- <p>params로 넘어오는 값이 <a href="https://github.com/railscasts/340-datatables/blob/master/store-after/app/datatables/products_datatable.rb">railscast github source</a>와 좀 바뀐게 있다.</p>

<p>params[:sSearch] –&gt; params[:search][:value]
params[:iDisplayStart] –&gt; params[:start]
params[:iDisplayLength] –&gt; params[:length]
params[:iSortCol_0] –&gt; params[:order][‘0’][‘column’]
params[:sSortDir_0] –&gt; params[:order][‘0’][‘dir’]</p>

<hr />

<p><a href="http://railscasts.com/episodes/340-datatables?autoplay=true">railscast 340-datatable</a>
<a href="https://github.com/railscasts/340-datatables/blob/master/store-after/app/datatables/products_datatable.rb">railscast github source</a></p>

 -->
      </div>
    
      <div class="post">
        <h4 class="post-title">
          <a href="/dev/rails/2017/02/22/rails-libreadline-error/">
            Rails - libreadline 에러 해결하기
          </a>
        </h4>
        <div class="post-description">
          <small><span class="post-date">22 Feb 2017</span></small>
        </div>
        <!-- <h2 id="환경">환경</h2>

<p>rails 4.2.6
ruby 2.2.5</p>

<h2 id="시작은-libreadline-not-found">시작은 libreadline not found</h2>

<p>아래 에러가 나면서 모든 rails command가 갑자기 먹통이 됨</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Users/sglee/.rbenv/versions/2.2.5/lib/ruby/gems/2.2.0/gems/activesupport-4.2.6/lib/active_support/dependencies.rb:274:in `require': dlopen(/Users/sglee/.rbenv/versions/2.2.5/lib/ruby/2.2.0/x86_64-darwin15/readline.bundle, 9): Library not loaded: /usr/local/opt/readline/lib/libreadline.6.2.dylib (LoadError)
</code></pre></div></div>

<h2 id="알려진-해결책-1-symbolic-link">알려진 해결책 #1. symbolic link</h2>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ln -s /usr/local/opt/readline/lib/libreadline.7.0.dylib /usr/local/opt/readline/lib/libreadline.6.2.dylib
</code></pre></div></div>

<p>효과없음</p>

<h2 id="알려진-해결책-2-rb-readline">알려진 해결책 #2. rb-readline</h2>

<p>Gemfile</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>group :development do
    gem 'rb-readline'
end
</code></pre></div></div>

<p>효과없음</p>

<h2 id="알려진-해결책-3-readline-설치--ruby-재설치">알려진 해결책 #3. readline 설치 &amp; ruby 재설치</h2>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>brew install readline ruby-build
rbenv install 2.2.5
gem prinstine -all
</code></pre></div></div>

<p>효과없음</p>

<h2 id="내가-해결한-방법">내가 해결한 방법</h2>

<p>git repository를 다시 cloning</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mv bebetem bebetem_old
git clone &lt;git repository&gt; bebetem
</code></pre></div></div>

<p>의심되는 원인이나 확인은 안됨</p>
<ul>
  <li>pow
    <ul>
      <li>pow를 제거했느나 똑같은 현상이 발생</li>
    </ul>
  </li>
</ul>

<hr />

<p><a href="https://mikekusold.com/development/ruby-on-rails-console-wont-start.html">알려진 해결책 #3 - mikekusold.com</a></p>

 -->
      </div>
    
      <div class="post">
        <h4 class="post-title">
          <a href="/dev/rails/2017/02/13/rails-cache-per-user-role/">
            Rails - 유저 role 별로 cache 사용
          </a>
        </h4>
        <div class="post-description">
          <small><span class="post-date">13 Feb 2017</span></small>
        </div>
        <!-- <h2 id="유저-role--일반-유저와-admin-유저">유저 role : 일반 유저와 admin 유저</h2>

<p>Rails의 cache는 4.0부터 key based cache를 지원합니다</p>

<p>key값은 <code class="highlighter-rouge">cache</code> method에 넘겨주는 object의 updated_at 값을 기반으로해서, 해당 object가 수정되면 자동으로 cache가 update됩니다.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;% cache project do %&gt;
  &lt;b&gt;All the topics on this project&lt;/b&gt;
  &lt;%= render project.topics %&gt;
&lt;% end %&gt;
</code></pre></div></div>

<p>cache key</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>views/projects/123-20120806214154/7a1156131a6928cb0026877f8b749ac9
  ^class   ^id ^updated_at    ^template tree digest
</code></pre></div></div>

<p>유저의 role 등 view가 바뀌는 dependency를 가진 모든 것을 array형태로 <code class="highlighter-rouge">cache</code> method에 넘겨줄 수 있습니다.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;% cache [admin_user?, project] do %&gt;
  &lt;b&gt;All the topics on this project&lt;/b&gt;
  &lt;%= render project.topics %&gt;
  &lt;%= render 'admin' if admin_user? %&gt;
&lt;% end %&gt;
</code></pre></div></div>

<p>cache key</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>views/false/projects/123-20120806214154/7a1156131a6928cb0026877f8b749ac9
        ^ admin_user? value
</code></pre></div></div>

<p>cache key를 보면 <code class="highlighter-rouge">admin_user?</code> 라는 값에 따라 다른 cache key가 발급되고, 다른 cached page가 로딩된다는 것을 알 수 있습니다.</p>

<hr />

<p>(Rails API - cache)<a href="http://api.rubyonrails.org/classes/ActionView/Helpers/CacheHelper.html#method-i-cache">1</a>
(Rails의 key-based cache에 대한 DHH의 blog 글)<a href="https://signalvnoise.com/posts/3113-how-key-based-cache-expiration-works">2</a></p>

 -->
      </div>
    
      <div class="post">
        <h4 class="post-title">
          <a href="/dev/rails/2017/02/09/omniauth-facebook/">
            Omniauth Facebook
          </a>
        </h4>
        <div class="post-description">
          <small><span class="post-date">09 Feb 2017</span></small>
        </div>
        <!-- <h2 id="codes">Codes</h2>

<p><a href="https://coderwall.com/p/bsfitw/ruby-on-rails-4-authentication-with-facebook-and-omniauth">coderwall.com</a> 참고</p>

<h2 id="errors--soutions">Errors &amp; Soutions</h2>

<ol>
  <li>
    <p>NoAuthorizationCodeError</p>

    <p>OmniAuth::Strategies::Facebook::NoAuthorizationCodeError must pass either a code parameter or a signed request (via signed_request parameter or a fbsr_XXX cookie)</p>
  </li>
</ol>

<p><code class="highlighter-rouge">FB.init</code> 에 <code class="highlighter-rouge">cookie: true</code> 옵션을 넣어주니 해결되었다.</p>

<h2 id="with-turbolink">with turbolink</h2>

<p>facebook js sdk에서는 sdk를 초기화할 때, body안에 fb-root라는 dom element를 만듬
turbolink로 이동하면 이 fb-root가 사라진다.</p>

<p>가장 간단한 방법은 모든 turbolink request마다 sdk를 다시 load하면 되는 거지만, 그렇다면 turbolink를 쓰는 이유가 무색해진다.</p>

<p>turbolinks와 다른 javscript library와의 compatibility를 정리해둔 (http://reed.github.io/turbolinks-compatibility/)<a href="http://reed.github.io/turbolinks-compatibility/facebook.html">1</a> 의 code를 보면 아래와 같이 작동한다.</p>

<ul>
  <li>tubolink request가 시작되기 전에 <code class="highlighter-rouge">fb-root</code> element를 window.fbRoot에 저장</li>
  <li>turbolink로 새로운 dom이 load되면 저장된 window.fbRoot를 이용해서 <code class="highlighter-rouge">fb-root</code>를 복원</li>
</ul>

<h3 id="turbolink-5">Turbolink 5</h3>

<p>turbolink3에서 turbolink 5로 넘어오면서, event 이름들이 바뀌었다.
page:chage , page:load –&gt; turbolinks.load
page:fetch –&gt; turbolinks:request-start</p>

<p><a href="https://github.com/turbolinks/turbolinks/blob/master/src/turbolinks/compatibility.coffee#L25">turbolink github</a>에 가면 jquery event를 turbolink5의 event로 바꿔주는 script가 있다.</p>

<hr />

 -->
      </div>
    
      <div class="post">
        <h4 class="post-title">
          <a href="/dev/rails/2017/02/06/ngrok-test-local-app-in-mobile/">
            Mobile에서 localhost 테스트하기
          </a>
        </h4>
        <div class="post-description">
          <small><span class="post-date">06 Feb 2017</span></small>
        </div>
        <!-- <h2 id="ngrok-설치">ngrok 설치</h2>

<p><a href="https://ngrok.com/">https://ngrok.com/</a></p>

<h2 id="ngrok-실행">ngrok 실행</h2>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>./ngrok http 3000       //3000은 localhost에 떠있는 Rails-app 포트번호
</code></pre></div></div>

<hr />

<p><a href="https://github.com/inconshreveable/ngrok">ngrok github</a></p>

 -->
      </div>
    
      <div class="post">
        <h4 class="post-title">
          <a href="/dev/rails/ruby/2017/01/20/irb-encoding/">
            irb, rails console에서의 한글 encoding 문제 해결
          </a>
        </h4>
        <div class="post-description">
          <small><span class="post-date">20 Jan 2017</span></small>
        </div>
        <!-- <ul>
  <li>기본 encoding : UTF-8</li>
  <li>한글 사용을 위해서는 <code class="highlighter-rouge">readline</code> 패키지 필요</li>
  <li>Ruby를 설치할 때 마다 readline 경로를 명시해야되나, rbenv plugin을 사용하면 자동으로 경로가 지정됨</li>
</ul>

<p><br /></p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>brew install readline
git clone git://github.com/tpope/rbenv-readline.git ~/.rbenv/plugins/rbenv-readline
rbenv install &lt;ruby_version&gt;
</code></pre></div></div>

<p>이미 설치되어 있는 경우, 해당 버전의 ruby를 삭제하고 재설치</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>rbenv uninstall &lt;ruby_version&gt;
rbenv install &lt;ruby_version&gt;
</code></pre></div></div>

<p>irb에서는 한글이 제대로 입력되는데, rails console에서는 그대로 UTF-8로 나오는 경우에, 재부팅을 하고 나니 제대로 한글이 입력되더라.</p>

<hr />

<p>all credit to <a href="https://blog.iamseapy.com/archives/177">https://blog.iamseapy.com/archives/177</a></p>

 -->
      </div>
    
      <div class="post">
        <h4 class="post-title">
          <a href="/dev/rails/2016/12/31/rails-preload-nested-association/">
            Preload/Eagerload Nest Association
          </a>
        </h4>
        <div class="post-description">
          <small><span class="post-date">31 Dec 2016</span></small>
        </div>
        <!-- <h2 id="preload-nest-association">Preload Nest Association</h2>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Menu.includes(submenus: :items)
</code></pre></div></div>

<h2 id="conditional-preload">conditional preload</h2>

<p>scope은 preload에 사용할 수 없으니, lambda를 이용해서 condition을 만족하는 association을 생성.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>class SubMenu
    has_one :best_item, -&gt; {where("rank = ?", 1)}, class_name: "Item"


Menu.includes(submenus: :best_item)
</code></pre></div></div>

<hr />

<p><a href="http://stackoverflow.com/questions/24397640/rails-nested-includes-on-active-records">http://stackoverflow.com/questions/24397640/rails-nested-includes-on-active-records</a></p>

 -->
      </div>
    
      <div class="post">
        <h4 class="post-title">
          <a href="/dev/rails/2016/12/31/jquery-append-prepend-after-before/">
            jQuery Dom붙이기 한 방에 이해!! - append, prepend, after, before
          </a>
        </h4>
        <div class="post-description">
          <small><span class="post-date">31 Dec 2016</span></small>
        </div>
        <!-- <p><img src="https://i.stack.imgur.com/GWmap.png" alt="jquery append prepend after before" /></p>

<hr />

 -->
      </div>
    
      <div class="post">
        <h4 class="post-title">
          <a href="/dev/rails/pg/2016/12/14/postgresql-korean-sort/">
            Postgresql 한글 정렬
          </a>
        </h4>
        <div class="post-description">
          <small><span class="post-date">14 Dec 2016</span></small>
        </div>
        <!-- <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Menu.order('name collate "C" asc')
</code></pre></div></div>

<hr />
<p>credit : <a href="http://susemi99.kr/2558">http://susemi99.kr/2558</a></p>

 -->
      </div>
    
      <div class="post">
        <h4 class="post-title">
          <a href="/dev/rails/test/rspec/2016/12/06/rspec-controller/">
            Rails Controller Test with Rspec
          </a>
        </h4>
        <div class="post-description">
          <small><span class="post-date">06 Dec 2016</span></small>
        </div>
        <!-- <h3 id="controller-테스트-범위">Controller 테스트 범위</h3>

<ol>
  <li>Controller의 CRUD 관련 매소드가 예상한것과 같이 동작한다.</li>
  <li>CRUD외 다른 메소드가 예상한 것과 같이 동작한다.</li>
  <li>nested attribute</li>
  <li>nested routing</li>
</ol>

<p><br /></p>

<h3 id="controller-method를-호출-하는-방법">Controller method를 호출 하는 방법</h3>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;HTTP verb&gt; &lt;controller method name&gt; &lt;params&gt;

get :index

get :edit, id: 1

get :show, id: 1

post :create, name: 'a', brand: 'b'

delete :destroy, id: 1
</code></pre></div></div>

<p><br /></p>

<h3 id="controller-method에서-선언된-변수에-접근하는-방법">Controller method에서 선언된 변수에 접근하는 방법</h3>

<p><code class="highlighter-rouge">assign(:variable)</code></p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>expect(assign(:items)).to be [item1, item2]
</code></pre></div></div>

<p><br /></p>

<h3 id="controller-method로-부터-반환되는-값">Controller method로 부터 반환되는 값</h3>

<p><code class="highlighter-rouge">response</code></p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>expect(response).to redirect_to user_path
expect(response).to render_template :index
</code></pre></div></div>

<p><br />
<br /></p>

<h3 id="1-crud-method-test">1. CRUD method test</h3>

<h4 id="a-get-request">a. GET Request</h4>

<ol>
  <li>원하는 데이터가 instance variable에 제대로 할당되어야 한다.</li>
  <li>액션에 맞는 템플릿을 렌더링하여야 한다.</li>
</ol>

<p>Method : #index, #new, #edit, #show</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>describe'#show'do
    it "assigns the requested contact to @contact" do
        contact = create(:contact)
        get :show, id: contact
        expect(assigns(:contact)).to eq contact
    end
    it "renders the :show template" do
        contact = create(:contact)
        get :show, id: contact 
        expect(response).to render_template :show
    end 
end
</code></pre></div></div>

<p><br /></p>

<h4 id="b-post-request">b. POST request</h4>

<ol>
  <li>valid parameter가 주어졌을 때
    <ul>
      <li>Database에 새로운 record 생성</li>
      <li>원하는 path로 redirect</li>
      <li>(옵션) Flash message 제대로 설정</li>
    </ul>
  </li>
  <li>invalid parameter가 주어졌을 때
    <ul>
      <li>Database에 새로운 record를 생성하지 않음</li>
      <li>원하는 contents rendering</li>
      <li>(옵션) Flash message 제대로 설정</li>
    </ul>
  </li>
</ol>

<p>_</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>describe '#create.html' do
  context "with valid attributes" do
    it "saves the new item into the database" do
      expect {
        post :create, item: attributes_for(:item)
        }.to change(Item, :count).by(1)
    end
    it "redirects to items#index" do
      post :create, item: attributes_for(:item)
      expect(response).to redirect_to items_path
    end
    it "sets flash message" do
      post :create, item: attributes_for(:item)
      expect(flash[:success]).to match("create")
    end
  end
  context "with invalid attributes" do
    it "does not save the new item into the database" do
      expect {
        post :create, item: attributes_for(:invalid_item)
      }.not_to change(Item, :count)
    end
    it "re-renders the :new template" do
      sub_menu = create(:sub_menu)
      post :create, item: attributes_for(:invalid_item)
      
      expect(response).to render_template :new
    end
  end
</code></pre></div></div>

<p>Ajax request</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>xhr :post, :create, item: attributes_for(:item)
</code></pre></div></div>

<p>status check</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>expect(response.status).to be(404)
</code></pre></div></div>

<p><br /></p>

<h4 id="c-patch-request">c. PATCH request</h4>

<p>1) valid attributes</p>
<ul>
  <li>requested object</li>
  <li>DB update</li>
  <li>redirect</li>
  <li>Flash message (success)</li>
</ul>

<p>2) invalid attributes</p>
<ul>
  <li>DB update (not changed)</li>
  <li>render</li>
  <li>Flash message (error)</li>
</ul>

<p>업데이트된 record값을 다시 가져오기 : <code class="highlighter-rouge">reload</code></p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>describe 'update' do
  context "with valid attributes" do
    it "locates the requested @item" do
      patch :update, id: @item, item: attributes_for(:item)
      expect(assigns(:item)).to eq(@item)
    end
    it "changes @item's attributes" do
      patch :update, id: @item, item: attributes_for(:item, name: "!")
          
      @item.reload

      expect(@item.name).to eq "!"
    end
    it "redirects to item#index" do
      patch :update, id: @item, item: attributes_for(:item)
      expect(response).to redirect_to items_path
    end
  end
  context "with invalid attributes" do
    it "does not change the @item's attributes" do
      name = @item.name
      patch :update, id: @item, item: attributes_for(:invalid_item)
      expect(@item.reload.name).to eq(name)
    end
    it "re-renders the :edit template" do
      patch :update, id: @item, item: attributes_for(:invalid_item)
      expect(response).to render_template :edit
    end
    it 'sets flash message' do
      patch :update, id: @item, item: attributes_for(:invalid_item)
      expect(flash[:danger][:name]).not_to be_nil
    end
  end
end
</code></pre></div></div>

<p><br /></p>

<h4 id="d-delete-request">d. DELETE request</h4>

<ol>
  <li>잘 지워졌는</li>
  <li>지우고나서 redirect</li>
</ol>

<p>_</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>describe '#destroy' do
  it "deletes the item" do
    expect {
      delete :destroy, id: @item
    }.to change(Item, :count).by(-1)
  end
  it "redirects to item#index" do
    delete :destroy, id: @item
    expect(response).to redirect_to items_path
  end
end
</code></pre></div></div>

<p>###2. Non-CRUD method test
###3. Nested Attributes
###4. Nested Routes</p>

<hr />
 -->
      </div>
    
      <div class="post">
        <h4 class="post-title">
          <a href="/dev/rails/2016/12/02/vcr-webmocking/">
            VCR - 빠른 3rd party API 테스트
          </a>
        </h4>
        <div class="post-description">
          <small><span class="post-date">02 Dec 2016</span></small>
        </div>
        <!-- <p><br /></p>

<h3 id="vcr-태그-사용">:vcr 태그 사용</h3>

<p><code class="highlighter-rouge">/spec/support/vcr.rb</code></p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>VCR.configure do |config|
  config.cassette_library_dir = "spec/vcr"
  config.hook_into :webmock
  config.ignore_localhost = true

  # :vcr tag 사용
  config.configure_rspec_metadata!
end
</code></pre></div></div>

<p><br /></p>

<h3 id="vcr-태그에-option-전달">:vcr 태그에 option 전달</h3>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>context 'with valid attributes', :vcr do

context 'with valid attributes', vcr: {record: :new_episodes} do
</code></pre></div></div>

<h3 id="vcrerrorsunhandledhttprequesterror">VCR::Errors::UnhandledHTTPRequestError</h3>

<ul>
  <li>카세트에 저장된 URL과 test에서 요청하는 URL이 다를 때 발생</li>
  <li>Factory_girl에서 sequence를 이용해 URL을 만들 경우, 이후에 테스트 수트가 추가되면서 URL이 변경되는 경우 발생</li>
  <li>create() method에 URL관련된 attribute를 parameter로 넘겨줘서 고정시켜 해결 <a href="https://github.com/vcr/vcr/issues/554">vcr-issue</a></li>
</ul>

<hr />

<p><a href="https://www.relishapp.com/vcr/vcr/v/2-2-5/docs/test-frameworks/usage-with-rspec-metadata">vcr reference</a></p>

<p>https://semaphoreci.com/community/tutorials/stubbing-external-services-in-rails</p>

<p>http://marnen.github.io/webmock-presentation/webmock.html</p>

<p>http://railscasts.com/episodes/291-testing-with-vcr</p>
 -->
      </div>
    
      <div class="post">
        <h4 class="post-title">
          <a href="/dev/rails/test/2016/11/30/railscast-how-to-test/">
            Integration test or Unit test
          </a>
        </h4>
        <div class="post-description">
          <small><span class="post-date">30 Nov 2016</span></small>
        </div>
        <!-- <p>Integration_test에서는 사용자가 신경 쓸만한 부분을 테스트한다.</p>

<ul>
  <li>메일을 받는다</li>
  <li>메일 주소를 넣는다.</li>
</ul>

<p>사용자가 신경쓰지 않는 부분들은 Unit test 레벨에 넘긴다.</p>

<ul>
  <li>메일에 올바른 password_reset token을 받는다.</li>
</ul>

<hr />
<p><a href="http://railscasts.com/episodes/275-how-i-test">railscast</a></p>

 -->
      </div>
    
      <div class="post">
        <h4 class="post-title">
          <a href="/dev/rails/test/2016/11/30/rails-test-toc/">
            Rails Test 0 Table of Contents
          </a>
        </h4>
        <div class="post-description">
          <small><span class="post-date">30 Nov 2016</span></small>
        </div>
        <!-- <p><code class="highlighter-rouge">Test Philasophy</code></p>

<p>https://github.com/lelylan/betterspecs/issues/5</p>

<p><br /></p>

<p><code class="highlighter-rouge">Rspec style guide</code></p>

<p><a href="/2016/12/02/rspec-style-guide/">Rspec Style Guide</a></p>

<p><br /></p>

<p><code class="highlighter-rouge">Test Environment</code></p>

<ul>
  <li>
    <p><a href="/dev/rails/2016/08/20/rails-guard/">Guard 설정</a></p>
  </li>
  <li>
    <p><a href="/dev/rails/2016/08/13/fast-test-with-guard-and-zeus/">빠른 테스트 설정 - Zeus &amp; Guard </a></p>
  </li>
</ul>

<p><br /></p>

<p><code class="highlighter-rouge">Model test</code></p>

<ul>
  <li>
    <p><a href="/dev/rails/test/2016/11/30/rails-test-model/">Rails model test with Rspec</a></p>
  </li>
  <li>
    <p><a href="/dev/rails/test/2016/11/30/factory_girl/">Factory_girl 사용법 정리</a></p>
  </li>
  <li>
    <p><a href="/dev/rails/2016/12/02/vcr-webmocking/">VCR - 빠른 3rd party API 테스트</a></p>
  </li>
</ul>

<p><br /></p>

<p><code class="highlighter-rouge">Controller test</code></p>

<ul>
  <li><a href="/dev/rails/test/rspec/2016/12/06/rspec-controller/">Rails controller test with Rspec</a></li>
</ul>

<h3 id="integration-test">Integration-test</h3>

<ul>
  <li><a href="/dev/rails/test/2016/11/30/railscast-how-to-test/">Integration test에서는 어떤 것을 테스트해야 될까</a></li>
</ul>

<h3 id="etc">etc</h3>

<ul>
  <li><a href="/2016/12/02/how-to-test-crawling-codes/">Crawling code를 테스트하는 방법</a></li>
</ul>
 -->
      </div>
    
      <div class="post">
        <h4 class="post-title">
          <a href="/dev/rails/test/2016/11/30/rails-test-model/">
            Rails Test 1 Model
          </a>
        </h4>
        <div class="post-description">
          <small><span class="post-date">30 Nov 2016</span></small>
        </div>
        <!-- <p>Model에서 테스트 해야 할 것.</p>

<ol>
  <li>유효한 attritutes를 넘겼을 때 model의 create method가 유효해야한다.</li>
  <li>유효하지 않은 데이터는 유효성 검사를 통과하지 않아야 한다.</li>
  <li>클래스 매소드(+scope)와 인스턴스 매소드가 예상한것과 같이 동작한다.</li>
</ol>

<p><br /></p>

<p><em>item.rb</em></p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>class Item &lt; ActiveRecord::Base
    ...
    validate :name, presence: true
</code></pre></div></div>

<p><br /></p>

<p>1) 유효한 attritutes를 넘겼을 때 model의 create method가 유효해야한다.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>context 'with valid attritues' do
    it '#create' do

        expect {
            Item.create(name: "A")
        }.to change(Item, :count).by(1)
</code></pre></div></div>

<p><br /></p>

<p>2) 유효하지 않은 데이터는 유효성 검사를 통과하지 않아야 한다.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>item = Item.new()
item.valid?
expect(item.errors[:name]).to include("can't be blank")
</code></pre></div></div>

<p><br /></p>

<p>3) 클래스 매소드, scope, 인스턴스 매소드가 예상한것과 같이 동작한다.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>it '#instance_method' do
end

it '::class_method' do
end
</code></pre></div></div>

<p><br /></p>

<hr />
<p><a href="https://leanpub.com/everydayrailsrspec">Everyday Rails testing with Rspec</a></p>

 -->
      </div>
    
      <div class="post">
        <h4 class="post-title">
          <a href="/dev/rails/test/2016/11/30/factory_girl/">
            Gem - Factory_girl
          </a>
        </h4>
        <div class="post-description">
          <small><span class="post-date">30 Nov 2016</span></small>
        </div>
        <!-- <p><small>FactoryGirl Rails v4.4 기준입니다.</small></p>

<p><br /></p>

<h3 id="fixture-쓰지-말고-factorygirl-쓰자">Fixture 쓰지 말고, FactoryGirl 쓰자.</h3>

<ul>
  <li>Fixture는 Active Record를 우회해서 validation이 안된다.</li>
  <li>데이터가 쉽게 변경되어서 test code만큼 test db 관리에 신경써야 된다.</li>
</ul>

<p><br /></p>

<h3 id="valid--invalid-factory">Valid / invalid factory</h3>

<p>한 모델에 대해 factory를 만들 때 기본적으로 valid / invalid factory를 생성해둔다.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code># app/models/item.rb
class Item &lt; ActiveRecord::Base
  validates :name, presence: true
  ...
end


# spec/factories.rb
factory :item do
  sequence(:name) { |n| "Item_#{n}"}
  ...

  factory :invalid_item do
    name nil
  end
end
</code></pre></div></div>

<p>valid/invalid factory는 <code class="highlighter-rouge">attributes_for</code> method를 이용해서 controller spec에서 사용한다.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code># spec/controllers/item_controller_spec.rb
context "with valid attributes" do
  it "saves the new item into the database" do
    expect {
      post :create, item: attributes_for(:item)
      }.to change(Item, :count).by(1)
  end
end
context "with invalid attributes" do
  it "does not save the new item into the database" do
    expect {
      post :create, item: attributes_for(:invalid_item)
    }.not_to change(Item, :count)
  end
end
</code></pre></div></div>

<p><br /></p>

<h3 id="association">Association</h3>

<p>nested_attribute를 설정한 경우, factory에도 nested attribute를 받아서 assocation factory를 생성하게 할 수 있다.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code># app/models/item.rb
class Item &lt; ActiveRecord::Base
  ...
  accepts_nested_attributes_for :keywords, allow_destroy: true
  ...

  #strong parameter
  
  def item_params
    params.require(:item).permit(:id, :name, keywords_attributes: [:id, :name, '_destroy')
  end
</code></pre></div></div>

<p>associated factory에 넘길 parameter와 생성할 assocated factory 갯수를 <code class="highlighter-rouge">ignore</code>로 설정해준다.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code># spec/factories.rb

factory :item do
  sequence(:name) { |n| "Item_#{n}"}

  factory :item_with_keywords do
    ignore do
      keywords_count 1
      nmc 0
    end
    after(:create) do |item, evaluator|
      create_list(:keyword, evaluator.keywords_count, {item: item, nmc: evaluator.nmc})
    end
  end
end

factory :keyword do
    sequence(:name) { |n| "Keyword_#{n}"}
  end
</code></pre></div></div>

<p>factory 생성시에 strong parameter와 같이 nested attributes를 함께 <code class="highlighter-rouge">create</code> method에 넘겨준다.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>item = create(:item, keywords_attributes: [attributes_for(:keyword)] )

post :create, item: attributes_for(:item, keywords_attributes: [attributes_for(:keyword)]))
</code></pre></div></div>

<p><br /></p>

<h3 id="faker-gem">Faker Gem</h3>

<p><a href="https://github.com/stympy/faker">faker</a> 를 이용하면 이름/이메일/주소 등 실제 데이터같은 샘플 데이터를 얻을 수 있다.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code># Gemfile
group :development, :test do
  gem 'faker', '~&gt; 1.4.3'
end

# spec/factories.rb
factory :user do
  name Faker::Name.name
end
</code></pre></div></div>

<h3 id="내가-겪은-trouble">내가 겪은 Trouble</h3>

<p><code class="highlighter-rouge">has_secure_password</code> 를 사용했을 때, factory_girl로 만든 <code class="highlighter-rouge">user</code>로 login하는데 문제가 있었다. 원인은 아직모르겠으나, factory를 사용하지 않고, ActiveRecord를 직접 생성하는 것으로 우회했다.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code># Not working
factory :user do
  factory :admin do
  end
end

# Workaround
factory :user do
end

factory :admin, class: User do
end
</code></pre></div></div>

<p><br /></p>

<hr />

<p><a href="https://github.com/thoughtbot/factory_girl/blob/master/GETTING_STARTED.md#defining-factories">Model과 다른 이름의 factory 만드는 guide</a>
<a href="http://ricostacruz.com/cheatsheets/factory_girl.html">FactoryGirl Cheat Sheet</a></p>

 -->
      </div>
    
      <div class="post">
        <h4 class="post-title">
          <a href="/dev/rails/2016/11/28/nokogiri/">
            Gem Nokogiri - 웹페이지 크롤링
          </a>
        </h4>
        <div class="post-description">
          <small><span class="post-date">28 Nov 2016</span></small>
        </div>
        <!-- <p><a href="https://github.com/sparklemotion/nokogiri">Nokogiri</a>는 selector를 이용해 웹페이지의 정보를 가져올 수 있게 해줍니다.
링크를 타고 가면서 크롤링 하는 것을 원할 경우엔, <a href="https://github.com/sparklemotion/mechanize">Mechanize</a>를 사용하세요.</p>

<h3 id="nokogiri-gem-설치">Nokogiri gem 설치</h3>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>gem install nokogiri
</code></pre></div></div>

<h3 id="설치-오류시">설치 오류시</h3>

<p>limbiconv error는 <a href="http://www.nokogiri.org/tutorials/installing_nokogiri.html#mac_os_x">nokogiri tutorial</a> 참고
libxml이 없는 경우엔 설치</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>brew install libxml
</code></pre></div></div>

<p>xz 오류시 workaround <a href="https://github.com/sparklemotion/nokogiri/issues/1483">nokogiri-issue-1483</a></p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>brew uninstall xz
</code></pre></div></div>

<h3 id="요약">요약</h3>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>doc = Nokogiri::HTML(open(url))

#CSS selector로 찾기
doc.css('nav ul.menu li a', 'article h2').each do |link|
    # attributes
    puts link.attributes["id"].value if link.attributes["id"]
    
    puts link.content
end
</code></pre></div></div>

<h3 id="한글-인코딩-문제">한글 인코딩 문제</h3>

<p><a href="http://wolfapple.tumblr.com/post/30861736496/open-uri-%EC%82%AC%EC%9A%A9%EC%8B%9C-%ED%95%9C%EA%B8%80%EC%9D%B4-%EA%B9%A8%EC%A7%88%EB%95%8C">wolfapple</a></p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>doc = Nokogiri::HTML(open('http://blog.naver.com/xxxx', 'r:binary').read.encode('utf-8', 'euc-kr'))
</code></pre></div></div>

<p>한글 인코딩 시 간혹 euc-kr encoding으로 처리할 수 없는 문자가 있는 경우가 있다. :invalid, :undef 옵션을 주면, error를 방지하고, encoding되지 않는 문자를 ‘?’로 바꾼다. <a href="http://www.justinweiss.com/articles/3-steps-to-fix-encoding-problems-in-ruby/">Justin Weiss</a></p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>doc = Nokogiri::HTML(open('http://blog.naver.com/xxxxx', 'r:binary').read.encode('utf-8', 'euc-kr', invalid: :replace, undef: :replace))
</code></pre></div></div>

<h3 id="xml-파싱시">XML 파싱시</h3>

<p>XML 파싱 할 때는, HTML 함수를 쓰지마세요.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>doc = Nokogiri::XML(open(url))
</code></pre></div></div>

<hr />

 -->
      </div>
    
      <div class="post">
        <h4 class="post-title">
          <a href="/dev/rails/2016/11/13/rails-new-line-in-text-area-input/">
            Rails - text-area 줄바꿈 입력값 보여주기
          </a>
        </h4>
        <div class="post-description">
          <small><span class="post-date">13 Nov 2016</span></small>
        </div>
        <!-- <p><a href="http://api.rubyonrails.org/classes/ActionView/Helpers/TextHelper.html#method-i-simple_format">simple_format</a> 을 이용하면, text-area에서 받은 줄바꿈(‘\r’)을 쉽게 보여줄 수 있다.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>//form
form_for comment
    f.text_area :body
    ...

//show
&lt;%= simple_format comment.body %&gt;
</code></pre></div></div>

 -->
      </div>
    
      <div class="post">
        <h4 class="post-title">
          <a href="/dev/rails/2016/11/12/rails-truncate/">
            Rails - 20자 이상 자르고 말줄임표 붙이기
          </a>
        </h4>
        <div class="post-description">
          <small><span class="post-date">12 Nov 2016</span></small>
        </div>
        <!-- <p>Rails의 <a href="http://api.rubyonrails.org/classes/ActionView/Helpers/TextHelper.html#method-i-truncate">truncate</a>를 쓰면, 20자 이상인 경우 20자까지만 보여주고 말줄임표로 바꿔준다.
말줄임표를 어떤 문자로 할지도 설정할 수 있다.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>truncate("Once upon a time in a world far far away", length: 17)
# =&gt; "Once upon a ti..."

truncate("Once upon a time in a world far far away", length: 17, separator: ' ')
# =&gt; "Once upon a..."

truncate("And they found that many people were sleeping better.", length: 25, omission: '... (continued)')
# =&gt; "And they f... (continued)"
</code></pre></div></div>

<hr />

 -->
      </div>
    
      <div class="post">
        <h4 class="post-title">
          <a href="/dev/rails/2016/11/12/rails-fast-asset-pipelie-with-sassc/">
            Rails - dev 모드에서 sass 컴파일 속도 높이기
          </a>
        </h4>
        <div class="post-description">
          <small><span class="post-date">12 Nov 2016</span></small>
        </div>
        <!-- <p>프론트 작업할 때, sass 파일을 수정하고 브라우저에서 확인하는 것을 반복할 경우가 많다.
‘sass-rails’ gem을 사용하고 있다면, ‘sassc-rails’ gem으로 바꾸는 것 만으로 이 작업의 속도가 훨신 좋아진다!</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>//Gemfile
gem 'sassc-rails'
</code></pre></div></div>

<hr />

<p>Full credit : <a href="http://marianposaceanu.com/articles/making-rails-asset-pipeline-faster">http://marianposaceanu.com/articles/making-rails-asset-pipeline-faster</a></p>
 -->
      </div>
    
      <div class="post">
        <h4 class="post-title">
          <a href="/dev/rails/2016/11/11/rails-gem-ratyrate/">
            별점넣기 - Rails Gem Ratyrate
          </a>
        </h4>
        <div class="post-description">
          <small><span class="post-date">11 Nov 2016</span></small>
        </div>
        <!-- <p>리뷰에 별점을 넣기 위해서 Ratyrate gem을 사용했다. 사실, ruby-toolbox에서 찾아보면 제일 많은 다운로드 수를 기록한 rating gem은 Ajaxful-rating이지만, Rails4에서 제대로 동작하지 않더라.(<a href="https://github.com/edgarjs/ajaxful-rating/issues/100">gibhub issue</a>)</p>

<p>Google 검색에서 ‘Rails gem rating’을 쳤을 때 상위에 나오는 <a href="https://github.com/wazery/ratyrate">Ratyrate</a>라는 gem을 사용하기로 했다. 우선 Ratyrate는 <a href="https://github.com/wbotelhos/raty">jQuery Raty</a>라는 플러그인을 wrapping한 gem이다.</p>

<h3 id="설치">설치</h3>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>//Gemfile
gem 'ratyrate'

//Terminal
rails g ratyrate user
bin/rake db:migrate
</code></pre></div></div>

<h3 id="사용">사용</h3>

<p>‘dimension’을 설정하여 여러개의 별점을 줄 수 있습니다. <a href="http://bebetem.com">베베템</a> 에는 하나의 별점만 필요해 “all” 이라는 dimension을 사용했습니다.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>class Car &lt; ActiveRecord::Base
    ratyrate_rateable "speed", "engine", "price"
end


class User &lt; ActiveRecord::Base
    ratyrate_rater
end
</code></pre></div></div>

<h4 id="view-helper">View Helper</h4>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>//@car의 'spped' dimension 대한 별점
&lt;%= rating_for @car, 'speed' %&gt;

//@car의 'speed' dimension 에 대한 특정 유저의 별점
&lt;%= rating_for_user @car, user, 'speed' %&gt;
</code></pre></div></div>

<h4 id="view-helper---option">View Helper - Option</h4>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>//readOnly:
&lt;%= rating_for @car, 'speed', readonly: true %&gt;
</code></pre></div></div>

<h4 id="model-method">Model method</h4>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>// car의 "speed"에 rate object list
//dimesion이 없으면, dimension을 설정하지 않은 rate만 반환한다.
//전체 rate를 반환하는 기능은 이 gem엔 없다.
car.rates "speed"

car.raters "speed"
</code></pre></div></div>

<h3 id="별모양-수정하기">별모양 수정하기</h3>

<p><em>rating_for</em> 또는 <em>rating_for_user</em>에 Option을 사용해서 수정할 수 있다.</p>

<p>gem에서는 starType 옵션을 제공하지 않지만, jquery raty plugin에서는 starType옵션을 제공합니다. 기본 starType은 <img />입니다.</p>

<p>font-awesome을 이용하기 위해서 <em>jquery.raty.js</em>에 starType을 <i>로 변경합니다.</i></p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>//jquery.raty.js
    _createStars: function() {
        ...
        // this.opt.path는 image의 path임.
        // attrs = { class: i, src: this.opt.path + this.opt[name] };
        attrs = { class: i, src: this.opt[name] };
        ...
        // $('&lt;' + this.opt.starType + ' /&gt;', attrs).appendTo(this);
        $('&lt;i&gt;&lt;/i&gt;', attrs).appendTo(this);


//_comment.html.erb

&lt;%= rating_for_user @item, comment.user, 'overall', readonly: true, star_on: "fa fa-star fa-1x", star_off: "fa fa-star-o fa-1x", star_half: "fa fa-star-half-o fa-1x" %&gt;
</code></pre></div></div>

<h3 id="cache-업데이트">Cache 업데이트</h3>

<p><em>update_rate_average</em> method를 통해서 cache model의 record가 생성/수정된다.
Gem에서는 rate가 destroy될 때 이 method가 불리지 않는다. 이미 누군가 해결책을 <a href="https://gist.github.com/piyushbeli/8b92068ce72d28ed155a">github issue로</a> 올렸지만, 아직 반여되진 않았다. 전반적으로 잘 관리가 안되고 있는 느낌이다.</p>

<p>cache인 <em>rating_caches</em> 는 gem에서 아래와 같이 선언되어 있다.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>dimensions.each do |dimension|
    has_one "#{dimension}_average".to_sym, -&gt; { where dimension: dimension.to_s },
          as: :cacheable, 
          class_name: 'RatingCache',
          dependent: :destroy
</code></pre></div></div>

<p><em>dependent: :destroy</em> 옵션이 있으니, Rate의 대상이 되는 객체를 삭제하면 RatingCache는 사라진다.</p>

<p>문제는 Rate가 삭제될 때, RatingCache가 업데이트가 되지 않는다.
아래와 같이 <em>update_rate_average</em>를 patch해서 사용하고 Rate가 삭제될 때 이 method를 불러주기로 했다.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>//config/ratyrate.rb
module Ratyrate
 def update_rate_average(stars, dimension=nil)
    if average(dimension).nil?
      send("create_#{average_assoc_name(dimension)}!", { avg: stars, qty: 1, dimension: dimension })
    else
      a = average(dimension)
      a.qty = rates(dimension).count
      //start - 추가된 부분
      if a.qty == 0
        a.avg = 0
      else
        a.avg = rates(dimension).average(:stars)
      end
      //end
      a.save!(validate: false)
    end
  end
end


//Rate가 삭제되는 곳
rate = Rate.find_by(rateable_id: self.id, rater_id: self.user.id)
if rate
    rate.destroy
end
self.update_rate_average(0, "overall")
</code></pre></div></div>

<h3 id="readonly-옵션이-제대로-안된다면">Readonly 옵션이 제대로 안된다면…</h3>

<p>아무리 readonly 옵션을 넣어도, 적용이 안되더라.
github에서 sourcecode를 봤는데, 전혀 이상할게 없었다.
실제 설치된 Gem 폴더를 열어 코드를 확인해보니, Github에서 보이는것과 달랐다.
버전을 확인해 보니 1.2.2alpha 버전이었다.</p>

<p>Gem폴더 열기 (SublimeText가 subl로 symbolic link되어 있을 때)</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>//~/.bash_profile
export BUNDLER_EDITOR=subl

//Terminal
bundle open ratyrate
</code></pre></div></div>

<p>Github에 나온 최신버전은 1.0.9이다.
그런데 Gemfile에 1.0.9로 넣으니 등록되지 않은 버전이었다.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>//Gemfile
gem 'ratyrate', "1.0.9"
</code></pre></div></div>

<p><a href="https://rubygems.org/gems/ratyrate/versions">rubygem.org</a>에 등록된 버전은 모두 1.2.0alpha 이후 버전이었다.
음.. 뭔가 이상하지만, github주소를 넣어서 1.0.9를 설치하기로 했다.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>//Gemfile
gem 'ratyrate', 'git: git://github.com/wazery/ratyrate.git
</code></pre></div></div>

<p>github주소로 설치된 버전은 1.2.0alpha지만, 이후에 readonly부분의 bug가 수정되어서, readonly가 제대로 동작한다.</p>

<p><em>git@</em>으로 시작하는 private link를 사용하면 Heroku에서 빌드가 안된다. 알아두자.</p>

<hr />

 -->
      </div>
    
      <div class="post">
        <h4 class="post-title">
          <a href="/dev/rails/2016/11/08/gem-act-as-votable/">
            좋아요/싫어요 투표 기능 gem - acts_as_votable
          </a>
        </h4>
        <div class="post-description">
          <small><span class="post-date">08 Nov 2016</span></small>
        </div>
        <!-- <p><img src="/public/voting.png" alt="bebetem.com 리뷰 투표" /></p>

<p class="center">[<a href="http://bebetem.com">bebetem.com</a> 리뷰 투표]</p>

<h3 id="0-gem-소개">0. Gem 소개</h3>

<p><a href="https://github.com/ryanto/acts_as_votable">acts_as_votble</a>은 손쉽게 좋아요/싫어요 등의 투표 기능을 구현할 수 있게 해주는 Gem입니다.</p>

<h3 id="1-설치법">1. 설치법</h3>

<p><a href="https://github.com/ryanto/acts_as_votable">Github</a> readme.md 참고하세요.
여기에는 간단하게 코드만 옮겨왔습니다.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>//Gemfile
    ...
    gem 'acts_as_votable'
    ...

//terminal

    bundle install
    rails generate acts_as_votable:migration
    rake db:migrate
</code></pre></div></div>

<p>마이그레이션이 끝나면 <em>votes</em> table이 생성됩니다.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>//schema.rb

    create_table "votes", force: :cascade do |t|
        t.integer  "votable_id"
        t.string   "votable_type"
        t.integer  "voter_id"
        t.string   "voter_type"
        t.boolean  "vote_flag"
        t.string   "vote_scope"
        t.integer  "vote_weight"
        t.datetime "created_at"
        t.datetime "updated_at"
    end

    add_index "votes", ["votable_id", "votable_type", "vote_scope"], name: "index_votes_on_votable_id_and_votable_type_and_vote_scope", using: :btree

    add_index "votes", ["voter_id", "voter_type", "vote_scope"], name: "index_votes_on_voter_id_and_voter_type_and_vote_scope", using: :btree
</code></pre></div></div>

<p><strong>votable_id</strong>    : 투표 대상이 되는 객체의 아이디 <br />
<strong>votable_type</strong>  : polymorphic association에 사용. 투표 대상이 되는 객체의 클래스명 <br />
<strong>voter_id</strong>      : 투표하는 주체가 되는 객체의 아이디 <br />
<strong>voter_type</strong>    : polymorphic association에 사용. 투표 주체가 되는 객체의 클래스명 <br />
<strong>vote_flag</strong>     : true이면 좋아요. false이면 싫어요입니다. <br /></p>

<p><a href="https://github.com/ryanto/acts_as_votable/blob/master/lib/acts_as_votable/vote.rb">act_as_votable 소스코드</a>를 살펴보면 아래처럼 <em>votable</em>과 <em>voter</em>에 대해서 polymorphic association으로 구현되어 있습니다. 어떤 클래스든 votable과 voter가 될 수 있는거죠.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>//lib/acts_as_votable/vote.rb
    belongs_to :votable, :polymorphic =&gt; true
    belongs_to :voter, :polymorphic =&gt; true
</code></pre></div></div>

<h3 id="2-사용법">2. 사용법</h3>

<p>투표의 대상이 되는 model에 <em>acts_as_votable</em>을 추가합니다.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>class Post &lt; ActiveRecord::Base
    acts_as_votable
end
</code></pre></div></div>

<p>투표 주체가 되는 model에 <em>acts_as_voter</em>을 추가합니다.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>class User &lt; ActiveRecord::Base
  acts_as_voter
end
</code></pre></div></div>

<p><em>acts_as_votable</em> 로 추가되는 method</p>

<p>투표기능</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>//좋아요
@post.liked_by @user1
@user1.likes @post

//좋아요 취소
@post.unliked_by @user1

//싫어요
@post.disliked_by @user1

//싫어요 취소
@post.undisliked_by @user1    
</code></pre></div></div>

<p>투표결과</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>// 총 투표 수
@post.votes_for.size

// 좋아요 수
@post.get_likes.size

// 싫어요 수
@post.get_dislikes.size
</code></pre></div></div>

<p>투표결과리스트</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>// 유저가 좋아요한 Post 리스트
@user.get_up_voted Post

// 유저가 싫어요한 Post 리스트
@user.get_down_voted Post
</code></pre></div></div>

<p>추가 기능들 <br /></p>
<ul>
  <li><a href="https://github.com/ryanto/acts_as_votable#adding-weights-to-your-votes">투표에 가중치 설정</a></li>
</ul>

<h3 id="3-controller">3. Controller</h3>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>//comments_controller.rb

class CommentController &lt; ApplicationController  
    ...
    def like
        @comment = Comment.find_by(id: params[:comment_id])
        if current_user
          @comment.liked_by(current_user)
        end
    
        respond_to do |format|
          format.js {
            render "comments/votes"
          }
        end
      end
    
      def dislike
        @comment = Comment.find_by(id: params[:comment_id])
        if current_user
          @comment.disliked_by(current_user)
        end
    
        respond_to do |format|
          format.js {
            render "comments/votes"
          }
        end
      end
    ...
end


//routes.rb

resources :comments do
    get 'like' =&gt; "comments#like"
    get 'dislike' =&gt; "comments#dislike"
  end
</code></pre></div></div>

<h2 id="4-cached-attributes">4. Cached-attributes</h2>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>class AddCachedVotesToPosts &lt; ActiveRecord::Migration
  def self.up
    add_column :posts, :cached_votes_total, :integer, :default =&gt; 0
    add_column :posts, :cached_votes_score, :integer, :default =&gt; 0
    add_column :posts, :cached_votes_up, :integer, :default =&gt; 0
    add_column :posts, :cached_votes_down, :integer, :default =&gt; 0
    add_column :posts, :cached_weighted_score, :integer, :default =&gt; 0
    add_column :posts, :cached_weighted_total, :integer, :default =&gt; 0
    add_column :posts, :cached_weighted_average, :float, :default =&gt; 0.0
    add_index  :posts, :cached_votes_total
    add_index  :posts, :cached_votes_score
    add_index  :posts, :cached_votes_up
    add_index  :posts, :cached_votes_down
    add_index  :posts, :cached_weighted_score
    add_index  :posts, :cached_weighted_total
    add_index  :posts, :cached_weighted_average

    # Uncomment this line to force caching of existing votes
    # Post.find_each(&amp;:update_cached_votes)
  end

  def self.down
    remove_column :posts, :cached_votes_total
    remove_column :posts, :cached_votes_score
    remove_column :posts, :cached_votes_up
    remove_column :posts, :cached_votes_down
    remove_column :posts, :cached_weighted_score
    remove_column :posts, :cached_weighted_total
    remove_column :posts, :cached_weighted_average
  end
end
</code></pre></div></div>

<h2 id="5-sorting-by-voting-score">5. sorting by voting score</h2>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>order(cached_votes_score: :desc)      // score: like(+1) 와 dislike(-1)를 합한 값
</code></pre></div></div>

<hr />

<p><a href="https://github.com/ryanto/acts_as_votable">act_as_votable github</a></p>

 -->
      </div>
    
      <div class="post">
        <h4 class="post-title">
          <a href="/dev/rails/2016/11/07/gem-act-as-commentable-with-threading/">
            대댓글 기능 gem - act_as_commentable_with_threading
          </a>
        </h4>
        <div class="post-description">
          <small><span class="post-date">07 Nov 2016</span></small>
        </div>
        <!-- <p><img src="/public/comment.png" alt="bebetem.com 대댓글" /></p>

<p class="center">[<a href="http://bebetem.com">bebetem.com</a> 대댓글]</p>

<h3 id="0-gem-소개">0. Gem 소개</h3>

<p><a href="https://github.com/elight/acts_as_commentable_with_threading">act_as_commentable_with_threading</a>은 <a href="https://github.com/jackdempsey/acts_as_commentable">act_as_commentable</a>에 댓글에 대한 댓글(대댓글) 기능을 추가시킨 gem 입니다.</p>

<h3 id="1-설치법">1. 설치법</h3>

<p><a href="https://github.com/elight/acts_as_commentable_with_threading">Github</a> readme.md 참고하세요.
여기에는 간단하게 코드만 옮겨왔습니다.</p>

<p>Install</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;Gemfile&gt;
    gem 'acts_as_commentable_with_threading'

&lt;terminal&gt;
&gt; bundle install
&gt; rails generate acts_as_commentable_with_threading_migration
</code></pre></div></div>

<p>설치가 끝나면 <code class="highlighter-rouge">Comment</code> 모델이 생성되고, <code class="highlighter-rouge">comments</code> table이 생성됩니다.</p>

<p>schema.rb</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>create_table "comments", force: :cascade do |t|
    t.integer  "commentable_id"
    t.string   "commentable_type"
    t.string   "title"
    t.text     "body"
    t.string   "subject"
    t.integer  "user_id",          null: false
    t.integer  "parent_id"
    t.integer  "lft"
    t.integer  "rgt"
    t.datetime "created_at"
    t.datetime "updated_at"
end

add_index "comments", ["commentable_id", "commentable_type"], name: "index_comments_on_commentable_id_and_commentable_type", using: :btree

add_index "comments", ["user_id"], name: "index_comments_on_user_id", using: :btree
</code></pre></div></div>

<p><code class="highlighter-rouge">commentable_id</code>    : 댓글에 대상이 되는 객체의 아이디</p>

<p><code class="highlighter-rouge">user_id</code>           : 댓글 소유자 아이디</p>

<p><code class="highlighter-rouge">parent_id</code>         : 대댓글의 시작이되는 첫 댓글 아이디 (gem에서는 <code class="highlighter-rouge">root_comment</code>라 부릅니다.)</p>

<h3 id="2-사용법">2. 사용법</h3>

<p>댓글에 대상이되는 model에 <code class="highlighter-rouge">acts_ac_commentable</code>을 추가합니다.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>class Article &lt; ActiveRecord::Base
    acts_as_commentable
end
</code></pre></div></div>

<p>댓글을 <code class="highlighter-rouge">build</code> 할 때는 댓글의 대상이 되는 <code class="highlighter-rouge">@article</code>과 댓글을 작성하는 유저의 아이디 <code class="highlighter-rouge">@user_who_commented.id</code> 를 함께 넘겨줍니다.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>@comment = Comment.build_from( @article, @user_who_commented.id, "Hey guys this is my comment!" )
</code></pre></div></div>

<p>기본적으로 생성되는 <code class="highlighter-rouge">comement.rb</code>는 다음과 같은 validation이 적용되어 있습니다.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>belongs_to :commentable, :polymorphic =&gt; true

belongs_to :user
</code></pre></div></div>

<p><code class="highlighter-rouge">:polymorphic =&gt; true</code> 는 commentable이 하나의 model이 아닌 여러 model이 될 수 있게 해줍니다. <code class="highlighter-rouge">schema.rb</code>에서 <code class="highlighter-rouge">commentable_id</code>와 <code class="highlighter-rouge">commentable_type</code> 컬럼이 있었죠. Commentable 이라는 모델은 없지만, polymorphic-association을 통해서 어떤 모델이라도 될 수 있게 됩니다.
Rails guide의 <a href="http://guides.rubyonrails.org/association_basics.html#polymorphic-associations">polymorphic-association</a> 부분을 참고하세요.
이전 버전이긴 하지만 <a href="http://railscasts.com/episodes/154-polymorphic-association?view=asciicast">Ryan Bates의 RailsCast</a>에서도 polymorphic-assocation을 다루고 있습니다.</p>

<h3 id="3-controller">3. Controller</h3>

<p>gem에서 controller를 생성해주지는 않습니다. Controller는 직접 구성해야 되는데, 이 gem을 만든 <a href="http://dustinfisher.com/acts-as-commentable-with-threading-gem/">Dustin Fisher의 블로그</a>에 예제코드가 있습니다.</p>

<p>아래 코드는 <a href="http://bebetem.com">베베템</a> 의 리뷰 시스템을 만들면서 사용한 코드입니다.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>class CommentsController &lt; ApplicationController  
    #TODO: user authentication

    def index
        redirect_to root_path
    end
  
    def new
        @item = Item.find_by(id: params[:item_id])
        @comment = Comment.build_from(@item, current_user.id, "")
    end

    def show
        @comment = Comment.find_by(id: params[:id])
        @item = Item.find_by(id: @comment.commentable_id)
        if current_user
            @new_comment    = Comment.build_from(@item, current_user.id, "")  
        end
    end
    

    def create
        commentable = commentable_type.constantize.find(commentable_id)
        @comment = Comment.build_from(commentable, current_user.id, body)

        respond_to do |format|
          if @comment.save
            make_child_comment
            format.html  {
              if root_comment_id
                redirect_to comment_path(root_comment_id)
              else
                redirect_to item_path(commentable_id) 
              end
            }
            format.js
          else
            format.html  { render :action =&gt; "new" }
            format.js
          end
        end
    end

    def destroy
        @comment = Comment.find_by(id: params[:id])
        @comment.destroy
        respond_to do |format|
          format.html { redirect_to(:back)}
          format.js
        end
    end

    private

    def comment_params
        params.require(:comment).permit(:body, :commentable_id, :commentable_type, :comment_id, :root_comment_id)
    end

    def root_comment_id
        comment_params[:root_comment_id]
    end

    def commentable_type
        comment_params[:commentable_type]
    end

    def commentable_id
        comment_params[:commentable_id]
    end

    def comment_id
        comment_params[:comment_id]
    end

    def body
        comment_params[:body]
    end

    def make_child_comment
        return "" if comment_id.blank?
        
        parent_comment = Comment.find comment_id
        @comment.move_to_child_of(parent_comment)
    end
end  
</code></pre></div></div>

<hr />

 -->
      </div>
    
      <div class="post">
        <h4 class="post-title">
          <a href="/dev/rails/2016/10/23/el-capitan-sourcetree-command-line-tool/">
            Mac OS X 10.11(El capitan)에서 SourceTree CLT 설치 실패시
          </a>
        </h4>
        <div class="post-description">
          <small><span class="post-date">23 Oct 2016</span></small>
        </div>
        <!-- <p>workaround 방법입니다.</p>

<p>~/.bash_profile</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>alias stree='/Applications/SourceTree.app/Contents/Resources/stree'
</code></pre></div></div>

<hr />

<p>all credit : <a href="https://jira.atlassian.com/browse/SRCTREE-3172">https://jira.atlassian.com/browse/SRCTREE-3172</a></p>
 -->
      </div>
    
      <div class="post">
        <h4 class="post-title">
          <a href="/dev/rails/2016/10/21/rails4-pg-string-array-form/">
            Rails4에서 PG String Array type 사용하기
          </a>
        </h4>
        <div class="post-description">
          <small><span class="post-date">21 Oct 2016</span></small>
        </div>
        <!-- <h3 id="migration">migration</h3>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>class AddInstagramCodesToItem &lt; ActiveRecord::Migration
    def change
        add_column :items, :instagram_codes, :string, array: true
    end
end
</code></pre></div></div>

<h3 id="form">form</h3>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;div class="form-group"&gt;
    &lt;%= f.label :instagram_codes, "Instagram", class: "col-sm-2 control-label" %&gt;
    &lt;div class="col-sm-10" id="item-price-selection-list"&gt;
      &lt;%= f.text_field :instagram_codes, class: "form-control"%&gt;
    &lt;/div&gt;
&lt;/div&gt;
</code></pre></div></div>

<h3 id="controller-1">controller-1</h3>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>private

def item_params
    params.require(:item).permit(:instagram_codes, ...)
end
</code></pre></div></div>

<p>#controller-2</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>def create
    if @item.save
        @item.update_attribute(:instagram_codes,item_params[:instagram_codes].split(", ").map {|c| c.strip})
        ...
end

def update
    if @item.update_attributes(item_params)
        @item.update_attribute(:instagram_codes,item_params[:instagram_codes].split(", ").map {|c| c.strip})
        ...
end
</code></pre></div></div>

<p>Array로 타입으로 선언한 attribute 값을 쓸 때는 array로 넘겨야 값이 써진다.
string으로 넘겼더니 기존 값도 사라지고 blank array가 되더라.</p>
 -->
      </div>
    
      <div class="post">
        <h4 class="post-title">
          <a href="/dev/rails/2016/10/21/rails-turbolink-instagram-embed/">
            Turbolink - 인스타그램 embed가 load되지 않을 때
          </a>
        </h4>
        <div class="post-description">
          <small><span class="post-date">21 Oct 2016</span></small>
        </div>
        <!-- <p>이것 때문에 시간을 많이 뺐겼는데, turbolink 세팅을 바꾸면 될 줄 알았다.</p>

<p>instagram.js.coffee</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>document.addEventListener "turbolinks:load", (event) -&gt;
    $.getScript("//platform.instagram.com/en_US/embeds.js", () -&gt;
        window.instgrm.Embeds.process()
    )
</code></pre></div></div>

<hr />

<p>all credit : <a href="http://stackoverflow.com/questions/27408917/instagram-embeds-not-working-when-adding-embeds-dynamically">http://stackoverflow.com/questions/27408917/instagram-embeds-not-working-when-adding-embeds-dynamically</a></p>
 -->
      </div>
    
      <div class="post">
        <h4 class="post-title">
          <a href="/dev/rails/2016/10/07/sitemap/">
            Sitemap
          </a>
        </h4>
        <div class="post-description">
          <small><span class="post-date">07 Oct 2016</span></small>
        </div>
        <!-- <p>Sitemap_generator gem을 이용합니다.</p>

<p>[Rails를 위한 가이드]가 따로 있습니다. <a href="https://github.com/kjvarga/sitemap_generator#rails">Rails 사용자를 위한 sitemap_generator guide</a></p>

<p>아래 코드 내용은 Rails4 기준입니다.</p>

<h3 id="initialization">Initialization</h3>

<p><code class="highlighter-rouge">Gemfile</code></p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>gem 'sitemap_generator'
</code></pre></div></div>

<p><code class="highlighter-rouge">bin/rake sitemap:install</code>를 이용하면 <code class="highlighter-rouge">config/sitemap.rb</code>가 만들어집니다.</p>

<h3 id="configuration">Configuration</h3>

<p><a href="https://github.com/kjvarga/sitemap_generator#sitemap-configuration">sitemap configuration 가이드</a>를 참고하세요.</p>

<p><code class="highlighter-rouge">config/sitemap.rb</code></p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>SitemapGenerator::Sitemap.default_host = "http://****.com"
SitemapGenerator::Sitemap.create do
    YourModel.find_each do |yourmodel|
        add yourmodel_path(yourmodel), :changefreq =&gt; 'weekly', :lastmod =&gt; yourmodel.updated_at
    end
</code></pre></div></div>

<h3 id="refresh">Refresh</h3>

<p><code class="highlighter-rouge">bin/rake sitemap:refresh</code>를 이용하면 <code class="highlighter-rouge">public</code> 폴더에 <code class="highlighter-rouge">sitemap.xml.gz</code> 파일이 생성됩니다.</p>

<hr />

<p><a href="https://github.com/kjvarga/sitemap_generator#rails">https://github.com/kjvarga/sitemap_generator#rails</a></p>
 -->
      </div>
    
      <div class="post">
        <h4 class="post-title">
          <a href="/dev/rails/sql/2016/09/28/duplicated-records-of-sql-when-using-limit-and-offset/">
            Pagination - 다른 페이지에 같은 record가 나오는 문제
          </a>
        </h4>
        <div class="post-description">
          <small><span class="post-date">28 Sep 2016</span></small>
        </div>
        <!-- <p><a href="https://github.com/mislav/will_paginate">will_paginate</a> gem을 이용하는데, 다른 페이지에 같은 record가 올라오는 경우가 있었다.
문제는 infinite scrolling을 넣으며 ajax로 다음 페이지를 붙이다 보니, 중복되게 반복되는 경우가 발생했다.
gem의 문제인가 해서 psql로 직접 sql을 날려보니, sql 결과에서도 같은 record가 나타났다.</p>

<h3 id="before">Before</h3>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>pnm_development=# SELECT  "sub_menus".*, "menus".name FROM "sub_menus" INNER JOIN "menus" ON "menus"."id" = "sub_menus"."menu_id" WHERE (menus.category_id = 1)  ORDER BY menus.name collate "C" asc LIMIT 10 OFFSET 10;

 id |    name    |         created_at         |         updated_at         | menu_id | description |        name         
----+------------+----------------------------+----------------------------+---------+-------------+---------------------
  6 | 물티슈     | 2016-08-10 14:12:25.575423 | 2016-08-10 14:12:25.575423 |       2 |             | 물티슈와 가제손수건
 49 | 바운서     | 2016-08-17 05:47:20.868362 | 2016-08-17 05:47:20.875056 |      16 |             | 바운서
 53 | 국산 분유  | 2016-08-29 06:54:39.305488 | 2016-08-29 06:54:39.315016 |      19 |             | 분유
 54 | 해외 분유  | 2016-08-29 06:54:54.123748 | 2016-08-29 06:54:54.130446 |      19 |             | 분유
 26 | 수유등     | 2016-08-10 14:12:25.698298 | 2016-08-10 14:12:25.698298 |       7 |             | 수유-모유
 23 | 수유패드   | 2016-08-10 14:12:25.681545 | 2016-08-10 14:12:25.681545 |       7 |             | 수유-모유
 22 | 수유브라   | 2016-08-10 14:12:25.677182 | 2016-08-10 14:12:25.677182 |       7 |             | 수유-모유
 21 | 수유복     | 2016-08-10 14:12:25.672055 | 2016-08-10 14:12:25.672055 |       7 |             | 수유-모유
 25 | 유두보호기 | 2016-08-10 14:12:25.694233 | 2016-08-10 14:12:25.694233 |       7 |             | 수유-모유
 20 | 수유쿠션   | 2016-08-10 14:12:25.668275 | 2016-08-10 14:12:25.668275 |       7 |             | 수유-모유
(10 rows)

pnm_development=# SELECT  "sub_menus".*, "menus".name FROM "sub_menus" INNER JOIN "menus" ON "menus"."id" = "sub_menus"."menu_id" WHERE (menus.category_id = 1)  ORDER BY menus.name collate "C" asc
 LIMIT 10 OFFSET 20;

 id |     name     |         created_at         |         updated_at         | menu_id | description |     name      
----+--------------+----------------------------+----------------------------+---------+-------------+---------------
 20 | 수유쿠션     | 2016-08-10 14:12:25.668275 | 2016-08-10 14:12:25.668275 |       7 |             | 수유-모유
 26 | 수유등       | 2016-08-10 14:12:25.698298 | 2016-08-10 14:12:25.698298 |       7 |             | 수유-모유
 19 | 유축기       | 2016-08-10 14:12:25.664174 | 2016-08-10 14:12:25.664174 |       7 |             | 수유-모유
 16 | 젖병소독기   | 2016-08-10 14:12:25.642145 | 2016-08-10 14:12:25.642145 |       6 |             | 수유-분유
 17 | 분유포트     | 2016-08-10 14:12:25.650437 | 2016-08-10 14:12:25.650437 |       6 |             | 수유-분유
 56 | 겉싸개       | 2016-08-29 13:41:40.355506 | 2016-08-29 13:41:40.363311 |      20 |             | 아기 의류
 55 | 속싸개       | 2016-08-29 13:41:29.740309 | 2016-08-29 13:41:29.748772 |      20 |             | 아기 의류
 33 | 기저귀정리함 | 2016-08-17 05:31:54.731063 | 2016-08-17 05:31:54.738381 |      12 |             | 아기가구
 34 | 아기수납장   | 2016-08-17 05:32:08.658293 | 2016-08-17 05:32:08.668742 |      12 |             | 아기가구
 39 | 힙시트       | 2016-08-17 05:33:23.976077 | 2016-08-17 05:33:23.983078 |      15 |             | 아기띠/힙시트
(10 rows)
</code></pre></div></div>

<p>문제가 되는 id 20번 record.</p>

<p>sql에서의 row 순서는 <code class="highlighter-rouge">ORDER BY</code>로 sort하지 않는 이상 정해져 있지 않다.<a href="http://stackoverflow.com/questions/15162593/postgresql-strange-collision-of-order-by-and-limit-offset">stackoverflow</a>
뭐가 나올지 알 수 없다는 말이네.</p>

<p>sub_menu에 대한 정렬을 추가해서 해결했다.</p>

<h3 id="after">after</h3>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>pnm_development=# SELECT  "sub_menus".*, "menus".name FROM "sub_menus" INNER JOIN "menus" ON "menus"."id" = "sub_menus"."menu_id" WHERE (menus.category_id = 1)  ORDER BY menus.name collate "C" asc, `sub_menus.name collate "C" asc LIMIT 10 OFFSET 10;

 id |    name    |         created_at         |         updated_at         | menu_id | description |        name         
----+------------+----------------------------+----------------------------+---------+-------------+---------------------
  6 | 물티슈     | 2016-08-10 14:12:25.575423 | 2016-08-10 14:12:25.575423 |       2 |             | 물티슈와 가제손수건
 49 | 바운서     | 2016-08-17 05:47:20.868362 | 2016-08-17 05:47:20.875056 |      16 |             | 바운서
 53 | 국산 분유  | 2016-08-29 06:54:39.305488 | 2016-08-29 06:54:39.315016 |      19 |             | 분유
 54 | 해외 분유  | 2016-08-29 06:54:54.123748 | 2016-08-29 06:54:54.130446 |      19 |             | 분유
 24 | 모유저장팩 | 2016-08-10 14:12:25.689986 | 2016-08-10 14:12:25.689986 |       7 |             | 수유-모유
 26 | 수유등     | 2016-08-10 14:12:25.698298 | 2016-08-10 14:12:25.698298 |       7 |             | 수유-모유
 21 | 수유복     | 2016-08-10 14:12:25.672055 | 2016-08-10 14:12:25.672055 |       7 |             | 수유-모유
 22 | 수유브라   | 2016-08-10 14:12:25.677182 | 2016-08-10 14:12:25.677182 |       7 |             | 수유-모유
 27 | 수유의자   | 2016-08-10 14:12:25.70253  | 2016-08-10 14:12:25.70253  |       7 |             | 수유-모유
 20 | 수유쿠션   | 2016-08-10 14:12:25.668275 | 2016-08-10 14:12:25.668275 |       7 |             | 수유-모유
(10 rows)

pnm_development=# SELECT  "sub_menus".*, "menus".name FROM "sub_menus" INNER JOIN "menus" ON "menus"."id" = "sub_menus"."menu_id" WHERE (menus.category_id = 1)  ORDER BY menus.name collate "C" asc, sub_menus.name collate "C" asc LIMIT 10 OFFSET 20;
 
 id |     name     |         created_at         |         updated_at         | menu_id | description |     name      
----+--------------+----------------------------+----------------------------+---------+-------------+---------------
 23 | 수유패드     | 2016-08-10 14:12:25.681545 | 2016-08-10 14:12:25.681545 |       7 |             | 수유-모유
 25 | 유두보호기   | 2016-08-10 14:12:25.694233 | 2016-08-10 14:12:25.694233 |       7 |             | 수유-모유
 19 | 유축기       | 2016-08-10 14:12:25.664174 | 2016-08-10 14:12:25.664174 |       7 |             | 수유-모유
 17 | 분유포트     | 2016-08-10 14:12:25.650437 | 2016-08-10 14:12:25.650437 |       6 |             | 수유-분유
 16 | 젖병소독기   | 2016-08-10 14:12:25.642145 | 2016-08-10 14:12:25.642145 |       6 |             | 수유-분유
 56 | 겉싸개       | 2016-08-29 13:41:40.355506 | 2016-08-29 13:41:40.363311 |      20 |             | 아기 의류
 55 | 속싸개       | 2016-08-29 13:41:29.740309 | 2016-08-29 13:41:29.748772 |      20 |             | 아기 의류
 33 | 기저귀정리함 | 2016-08-17 05:31:54.731063 | 2016-08-17 05:31:54.738381 |      12 |             | 아기가구
 34 | 아기수납장   | 2016-08-17 05:32:08.658293 | 2016-08-17 05:32:08.668742 |      12 |             | 아기가구
 38 | 아기띠       | 2016-08-17 05:33:14.93707  | 2016-08-17 05:33:14.942893 |      15 |             | 아기띠/힙시트
(10 rows)
</code></pre></div></div>

 -->
      </div>
    
      <div class="post">
        <h4 class="post-title">
          <a href="/dev/rails/2016/09/27/kakao-sdk-with-turbolink/">
            Turbolinks - Kakao sdk
          </a>
        </h4>
        <div class="post-description">
          <small><span class="post-date">27 Sep 2016</span></small>
        </div>
        <!-- <p>Codes Only.</p>

<p>kakao_story.js</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$(document).on("turbolinks:load", function (){
    if ( $('#kakaostory-share-button').length &gt; 0 ) {
        Kakao.Story.createShareButton({
      container: '#kakaostory-share-button'
    });
  }
});
</code></pre></div></div>

<p>application.html.erb</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;head&gt;
    &lt;%= render 'layouts/kakao-sdk' %&gt;
    ...
&lt;/head&gt;
&lt;body&gt;
    &lt;%= render 'layouts/kakao-sdk-init' %&gt;
    ...
</code></pre></div></div>

<p>_kakao-sdk-init.html.erb</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;script type='text/javascript'&gt;
  if ( typeof Kakao != "object") {
    Kakao.init(ENV["KAKAO-JS-KEY"]);
  }
&lt;/script&gt;
</code></pre></div></div>

<p>_kakao-sdk.html.erb</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;script src="//developers.kakao.com/sdk/js/kakao.min.js"&gt;&lt;/script&gt;
</code></pre></div></div>

 -->
      </div>
    
      <div class="post">
        <h4 class="post-title">
          <a href="/dev/rails/2016/09/23/omniauth/">
            Omniauth
          </a>
        </h4>
        <div class="post-description">
          <small><span class="post-date">23 Sep 2016</span></small>
        </div>
        <!-- <p>####Gemfile
<code class="highlighter-rouge">Omniauth-identity</code> 는 hash function으로 <code class="highlighter-rouge">bcrypt</code>를 이용합니다. Gemfile에 <code class="highlighter-rouge">bcrypt</code>도 추가해줍니다.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>gem 'omniauth'
gem 'omniauth-identity'
gem 'omniauth-kakao'
gem 'bcrypt',         '3.1.11'
</code></pre></div></div>

<h4 id="omniauth-초기화">Omniauth 초기화</h4>
<p>config/initializers/omniauth.rb
TODO: Rack middleware가 뭐지?
Omniauth가 좋은점이 authentication 이후에 그 정보를 어떻게 저장하고 보여주는지는 온전히 사용하는 사람의 몫으로 남겨져 있음.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Rails.application.config.middleware.use OmniAuth::Builder do
  provider :kakao, ENV['KAKAO_CLIENT_ID']
  provider :identity, on_failed_registration: lambda { |env|    
    SessionsController.action(:new).call(env)
  }
  
  # Enable to redirect a failure page in development mode
  OmniAuth.config.on_failure = Proc.new { |env|
    OmniAuth::FailureEndpoint.new(env).redirect_to_failure
  }

  # 또는 Redirect Path를 설정하고 싶다면(or if you want to customize your Redirect Path)
  # provider :kakao, ENV['KAKAO_CLIENT_ID'], {:redirect_path =&gt; ENV['REDIRECT_PATH']}
end
</code></pre></div></div>

<p>####[Before] users table schema
<code class="highlighter-rouge">has_secure_password</code> 를 이용해서 직접 User 모델에 authentication을 구현했었습니다.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>create_table "users", force: :cascade do |t|
  t.string   "name"
  t.boolean  "admin",           default: false
  t.datetime "created_at",                      null: false
  t.datetime "updated_at",                      null: false
  t.string   "email"
  t.string   "password_digest"
end
</code></pre></div></div>

<p>####Create Identity Model &amp; Migration
User 모델에서 authentication을 제거하고, 이메일을 이용한 Authentication을 위해 Identity 모델을 만듭니다.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>class RemoveEmailAndPasswordDigestFromUsers &lt; ActiveRecord::Migration
  def change
    remove_column :users, :email
    remove_column :users, :password_digest
  end
end

class AddProviderAndUidToUsers &lt; ActiveRecord::Migration
  def change
    add_column :users, :provider, :string
    add_index :users, :provider
    add_column :users, :uid, :integer
    add_index :users, :uid
  end
end

$ rails g model identity name:string email:string password_digest:string
</code></pre></div></div>

<p>app/controllers/sessions_controller.rb</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>def create
  auth = env["omniauth.auth"]
  user = User.find_or_create_from_omniauth(auth)
  log_in(user)
  
  if admin_user?
    redirect_to admin_path
  else
    redirect_to root_path
  end
end

def destroy
  log_out
  redirect_to root_url
end

def failure
  flash[:danger] = "로그인에 실패했습니다. 다시 시도해 주세요."
  redirect_to login_url
end
</code></pre></div></div>

<p>sessions_helper.rb</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>def log_in(user)
  session[:user_id] = user.id
end
def log_out
  session.delete(:user_id)
  @current_user = nil
end
</code></pre></div></div>

<p>app/models/user.rb
기존에 User 모델이 가진 validation을 지워줍니다. validation은 Identity 모델에 적용시킵니다.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>class User &lt; ActiveRecord::Base
  def self.find_or_create_from_omniauth(auth)
    find_by_provider_and_uid(auth["provider"], auth["uid"]) ||  create_with_omniauth(auth)
  end

  def self.create_with_omniauth(auth)
    create! do |user|
      user.provider = auth["provider"]
      user.uid = auth["uid"]
      user.name = auth["info"]["name"]
    end
  end
</code></pre></div></div>

<p>app/models/identities.rb</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>class Identity &lt; OmniAuth::Identity::Models::ActiveRecord
  before_save { self.email = email.downcase }
  validates :name, presence: true
  validates :email, presence: true, uniqueness: {case_sensitive: false}
end
</code></pre></div></div>

<p>route.rb</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>get 'login' =&gt; 'sessions#new'
post 'login' =&gt; 'sessions#create'
post "/auth/:provider/callback" =&gt; "sessions#create"  
get "/auth/:provider/callback" =&gt; "sessions#create"
get "/auth/failure" =&gt; "sessions#failure"
delete 'logout' =&gt; 'sessions#destroy'
resources :identities
</code></pre></div></div>

<p>app/views/sessions/new.html.erb</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;%= form_tag "/auth/identity/callback" do %&gt;
  &lt;div class="form-group"&gt;
    &lt;%= label_tag :auth_key, "이메일" %&gt;
    &lt;%= email_field_tag :auth_key, nil, class: 'form-control' %&gt;
  &lt;/div&gt;
  &lt;div class="form-group"&gt;
    &lt;%= label_tag :password, "비밀번호" %&gt;
    &lt;%= password_field_tag :password, nil, class: 'form-control' %&gt;
  &lt;/div&gt;
  &lt;%= submit_tag "로그인", class: "btn btn-default" %&gt;
  &lt;div class="pull-right"&gt;
    &lt;%= link_to "이메일로 가입하기", new_identity_path() %&gt;
  &lt;/div&gt;
&lt;% end %&gt;
</code></pre></div></div>

<p>app/views/identities/new.html.erb</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;%= form_tag "/auth/identity/register" do %&gt;
  &lt;% if @identity &amp;&amp; @identity.errors.any? %&gt;
    &lt;%= render partial: 'shared/error_messages', locals: {object: @identity} %&gt;
  &lt;% end %&gt;
  &lt;div class="form-group"&gt;
    &lt;%= label_tag :email, "이메일" %&gt;
    &lt;%= email_field_tag :email, @identity.try(:email), class: 'form-control' %&gt;
  &lt;/div&gt;
  &lt;div class="form-group"&gt;
    &lt;%= label_tag :name, "이름" %&gt;
    &lt;%= text_field_tag :name, @identity.try(:name), class: 'form-control' %&gt;
  &lt;/div&gt;
  &lt;div class="form-group"&gt;
    &lt;%= label_tag :password, "비밀번호" %&gt;
    &lt;%= password_field_tag :password, nil, class: 'form-control' %&gt;
  &lt;/div&gt;
  &lt;div class="form-group"&gt;
    &lt;%= label_tag :password_confirmation, "비밀번호 재입력" %&gt;
    &lt;%= password_field_tag :password_confirmation, nil, class: 'form-control' %&gt;
  &lt;/div&gt;
  &lt;%= submit_tag "가입하기", class: "btn btn-default" %&gt;
&lt;% end %&gt;
</code></pre></div></div>

<p>app/controllers/identities_controller.rb</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>class IdentitiesController &lt; ApplicationController
  def new
    @identity = env['omniauth.identity']
  end
end
</code></pre></div></div>

<p>https://github.com/omniauth/omniauth/wiki/FAQ#omniauthfailureendpoint-does-not-redirect-in-development-mode</p>

<p>http://railscasts.com/episodes/304-omniauth-identity?view=asciicast</p>
 -->
      </div>
    
      <div class="post">
        <h4 class="post-title">
          <a href="/dev/ruby/rails/2016/09/22/call-methods-only-if-exists/">
            tip - nil이 아닌경우에 method를 실행
          </a>
        </h4>
        <div class="post-description">
          <small><span class="post-date">22 Sep 2016</span></small>
        </div>
        <!-- <p>object가 nil이 아닌 경우에만 method를 실행하고 싶을 때가 있다.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>self.send(:method) if self.respond_to?(:method)
</code></pre></div></div>

<p>Rails에는 <code class="highlighter-rouge">.try()</code>가 있다.</p>

<hr />

<p><a href="http://stackoverflow.com/questions/15787610/call-method-only-if-it-exists">http://stackoverflow.com/questions/15787610/call-method-only-if-it-exists</a>
<a href="http://everydayrails.com/2011/04/28/rails-try-method.html">http://everydayrails.com/2011/04/28/rails-try-method.html</a></p>
 -->
      </div>
    
      <div class="post">
        <h4 class="post-title">
          <a href="/dev/rails/heroku/2016/09/21/Heroku-database-dump-out/">
            Heroku database로 local database 세팅하기
          </a>
        </h4>
        <div class="post-description">
          <small><span class="post-date">21 Sep 2016</span></small>
        </div>
        <!-- <h2 id="0codes-first">0.Codes first</h2>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>heroku pg:backups capture
curl -o latest.dump `heroku pg:backups public-url`
bin/rake db:reset
pg_restore --verbose --clean --no-acl --no-owner -h localhost -U myuser -d mydb latest.dump
</code></pre></div></div>

<h2 id="1-heroku-version-확인">1. Heroku version 확인</h2>
<p>legacy heroku gem을 사용하고 있다면, gem을 제거하고 Heroku CLI를 다시 설치해야 합니다.</p>

<ul>
  <li>legacy heroku gem 제거 : <code class="highlighter-rouge">gem uninstall heroku --all</code></li>
  <li>Heroku toolbelk 설치 <a href="https://devcenter.heroku.com/articles/heroku-command-line">https://devcenter.heroku.com/articles/heroku-command-line</a></li>
</ul>

<h2 id="2-heroku-db-dump-out">2. Heroku db dump-out</h2>

<p>CLI를 이용한 방법 (heroku version: 3.43.12)</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>heroku pg:backups capture

curl -o latest.dump `heroku pg:backups public-url`
</code></pre></div></div>

<p>heroku.com을 이용한 방법</p>

<ul>
  <li>visit <a href="https://postgres.heroku.com/databases">https://postgres.heroku.com/databases</a></li>
  <li>app의 database 선택</li>
  <li>PG Backups &gt; Capture &gt; Download</li>
</ul>

<h2 id="3-local-database-생성재생성">3. local database 생성/재생성</h2>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>bin/rake db:create

또는

bin/rake db:reset (기존 development db의 데이터는 삭제됩니다.)
</code></pre></div></div>

<h2 id="4-heroku-backup-db를-local-db에-복구시키기">4. Heroku backup db를 local db에 복구시키기</h2>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>pg_restore --verbose --clean --no-acl --no-owner -h localhost -U myuser -d mydb latest.dump
</code></pre></div></div>
 -->
      </div>
    
      <div class="post">
        <h4 class="post-title">
          <a href="/dev/rails/2016/09/17/rails-set-development-database-as-postgresql/">
            Development DB를 Postresql로 세팅
          </a>
        </h4>
        <div class="post-description">
          <small><span class="post-date">17 Sep 2016</span></small>
        </div>
        <!-- <p>pg install</p>
<ul>
  <li>http://postgresapp.com/</li>
</ul>

<p>pg user 확인
psql
\du : 유저 리스트
\l : database 리스트
\connect [database_name]
\dt : 연결된 database의 table 리스트</p>

<p>Gemfile</p>
<ul>
  <li>gme ‘pg’</li>
</ul>

<p>datbase.yml</p>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="ss">development:
  adapter: </span><span class="n">postgresql</span>
  <span class="ss">encoding: </span><span class="n">unicode</span>
  <span class="ss">database: </span><span class="n">pnm_development</span>
  <span class="ss">pool: </span><span class="mi">5</span>
  <span class="ss">timeout: </span><span class="mi">5000</span></code></pre></figure>

<p>Console</p>
<ul>
  <li>bin/rake db:create
or</li>
  <li>bin/rake db:reset</li>
</ul>

<p>Heroku dump db를 local에 import
pg_restore –verbose –clean –no-acl –no-owner -h localhost -U myuser -d pnm_development latest.dump</p>

<p>https://devcenter.heroku.com/articles/heroku-postgres-import-export#restore-to-local-database</p>
 -->
      </div>
    
      <div class="post">
        <h4 class="post-title">
          <a href="/dev/rails/2016/09/13/Rails4-nested-form/">
            Rails4 - nested form
          </a>
        </h4>
        <div class="post-description">
          <small><span class="post-date">13 Sep 2016</span></small>
        </div>
        <!-- <ul>
  <li><code class="highlighter-rouge">육아는 아이템전</code>을 만들면서 사용한 nested form에 대해 정리해 둔다.</li>
  <li>Parenting_neees_money에서 각 Item은 여러개의 keyword를 가지고 있고, keyword는 여러개의 data 로그를 가지고 있다.</li>
</ul>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby">    <span class="k">class</span> <span class="nc">Item</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span>
        <span class="n">has_many</span> <span class="ss">:keywords</span><span class="p">,</span> <span class="ss">dependent: :destroy</span>
    <span class="k">end</span>

    <span class="k">class</span> <span class="nc">Keyword</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span>
        <span class="n">belongs_to</span> <span class="ss">:item</span>
        <span class="n">has_many</span> <span class="ss">:logs</span><span class="p">,</span> <span class="ss">dependent: :destroy</span>
    <span class="k">end</span>

    <span class="k">class</span> <span class="nc">Logs</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span>
        <span class="n">belongs_to</span> <span class="ss">:keyword</span>
    <span class="k">end</span>
    </code></pre></figure>

<ul>
  <li>Item을 추가하는 form에서 keyword도 추가하고 싶고, keyword에 대한 log도 3rd party api를 통해 가져와서 생성해야 했다.</li>
  <li>Rails에서는 form에 association을 위한 field를 만들 수 있다.</li>
  <li>우선 <code class="highlighter-rouge">Item</code> model에 <code class="highlighter-rouge">accepts_nested_attributes_for :keywords, allow_destroy: true</code> 를 추가한다.</li>
</ul>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby">    <span class="k">class</span> <span class="nc">Item</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span>
        <span class="n">has_many</span> <span class="ss">:keywords</span><span class="p">,</span> <span class="ss">dependent: :destroy</span>
        <span class="n">accepts_nested_attributes_for</span> <span class="ss">:keywords</span><span class="p">,</span> <span class="ss">allow_destroy: </span><span class="kp">true</span>
    <span class="k">end</span>
    </code></pre></figure>

<ul>
  <li><code class="highlighter-rouge">accepts_nested_attributes_for :keywords</code> 는 <code class="highlighter-rouge">keywords_attributes=</code> method를 추가시켜준다.</li>
  <li>기본적으로 create/update가 가능하고 <code class="highlighter-rouge">allow_destroy: true</code> option을 통해서 destroy도 가능하게 할 수 있다.</li>
  <li>이제 strong parameter에서 <code class="highlighter-rouge">keywords_attributes</code>를 허용시켜주면 item.create 또는 item.udpate_attributes method를 통해 Keyword 를 create/update 할 수 있게 된다.</li>
</ul>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby">    <span class="k">class</span> <span class="nc">ItemsController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>
    <span class="kp">private</span>

      <span class="k">def</span> <span class="nf">item_params</span>
        <span class="n">params</span><span class="p">.</span><span class="nf">require</span><span class="p">(</span><span class="ss">:item</span><span class="p">).</span><span class="nf">permit</span><span class="p">(</span><span class="ss">keywords_attributes: </span><span class="p">[</span><span class="ss">:id</span><span class="p">,</span> <span class="ss">:name</span><span class="p">,</span> <span class="s1">'_destroy'</span><span class="p">)</span>
      <span class="k">end</span>
    <span class="k">end</span>    
    </code></pre></figure>

<ul>
  <li><code class="highlighter-rouge">allow_destroy: true</code> 옵션을 사용하려면 strong parameter에 <code class="highlighter-rouge">id, _destroy</code> 를 허용시켜 줘야 한다.</li>
  <li><code class="highlighter-rouge">_destroy</code>의 값은 <code class="highlighter-rouge">marked_for_destruction?</code> 값에 대입되고, 해당 값이 <code class="highlighter-rouge">true</code>이면, item object가 <code class="highlighter-rouge">save</code> 될 때, Keyword record가 삭제된다.</li>
  <li><code class="highlighter-rouge">accepts_nested_attributes_for</code> 는 원하는 만큼 depth를 만들 수 있다.</li>
  <li>Item form을 통해서 Keywrod, Log record를 만들어야 되기에 Keyword model에도 accepts_nested_attributes_for를 추가해준다.</li>
</ul>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby">    <span class="k">class</span> <span class="nc">Keyword</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span>
        <span class="n">has_many</span> <span class="ss">:logs</span><span class="p">,</span> <span class="ss">dependent: :destroy</span>
        <span class="n">accepts_nested_attributes_for</span> <span class="ss">:logs</span>
    <span class="k">end</span>
    </code></pre></figure>

<ul>
  <li>이제 Keyword model에 <code class="highlighter-rouge">logs_attributes=</code> method가 추가되었다.</li>
  <li>Item controller의 strong parameter에 logs_attributes를 추가로 허용해 준다.</li>
</ul>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby">    <span class="k">class</span> <span class="nc">ItemsController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>
      <span class="kp">private</span>

      <span class="k">def</span> <span class="nf">item_params</span>
        <span class="n">params</span><span class="p">.</span><span class="nf">require</span><span class="p">(</span><span class="ss">:item</span><span class="p">).</span><span class="nf">permit</span><span class="p">(</span><span class="ss">keywords_attributes: </span><span class="p">[</span><span class="ss">:id</span><span class="p">,</span> <span class="ss">:name</span><span class="p">,</span> <span class="s1">'_destroy'</span><span class="p">,</span> <span class="ss">logs_attributes: </span><span class="p">[</span><span class="ss">:count</span><span class="p">,</span> <span class="ss">:log_date</span><span class="p">]]))</span>
      <span class="k">end</span>
    <span class="k">end</span>        
    </code></pre></figure>

<ul>
  <li><code class="highlighter-rouge">app/views/items/edit.html.erb</code> 에 keyword field를 추가한다.</li>
</ul>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby">    <span class="o">&lt;</span><span class="sx">%= form_for @item do |f| %&gt;
    ...
    &lt;%=</span> <span class="n">f</span><span class="p">.</span><span class="nf">fields_for</span> <span class="ss">:keywords</span><span class="p">,</span> <span class="ss">:wrapper</span> <span class="o">=&gt;</span> <span class="kp">false</span> <span class="k">do</span> <span class="o">|</span><span class="n">builder</span><span class="o">|</span> <span class="sx">%&gt;
      &lt;%= render 'keyword_fields', f: builder %&gt;</span>
    <span class="o">&lt;</span><span class="sx">% end </span><span class="o">%&gt;</span>
    </code></pre></figure>

<ul>
  <li><code class="highlighter-rouge">:wrapper =&gt; false </code>는 기본적으로 생성되는 <code class="highlighter-rouge">&lt;div class="fields"&gt;</code> 를 없애준다.
    <ul>
      <li>table 내부에 추가할 때는 이 옵션을 사용한다.<a href="https://github.com/ryanb/nested_form/wiki/How-To:-Render-nested-fields-inside-a-table">참고</a></li>
    </ul>
  </li>
  <li><code class="highlighter-rouge">app/views/items/_keyword_fields.html.erb</code></li>
</ul>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby">    <span class="o">&lt;</span><span class="sx">%= f.text_field :name %&gt;
    &lt;%=</span> <span class="n">link_to_add_log</span> <span class="n">f</span><span class="p">,</span> <span class="nb">object_id</span> <span class="sx">%&gt;
    &lt;%= f.hidden_field :_destroy %&gt;</span>
    <span class="o">&lt;</span><span class="sx">%= link_to "remove", "#", class: "remove_keyword" %&gt;
    </span></code></pre></figure>

<ul>
  <li>remove link를 클릭하면 javascript로 hidden_field인 <code class="highlighter-rouge">_destroy</code>의 값을 <code class="highlighter-rouge">1</code>로 세팅하고 해당 form을 보이지 않게한다. <code class="highlighter-rouge">app/assets/javascripts/items.js</code></li>
</ul>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript">    <span class="nx">$</span><span class="p">(</span><span class="nb">document</span><span class="p">).</span><span class="nx">on</span><span class="p">(</span><span class="s2">"turbolinks:load"</span><span class="p">,</span> <span class="kd">function</span><span class="p">(){</span>
        <span class="nx">$</span><span class="p">(</span><span class="s2">"form"</span><span class="p">).</span><span class="nx">on</span><span class="p">(</span><span class="s2">"click"</span><span class="p">,</span> <span class="s2">".remove_keyword"</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">event</span><span class="p">){</span>
            <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">prev</span><span class="p">(</span><span class="s1">'input[type=hidden]'</span><span class="p">).</span><span class="nx">val</span><span class="p">(</span><span class="s1">'1'</span><span class="p">);</span>
            <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">closest</span><span class="p">(</span><span class="s1">'tr'</span><span class="p">).</span><span class="nx">hide</span><span class="p">();</span>
            <span class="nx">event</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">();</span>
        <span class="p">});</span>
    <span class="p">});</span>
    </code></pre></figure>

<ul>
  <li><code class="highlighter-rouge">app/helpers/items_helper.rb</code>에 <code class="highlighter-rouge">link_to_add_log</code> 메소드를 추가했다. Log는 해당 keyword에 대해 3rd party API를 통해 얻은 data를 기록한다.</li>
</ul>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby">    <span class="k">module</span> <span class="nn">ItemsHelper</span>
      <span class="k">def</span> <span class="nf">link_to_add_log</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
        <span class="n">new_object</span> <span class="o">=</span> <span class="no">Log</span><span class="p">.</span><span class="nf">new</span>
        <span class="nb">id</span> <span class="o">=</span> <span class="n">new_object</span><span class="p">.</span><span class="nf">object_id</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="n">f</span><span class="p">.</span><span class="nf">fields_for</span><span class="p">(</span><span class="ss">:logs</span><span class="p">,</span> <span class="n">new_object</span><span class="p">,</span> <span class="ss">child_index: </span><span class="nb">id</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">builder</span><span class="o">|</span>
            <span class="n">render</span><span class="p">(</span><span class="s2">"log_field"</span><span class="p">,</span> <span class="ss">f: </span><span class="n">builder</span><span class="p">)</span>
        <span class="k">end</span>
        <span class="n">link_to</span><span class="p">(</span><span class="s2">"Add Log"</span><span class="p">,</span> <span class="s1">'#'</span><span class="p">,</span> <span class="ss">class: </span><span class="s2">"update_nsa_data"</span><span class="p">,</span> <span class="ss">data: </span><span class="p">{</span><span class="ss">id: </span><span class="nb">id</span><span class="p">,</span> <span class="ss">fields: </span><span class="n">fields</span><span class="p">.</span><span class="nf">gsub</span><span class="p">(</span><span class="s2">"</span><span class="se">\n</span><span class="s2">"</span><span class="p">,</span> <span class="s2">""</span><span class="p">)})</span>
      <span class="k">end</span>
    <span class="k">end</span>
    </code></pre></figure>

<ul>
  <li>미리 <em>Log</em> form을 <code class="highlighter-rouge">Add Log</code> 링크의 data attribute에 추가시켜둔다. javscript로 해당 링크를 클릭했을 때, data attribute에 있는 form을 dom에 붙여준다.</li>
  <li><code class="highlighter-rouge">child_index: id</code>로 keyword의 id가 아닌 <em>Log</em> instance의 id를 사용하게 한다. id는 임의로 object_id를 사용하고, 실제 <code class="highlighter-rouge">Add Log</code> 링크를 눌러 <em>Log</em> form이 추가될 때, javascript 를 이용, 시간에 의해 생성된 unique id로 바꿔준다.</li>
  <li><code class="highlighter-rouge">app/views/items/_log_field.html.erb</code></li>
</ul>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby">    <span class="o">&lt;</span><span class="sx">%= f.text_field :nmc %&gt;
    &lt;%=</span> <span class="n">f</span><span class="p">.</span><span class="nf">text_field</span> <span class="ss">:npc</span> <span class="o">%&gt;</span>
    <span class="o">&lt;</span><span class="sx">%= f.text_field :log_date %&gt;
    </span></code></pre></figure>

<ul>
  <li><code class="highlighter-rouge">app/assests/javascripts/items.js</code></li>
</ul>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript">    <span class="nx">$</span><span class="p">(</span><span class="s1">'form'</span><span class="p">).</span><span class="nx">on</span><span class="p">(</span><span class="s1">'click'</span><span class="p">,</span> <span class="s1">'.update_nsa_data'</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">){</span>
        <span class="kd">var</span> <span class="nx">update_btn</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">)</span>
        <span class="nx">event</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">();</span>
        <span class="c1">// add new nsa_dat form</span>
        <span class="kd">var</span> <span class="nx">time</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">().</span><span class="nx">getTime</span><span class="p">();</span>
        <span class="kd">var</span> <span class="nx">regexp</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">RegExp</span><span class="p">(</span><span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">data</span><span class="p">(</span><span class="s1">'id'</span><span class="p">),</span> <span class="s1">'g'</span><span class="p">);</span>
        <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">after</span><span class="p">(</span><span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">data</span><span class="p">(</span><span class="s1">'fields'</span><span class="p">).</span><span class="nx">replace</span><span class="p">(</span><span class="nx">regexp</span><span class="p">,</span> <span class="nx">time</span><span class="p">));</span>

        <span class="c1">// get 3rd party data and fill in input fields</span>
    <span class="p">});</span>
    </code></pre></figure>

<hr />

<p><a href="https://github.com/rails/rails/blob/master/activerecord/lib/active_record/nested_attributes.rb">Rails github - nested_attributes.rb</a>
<a href="http://railscasts.com/episodes/196-nested-model-form-revised?view=asciicast">RailsCast 196-nested-model-form</a></p>

 -->
      </div>
    
      <div class="post">
        <h4 class="post-title">
          <a href="/dev/rails/2016/09/10/user-login/">
            Rails4 User Login - 처음부터
          </a>
        </h4>
        <div class="post-description">
          <small><span class="post-date">10 Sep 2016</span></small>
        </div>
        <!-- <ul>
  <li>[Michael Hartl의 Rails tutorial][railstutorial] 에 나온 user login 기능 부분을 정리해 본다.</li>
  <li>User model 생성
    <ul>
      <li><code class="highlighter-rouge">rails generate model User name:string email:string</code></li>
      <li></li>
    </ul>
  </li>
  <li>Validation 추가</li>
</ul>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby">		<span class="k">class</span> <span class="nc">User</span> <span class="o">&lt;</span> <span class="no">ApplicationRecord</span>
		  <span class="n">before_save</span> <span class="p">{</span> <span class="n">email</span><span class="p">.</span><span class="nf">downcase!</span> <span class="p">}</span>
		  <span class="n">validates</span> <span class="ss">:name</span><span class="p">,</span> <span class="ss">presence: </span><span class="kp">true</span><span class="p">,</span> <span class="ss">length: </span><span class="p">{</span> <span class="ss">maximum: </span><span class="mi">50</span> <span class="p">}</span>
		  <span class="no">VALID_EMAIL_REGEX</span> <span class="o">=</span> <span class="sr">/\A[\w+\-.]+@[a-z\d\-.]+\.[a-z]+\z/i</span>
		  <span class="n">validates</span> <span class="ss">:email</span><span class="p">,</span> <span class="ss">presence: </span><span class="kp">true</span><span class="p">,</span> <span class="ss">length: </span><span class="p">{</span> <span class="ss">maximum: </span><span class="mi">255</span> <span class="p">},</span>
		                    <span class="ss">format: </span><span class="p">{</span> <span class="ss">with: </span><span class="no">VALID_EMAIL_REGEX</span> <span class="p">},</span>
		                    <span class="ss">uniqueness: </span><span class="p">{</span> <span class="ss">case_sensitive: </span><span class="kp">false</span> <span class="p">}</span>
		<span class="k">end</span>
	</code></pre></figure>

<ul>
  <li>Email에 대해 index 추가
    <ul>
      <li><code class="highlighter-rouge">rails generate migration add_index_to_users_email</code></li>
      <li></li>
    </ul>
  </li>
</ul>
<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby">		<span class="k">class</span> <span class="nc">AddIndexToUsersEmail</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Migration</span><span class="p">[</span><span class="mf">5.0</span><span class="p">]</span>
		  <span class="k">def</span> <span class="nf">change</span>
		    <span class="n">add_index</span> <span class="ss">:users</span><span class="p">,</span> <span class="ss">:email</span><span class="p">,</span> <span class="ss">unique: </span><span class="kp">true</span>
		  <span class="k">end</span>
		<span class="k">end</span>
	</code></pre></figure>

<ul>
  <li>Password 추가(1)
    <ul>
      <li>User 모델에 <code class="highlighter-rouge">has_secure_password</code> 추가
        <ul>
          <li>method는 hashed password를 password_digest라는 attribute에 저장하도록 해준다.</li>
          <li>password 와 password_confirmation 두 virtual attributes를 사용하게 한다.</li>
          <li><code class="highlighter-rouge">authenticate</code> method로  password가 맞는지 틀린지 알 수 있다.</li>
        </ul>
      </li>
    </ul>
  </li>
</ul>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby">        <span class="k">class</span> <span class="nc">User</span> <span class="o">&lt;</span> <span class="no">ApplicationRecord</span>
          <span class="p">.</span>
          <span class="nf">.</span>
          <span class="p">.</span>
          <span class="nf">has_secure_password</span>
        <span class="k">end</span>
    </code></pre></figure>

<ul>
  <li>Password 추가(2)
    <ul>
      <li>password_digest attribute 추가
        <ul>
          <li><code class="highlighter-rouge">$ rails generate migration add_password_digest_to_users password_digest:string</code></li>
        </ul>
      </li>
      <li><code class="highlighter-rouge">Gemfile</code> 에 bcrypt 추가
        <ul>
          <li><code class="highlighter-rouge">has_secure_password</code>에서 <code class="highlighter-rouge">bcrypt</code> hash function을 이용한다.</li>
          <li></li>
        </ul>
      </li>
    </ul>
  </li>
</ul>
<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby">			<span class="n">gem</span> <span class="s1">'bcrypt'</span><span class="p">,</span>         <span class="s1">'3.1.11'</span>
		</code></pre></figure>

<ul>
  <li>Password validation 추가
    <ul>
      <li>최소 길이 6자
        <ul>
          <li><code class="highlighter-rouge">validates :password, presence: true, length: { minimum: 6 }</code></li>
          <li></li>
        </ul>
      </li>
    </ul>
  </li>
  <li>Route.rb에 routing 추가
    <ul>
      <li><code class="highlighter-rouge">resources :users</code></li>
    </ul>
  </li>
  <li>User Controller(1)
    <ul>
      <li><code class="highlighter-rouge">rails generate controller Users</code></li>
      <li><code class="highlighter-rouge">new</code> method
        <ul>
          <li></li>
        </ul>
      </li>
    </ul>
  </li>
</ul>
<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby">            <span class="k">def</span> <span class="nf">new</span>
                <span class="vi">@user</span> <span class="o">=</span> <span class="no">User</span><span class="p">.</span><span class="nf">new</span>
            <span class="k">end</span>
        </code></pre></figure>

<ul>
  <li>User Controller(2)
    <ul>
      <li><code class="highlighter-rouge">new.html.erb</code> 에 form 추가
        <ul>
          <li></li>
        </ul>
      </li>
    </ul>
  </li>
</ul>
<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby">        <span class="o">&lt;</span><span class="sx">%= form_for(@user) do |f| %&gt;
          &lt;%=</span> <span class="n">f</span><span class="p">.</span><span class="nf">label</span> <span class="ss">:name</span> <span class="o">%&gt;</span>
          <span class="o">&lt;</span><span class="sx">%= f.text_field :name %&gt;

          &lt;%=</span> <span class="n">f</span><span class="p">.</span><span class="nf">label</span> <span class="ss">:email</span> <span class="o">%&gt;</span>
          <span class="o">&lt;</span><span class="sx">%= f.email_field :email %&gt;

          &lt;%=</span> <span class="n">f</span><span class="p">.</span><span class="nf">label</span> <span class="ss">:password</span> <span class="o">%&gt;</span>
          <span class="o">&lt;</span><span class="sx">%= f.password_field :password %&gt;

          &lt;%=</span> <span class="n">f</span><span class="p">.</span><span class="nf">label</span> <span class="ss">:password_confirmation</span><span class="p">,</span> <span class="s2">"Confirmation"</span> <span class="o">%&gt;</span>
          <span class="o">&lt;</span><span class="sx">%= f.password_field :password_confirmation %&gt;

          &lt;%=</span> <span class="n">f</span><span class="p">.</span><span class="nf">submit</span> <span class="s2">"Create my account"</span><span class="p">,</span> <span class="ss">class: </span><span class="s2">"btn btn-primary"</span> <span class="o">%&gt;</span>
        <span class="o">&lt;</span><span class="sx">% end </span><span class="o">%&gt;</span>
        </code></pre></figure>

<ul>
  <li>User Controller(3)
  +<code class="highlighter-rouge">strong parameter</code> 추가</li>
</ul>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby">         <span class="kp">private</span>

            <span class="k">def</span> <span class="nf">user_params</span>
              <span class="n">params</span><span class="p">.</span><span class="nf">require</span><span class="p">(</span><span class="ss">:user</span><span class="p">).</span><span class="nf">permit</span><span class="p">(</span><span class="ss">:name</span><span class="p">,</span> <span class="ss">:email</span><span class="p">,</span> <span class="ss">:password</span><span class="p">,</span>
                                           <span class="ss">:password_confirmation</span><span class="p">)</span>
            <span class="k">end</span>
        </code></pre></figure>

<ul>
  <li>User Controller(4)
    <ul>
      <li><code class="highlighter-rouge">create</code> method</li>
    </ul>
  </li>
</ul>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby">          <span class="k">def</span> <span class="nf">create</span>
            <span class="vi">@user</span> <span class="o">=</span> <span class="no">User</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="n">user_params</span><span class="p">)</span>
            <span class="k">if</span> <span class="vi">@user</span><span class="p">.</span><span class="nf">save</span>
              <span class="n">flash</span><span class="p">[</span><span class="ss">:success</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"Welcome to the Sample App!"</span>
              <span class="n">redirect_to</span> <span class="vi">@user</span>
            <span class="k">else</span>
              <span class="n">render</span> <span class="s1">'new'</span>
            <span class="k">end</span>
          <span class="k">end</span>
        </code></pre></figure>

<ul>
  <li>User Controller(5)
    <ul>
      <li><code class="highlighter-rouge">new.html.erb</code> 에 error message 추가</li>
    </ul>
  </li>
</ul>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby">        <span class="o">&lt;</span><span class="sx">%= form_for(@user) do |f| %&gt;
            &lt;%=</span> <span class="n">render</span> <span class="s1">'shared/error_messages'</span> <span class="o">%&gt;</span>
        </code></pre></figure>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby">        <span class="c1">#_error_messages.html.erb</span>
        <span class="o">&lt;</span><span class="sx">% if </span><span class="vi">@user</span><span class="p">.</span><span class="nf">errors</span><span class="p">.</span><span class="nf">any?</span> <span class="sx">%&gt;
          &lt;div id="error_explanation"&gt;</span>
            <span class="o">&lt;</span><span class="n">div</span> <span class="k">class</span><span class="o">=</span><span class="s2">"alert alert-danger"</span><span class="o">&gt;</span>
              <span class="no">The</span> <span class="n">form</span> <span class="n">contains</span> <span class="o">&lt;</span><span class="sx">%= pluralize(@user.errors.count, "error") %&gt;.
            &lt;/div&gt;
            &lt;ul&gt;
            &lt;% @user.errors.full_messages.each do |msg| %&gt;
              &lt;li&gt;&lt;%=</span> <span class="n">msg</span> <span class="sx">%&gt;&lt;/li&gt;</span>
            <span class="o">&lt;</span><span class="sx">% end </span><span class="o">%&gt;</span>
            <span class="o">&lt;</span><span class="sr">/ul&gt;
          &lt;/</span><span class="n">div</span><span class="o">&gt;</span>
        <span class="o">&lt;</span><span class="sx">% end </span><span class="o">%&gt;</span>
        </code></pre></figure>

<ul>
  <li>proudction 환경에서 SSL 추가
    <ul>
      <li>Heroku domain(appname.herokuapp.com)에서는 별도의 SSL setting이 필요없음.</li>
    </ul>
  </li>
</ul>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby">        <span class="no">Rails</span><span class="p">.</span><span class="nf">application</span><span class="p">.</span><span class="nf">configure</span> <span class="k">do</span>
          <span class="c1"># Force all access to the app over SSL, use Strict-Transport-Security,</span>
          <span class="c1"># and use secure cookies.</span>
          <span class="n">config</span><span class="p">.</span><span class="nf">force_ssl</span> <span class="o">=</span> <span class="kp">true</span>
        <span class="k">end</span>
    </code></pre></figure>

<ul>
  <li>Session Controller(1)
    <ul>
      <li><code class="highlighter-rouge"> rails generate controller Sessions new</code></li>
    </ul>
  </li>
  <li>Session Controller(2)
    <ul>
      <li>Router에 log-in 관련 routing 추가</li>
    </ul>
  </li>
</ul>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby">            <span class="n">get</span>    <span class="s1">'/login'</span><span class="p">,</span>   <span class="ss">to: </span><span class="s1">'sessions#new'</span>
            <span class="n">post</span>   <span class="s1">'/login'</span><span class="p">,</span>   <span class="ss">to: </span><span class="s1">'sessions#create'</span>
            <span class="n">delete</span> <span class="s1">'/logout'</span><span class="p">,</span>  <span class="ss">to: </span><span class="s1">'sessions#destroy'</span>
        </code></pre></figure>

<ul>
  <li>Session Controller(3)
    <ul>
      <li><code class="highlighter-rouge">/sessions/new.html.erb</code> 에 log-in form 추가</li>
    </ul>
  </li>
</ul>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby">        <span class="o">&lt;</span><span class="sx">%= form_for(:session, url: login_path) do |f| %&gt;

          &lt;%=</span> <span class="n">f</span><span class="p">.</span><span class="nf">label</span> <span class="ss">:email</span> <span class="o">%&gt;</span>
          <span class="o">&lt;</span><span class="sx">%= f.email_field :email, class: 'form-control' %&gt;

          &lt;%=</span> <span class="n">f</span><span class="p">.</span><span class="nf">label</span> <span class="ss">:password</span> <span class="o">%&gt;</span>
          <span class="o">&lt;</span><span class="sx">%= f.password_field :password, class: 'form-control' %&gt;

          &lt;%=</span> <span class="n">f</span><span class="p">.</span><span class="nf">submit</span> <span class="s2">"Log in"</span><span class="p">,</span> <span class="ss">class: </span><span class="s2">"btn btn-primary"</span> <span class="o">%&gt;</span>
        <span class="o">&lt;</span><span class="sx">% end </span><span class="o">%&gt;</span>
        </code></pre></figure>

<ul>
  <li>Session Controller(4)
    <ul>
      <li><code class="highlighter-rouge">create</code> method
        <ul>
          <li><code class="highlighter-rouge">flash.now</code> 는 <code class="highlighter-rouge">flash</code>와 다르게 추가적인 reqeust가 있을 시 사라짐.</li>
        </ul>
      </li>
    </ul>
  </li>
</ul>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby">        <span class="k">def</span> <span class="nf">create</span>
            <span class="n">user</span> <span class="o">=</span> <span class="no">User</span><span class="p">.</span><span class="nf">find_by</span><span class="p">(</span><span class="ss">email: </span><span class="n">params</span><span class="p">[</span><span class="ss">:session</span><span class="p">][</span><span class="ss">:email</span><span class="p">].</span><span class="nf">downcase</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">user</span> <span class="o">&amp;&amp;</span> <span class="n">user</span><span class="p">.</span><span class="nf">authenticate</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="ss">:session</span><span class="p">][</span><span class="ss">:password</span><span class="p">])</span>
              <span class="c1"># Log the user in and redirect to the user's show page.</span>
            <span class="k">else</span>
              <span class="n">flash</span><span class="p">.</span><span class="nf">now</span><span class="p">[</span><span class="ss">:danger</span><span class="p">]</span> <span class="o">=</span> <span class="s1">'Invalid email/password combination'</span> <span class="c1"># Not quite right!</span>
              <span class="n">render</span> <span class="s1">'new'</span>
            <span class="k">end</span>
          <span class="k">end</span>
        </code></pre></figure>

<ul>
  <li>ApplicationController에 SessionHelper 추가</li>
</ul>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby">    <span class="k">class</span> <span class="nc">ApplicationController</span> <span class="o">&lt;</span> <span class="no">ActionController</span><span class="o">::</span><span class="no">Base</span>
      <span class="n">protect_from_forgery</span> <span class="ss">with: :exception</span>
      <span class="kp">include</span> <span class="no">SessionsHelper</span>
    <span class="k">end</span>
    </code></pre></figure>

<ul>
  <li><code class="highlighter-rouge">app/helpers/sessions_helper.rb</code></li>
</ul>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby">    <span class="k">module</span> <span class="nn">SessionsHelper</span>

        <span class="c1"># Logs in the given user.</span>
        <span class="k">def</span> <span class="nf">log_in</span><span class="p">(</span><span class="n">user</span><span class="p">)</span>
            <span class="n">session</span><span class="p">[</span><span class="ss">:user_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">user</span><span class="p">.</span><span class="nf">id</span>
        <span class="k">end</span>
        <span class="c1"># Returns the current logged-in user (if any).</span>
        <span class="k">def</span> <span class="nf">current_user</span>
            <span class="vi">@current_user</span> <span class="o">||=</span> <span class="no">User</span><span class="p">.</span><span class="nf">find_by</span><span class="p">(</span><span class="ss">id: </span><span class="n">session</span><span class="p">[</span><span class="ss">:user_id</span><span class="p">])</span>
        <span class="k">end</span>
        <span class="k">def</span> <span class="nf">logged_in?</span>
            <span class="o">!</span><span class="n">current_user</span><span class="p">.</span><span class="nf">nil?</span>
        <span class="k">end</span>
          <span class="c1"># Logs out the current user.</span>
        <span class="k">def</span> <span class="nf">log_out</span>
            <span class="n">session</span><span class="p">.</span><span class="nf">delete</span><span class="p">(</span><span class="ss">:user_id</span><span class="p">)</span>
            <span class="vi">@current_user</span> <span class="o">=</span> <span class="kp">nil</span>
        <span class="k">end</span>
    <span class="k">end</span>
    </code></pre></figure>

<ul>
  <li>Session Controller(5)
    <ul>
      <li><code class="highlighter-rouge">create</code> method에 login 추가</li>
    </ul>
  </li>
</ul>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby">    <span class="k">def</span> <span class="nf">create</span>
        <span class="n">user</span> <span class="o">=</span> <span class="no">User</span><span class="p">.</span><span class="nf">find_by</span><span class="p">(</span><span class="ss">email: </span><span class="n">params</span><span class="p">[</span><span class="ss">:session</span><span class="p">][</span><span class="ss">:email</span><span class="p">].</span><span class="nf">downcase</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">user</span> <span class="o">&amp;&amp;</span> <span class="n">user</span><span class="p">.</span><span class="nf">authenticate</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="ss">:session</span><span class="p">][</span><span class="ss">:password</span><span class="p">])</span>
          <span class="n">log_in</span> <span class="n">user</span>
          <span class="n">redirect_to</span> <span class="n">user</span>
        <span class="k">else</span>
          <span class="n">flash</span><span class="p">.</span><span class="nf">now</span><span class="p">[</span><span class="ss">:danger</span><span class="p">]</span> <span class="o">=</span> <span class="s1">'Invalid email/password combination'</span>
          <span class="n">render</span> <span class="s1">'new'</span>
        <span class="k">end</span>
      <span class="k">end</span>
    </code></pre></figure>

<ul>
  <li>Session Controller(6)
    <ul>
      <li><code class="highlighter-rouge">destroy</code> method에 logout 추가</li>
    </ul>
  </li>
</ul>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby">    <span class="k">def</span> <span class="nf">destroy</span>
        <span class="n">log_out</span>
        <span class="n">redirect_to</span> <span class="n">root_url</span>
    <span class="k">end</span>
    </code></pre></figure>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>+  [railstutorial]: https://www.railstutorial.org/book/_single-page
</code></pre></div></div>
 -->
      </div>
    
      <div class="post">
        <h4 class="post-title">
          <a href="/dev/rails/google%20analytics/2016/09/09/turbolinks-google-analytics/">
            Turbolinks & Google analytics
          </a>
        </h4>
        <div class="post-description">
          <small><span class="post-date">09 Sep 2016</span></small>
        </div>
        <!-- <p>Turbolink는 AJAX로 <code class="highlighter-rouge">&lt;body&gt;</code> tag내 컨텐츠만 바꿔서 page loading time을 줄여준다.
GA는 page load시 마다 서버로 pageview 데이터를 전달하기 때문에 Turbolink를 사용하면 ajax로 이동한 page에 대해서는 GA로 분석 할 수 없다.</p>

<p><code class="highlighter-rouge">turbolinks:load</code> 이벤트가 발생될 때 마다 GA로 pageview를 보내는 javascript code를 추가해서 해결할 수 있다.</p>

<p>application.html.erb</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;head&gt;
  &lt;%= render 'layouts/google_analytics' %&gt;
&lt;/head&gt;
</code></pre></div></div>

<p>laytouts/_google_analytics.html.erb</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="o">&lt;%</span> <span class="k">if</span> <span class="nx">Rails</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">production</span><span class="p">?</span> <span class="o">%&gt;</span>
  <span class="o">&lt;</span><span class="nx">script</span><span class="o">&gt;</span>
    <span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">i</span><span class="p">,</span><span class="nx">s</span><span class="p">,</span><span class="nx">o</span><span class="p">,</span><span class="nx">g</span><span class="p">,</span><span class="nx">r</span><span class="p">,</span><span class="nx">a</span><span class="p">,</span><span class="nx">m</span><span class="p">){</span><span class="nx">i</span><span class="p">[</span><span class="s1">'GoogleAnalyticsObject'</span><span class="p">]</span><span class="o">=</span><span class="nx">r</span><span class="p">;</span><span class="nx">i</span><span class="p">[</span><span class="nx">r</span><span class="p">]</span><span class="o">=</span><span class="nx">i</span><span class="p">[</span><span class="nx">r</span><span class="p">]</span><span class="o">||</span><span class="kd">function</span><span class="p">(){</span>
    <span class="p">(</span><span class="nx">i</span><span class="p">[</span><span class="nx">r</span><span class="p">].</span><span class="nx">q</span><span class="o">=</span><span class="nx">i</span><span class="p">[</span><span class="nx">r</span><span class="p">].</span><span class="nx">q</span><span class="o">||</span><span class="p">[]).</span><span class="nx">push</span><span class="p">(</span><span class="kr">arguments</span><span class="p">)},</span><span class="nx">i</span><span class="p">[</span><span class="nx">r</span><span class="p">].</span><span class="nx">l</span><span class="o">=</span><span class="mi">1</span><span class="o">*</span><span class="k">new</span> <span class="nb">Date</span><span class="p">();</span><span class="nx">a</span><span class="o">=</span><span class="nx">s</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="nx">o</span><span class="p">),</span>
    <span class="nx">m</span><span class="o">=</span><span class="nx">s</span><span class="p">.</span><span class="nx">getElementsByTagName</span><span class="p">(</span><span class="nx">o</span><span class="p">)[</span><span class="mi">0</span><span class="p">];</span><span class="nx">a</span><span class="p">.</span><span class="k">async</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span><span class="nx">a</span><span class="p">.</span><span class="nx">src</span><span class="o">=</span><span class="nx">g</span><span class="p">;</span><span class="nx">m</span><span class="p">.</span><span class="nx">parentNode</span><span class="p">.</span><span class="nx">insertBefore</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span><span class="nx">m</span><span class="p">)</span>
    <span class="p">})(</span><span class="nb">window</span><span class="p">,</span><span class="nb">document</span><span class="p">,</span><span class="s1">'script'</span><span class="p">,</span><span class="s1">'https://www.google-analytics.com/analytics.js'</span><span class="p">,</span><span class="s1">'ga'</span><span class="p">);</span>

    <span class="nx">ga</span><span class="p">(</span><span class="s1">'create'</span><span class="p">,</span> <span class="s1">'XX-XXXXXXXX-X'</span><span class="p">,</span> <span class="s1">'auto'</span><span class="p">);</span>
    <span class="nx">ga</span><span class="p">(</span><span class="s1">'send'</span><span class="p">,</span> <span class="s1">'pageview'</span><span class="p">);</span>
  <span class="o">&lt;</span><span class="sr">/script</span><span class="err">&gt;
</span>
<span class="o">&lt;%</span> <span class="k">else</span> <span class="o">%&gt;</span>
  <span class="o">&lt;</span><span class="nx">script</span><span class="o">&gt;</span>
    <span class="kd">function</span> <span class="nx">ga</span> <span class="p">()</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">params</span> <span class="o">=</span> <span class="nb">Array</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">slice</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="kr">arguments</span><span class="p">,</span> <span class="nx">ga</span><span class="p">.</span><span class="nx">length</span><span class="p">);</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">"GoogleAnalytics: "</span> <span class="o">+</span> <span class="nx">params</span><span class="p">);</span>
    <span class="p">};</span>
  <span class="o">&lt;</span><span class="sr">/script</span><span class="err">&gt;
</span><span class="o">&lt;%</span> <span class="nx">end</span> <span class="o">%&gt;</span></code></pre></figure>

<p>app/assets/javascripts/google_analytics.js.coffee</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nb">document</span><span class="p">.</span><span class="nx">addEventListener</span> <span class="s2">"turbolinks:load"</span><span class="p">,</span> <span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="o">-&gt;</span>
  <span class="k">if</span> <span class="k">typeof</span> <span class="nx">ga</span> <span class="nx">is</span> <span class="s2">"function"</span>
  <span class="nx">ga</span><span class="p">(</span><span class="s2">"set"</span><span class="p">,</span> <span class="s2">"location"</span><span class="p">,</span> <span class="nx">event</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">url</span><span class="p">)</span>
  <span class="nx">ga</span><span class="p">(</span><span class="s2">"send"</span><span class="p">,</span> <span class="s2">"pageview"</span><span class="p">)</span></code></pre></figure>

<hr />
<p><a href="https://sheharyar.me/blog/using-google-analytics-in-rails-4-with-turbolinks/">credit: sheharyar</a></p>

<p><a href="http://stackoverflow.com/questions/18945464/rails-4-turbolinks-with-google-analytics/25050377#25050377">credit: scottwb</a></p>
 -->
      </div>
    
      <div class="post">
        <h4 class="post-title">
          <a href="/dev/rails/2016/08/28/turbolinks-load-event/">
            document ready & Turbolinks
          </a>
        </h4>
        <div class="post-description">
          <small><span class="post-date">28 Aug 2016</span></small>
        </div>
        <!-- <ul>
  <li>turbolink 5 기준이다.
    <ul>
      <li><code class="highlighter-rouge">$(document).ready</code> 를 <code class="highlighter-rouge">$(document).on("turbolinks:load",</code> 로 바꿔주면 된다.</li>
      <li>turbolink github에 관련 내용 <a href="https://github.com/turbolinks/turbolinks#running-javascript-when-a-page-loads">링크</a></li>
    </ul>
  </li>
  <li><a href="http://railscasts.com/episodes/390-turbolinks">railscast</a>를 보니 이전 버전에서는 <code class="highlighter-rouge">$(document).on("page:load",</code> 를 추가해야 되었나보다.</li>
</ul>

 -->
      </div>
    
      <div class="post">
        <h4 class="post-title">
          <a href="/dev/rails/2016/08/25/rails-active-model-serializer/">
            Tips - Rails(레일즈) active model serializer
          </a>
        </h4>
        <div class="post-description">
          <small><span class="post-date">25 Aug 2016</span></small>
        </div>
        <!-- <ul>
  <li>Active record를 사용한다면, <code class="highlighter-rouge">.as_json only:</code> 로 원하는 attribute만 json으로 만들 수 있다.</li>
</ul>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby">  <span class="no">Item</span><span class="p">.</span><span class="nf">first</span><span class="p">.</span><span class="nf">as_json</span> <span class="ss">only: </span><span class="p">[</span><span class="ss">:id</span><span class="p">,</span> <span class="ss">:name</span><span class="p">]</span>
  <span class="o">=&gt;</span> <span class="p">{</span><span class="s2">"id"</span> <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">"name"</span> <span class="o">=&gt;</span> <span class="s2">"abcde"</span><span class="p">}</span>
  </code></pre></figure>

<ul>
  <li>
    <p>Attribute를 조합해서 새로운 data를 만들어야 된다면, <code class="highlighter-rouge">active_model_serializer</code>를 사용하자.</p>
  </li>
  <li>
    <p>초기 세팅은 <a href="https://github.com/rails-api/active_model_serializers">active model serializer github</a> 참고</p>
  </li>
</ul>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby">    <span class="k">class</span> <span class="nc">TaskSerializer</span> <span class="o">&lt;</span> <span class="no">ActiveModel</span><span class="o">::</span><span class="no">Serializer</span>
        <span class="k">def</span> <span class="nf">Date</span> 
            <span class="n">object</span><span class="p">.</span><span class="nf">completed_at</span><span class="p">.</span><span class="nf">strftime</span><span class="p">(</span><span class="s2">"%Y-%m-%d"</span><span class="p">)</span>
        <span class="k">end</span>
        <span class="n">attributes</span> <span class="ss">:Date</span>
    <span class="k">end</span>
    </code></pre></figure>

<ul>
  <li>serializer class에 원하는 data를 return하는 method를 만들고, <code class="highlighter-rouge">attributes</code>로 선언해주면, 해당 data를 가진 json을 serializer로 만들 수 있다.</li>
</ul>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby">    <span class="n">render</span> <span class="ss">json: </span><span class="vi">@task</span>
  </code></pre></figure>

<ul>
  <li><code class="highlighter-rouge">render</code> 이외에서 json data를 만들 수도 있다.</li>
</ul>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby">        <span class="vi">@data</span> <span class="o">=</span> <span class="no">ActiveModel</span><span class="o">::</span><span class="no">ArraySerializer</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="no">Task</span><span class="p">.</span><span class="nf">completed</span><span class="p">,</span> <span class="ss">each_serializer: </span><span class="no">TaskSerializer</span><span class="p">).</span><span class="nf">to_json</span>
        <span class="n">or</span>
        <span class="vi">@datum</span> <span class="o">=</span> <span class="no">TaskSerializer</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="no">Task</span><span class="p">.</span><span class="nf">first</span><span class="p">).</span><span class="nf">to_json</span>
    </code></pre></figure>

<ul>
  <li><code class="highlighter-rouge">root: false</code> option을 사용하면 model_name으로 된 key를 없앨 수 있다.</li>
</ul>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby">      <span class="n">render</span> <span class="vi">@item</span>
      <span class="o">==&gt;</span> <span class="p">{</span><span class="ss">item: </span><span class="p">[</span><span class="o">~~~</span><span class="p">]}</span>

      <span class="n">render</span> <span class="vi">@item</span><span class="p">,</span> <span class="ss">root: </span><span class="kp">false</span>
      <span class="o">==&gt;</span> <span class="p">{[</span><span class="o">~~~</span><span class="p">]}</span>
    </code></pre></figure>

<ul>
  <li>천자리구분점을 위해 <code class="highlighter-rouge">number_with_delimeter</code>를 사용할 필요가 있다면, helper module을 include해준다.</li>
</ul>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby">    <span class="kp">include</span> <span class="no">ActionView</span><span class="o">::</span><span class="no">Helpers</span><span class="o">::</span><span class="no">NumberHelper</span>
    </code></pre></figure>

<ul>
  <li><code class="highlighter-rouge">active model serializer</code>는 0.9버전과 0.10버전이 호환되지 않는다. 사용하는 버전에 맞는 api 문서를 참고하자.</li>
</ul>

<hr />
<p>Reference</p>
<ul>
  <li><a href="https://github.com/rails-api/active_model_serializers/tree/0-9-stable">active model serializer 0.9 api</a></li>
  <li><a href="http://stackoverflow.com/questions/5176718/how-to-use-the-number-to-currency-helper-method-in-the-model-rather-than-view">stack overflow - How to use the “number_to_currency” helper method in the model rather than view?</a></li>
  <li></li>
</ul>
 -->
      </div>
    
      <div class="post">
        <h4 class="post-title">
          <a href="/dev/rails/bootstrap/2016/08/21/initial-settings-rails-bootstrap/">
            Rails(레일즈) bootstrap 세팅.
          </a>
        </h4>
        <div class="post-description">
          <small><span class="post-date">21 Aug 2016</span></small>
        </div>
        <!-- <p><a href="https://github.com/twbs/bootstrap-sass">bootstrap-sass</a> gem 초기 세팅 과정이다.</p>

<p><strong>Stylesheets</strong></p>

<ul>
  <li>application.css를 application.scss로 바꾼다.</li>
  <li>application.scss에 추가.</li>
</ul>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby">    <span class="vi">@import</span> <span class="s2">"bootstrap-sprockets"</span><span class="p">;</span>
    <span class="vi">@import</span> <span class="s2">"bootstrap"</span><span class="p">;</span>  
  </code></pre></figure>

<ul>
  <li>application.css에 있었던 require문 제거</li>
</ul>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby">    <span class="o">*=</span> <span class="n">require_self</span>
    <span class="o">*=</span> <span class="n">require_tree</span> <span class="o">.</span>
  </code></pre></figure>

<p><strong>Javascripts</strong></p>

<ul>
  <li>application.js에 추가.</li>
</ul>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby">    <span class="sr">//</span><span class="o">=</span> <span class="nb">require</span> <span class="n">jquery</span>
    <span class="sr">//</span><span class="o">=</span> <span class="nb">require</span> <span class="n">bootstrap</span><span class="o">-</span><span class="n">sprockets</span>
  </code></pre></figure>
 -->
      </div>
    
      <div class="post">
        <h4 class="post-title">
          <a href="/dev/rails/2016/08/20/rails-scope/">
            Rails(레일즈) scope
          </a>
        </h4>
        <div class="post-description">
          <small><span class="post-date">20 Aug 2016</span></small>
        </div>
        <!-- <ul>
  <li><code class="highlighter-rouge">scope</code>은 자주 사용하는 query를 method형태로 사용 할 수 있게 해준다.</li>
  <li><code class="highlighter-rouge">scope</code>은 <code class="highlighter-rouge">def self.</code> class method와 같다.</li>
  <li>argument를 넘겨 줄 수도 있다.
    <ul>
      <li><code class="highlighter-rouge">scope :created_before, -&gt;(time) { where("created_at &lt; ?", time) }</code></li>
    </ul>
  </li>
  <li><code class="highlighter-rouge">AND</code> 컨디션으로 여러 개의 scope을 합칠 수도 있다.</li>
</ul>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby">    <span class="k">class</span> <span class="nc">User</span> <span class="o">&lt;</span> <span class="no">ApplicationRecord</span>
    <span class="err">  </span><span class="n">scope</span> <span class="ss">:active</span><span class="p">,</span> <span class="o">-&gt;</span> <span class="p">{</span> <span class="n">where</span> <span class="ss">state: </span><span class="s1">'active'</span> <span class="p">}</span>
    <span class="err">  </span><span class="n">scope</span> <span class="ss">:inactive</span><span class="p">,</span> <span class="o">-&gt;</span> <span class="p">{</span> <span class="n">where</span> <span class="ss">state: </span><span class="s1">'inactive'</span> <span class="p">}</span>
    <span class="k">end</span>
<span class="err"> </span>
    <span class="no">User</span><span class="p">.</span><span class="nf">active</span><span class="p">.</span><span class="nf">inactive</span>
    <span class="c1"># SELECT "users".* FROM "users" WHERE "users"."state" = 'active' AND "users"."state" = 'inactive'</span>
    </code></pre></figure>

<ul>
  <li><code class="highlighter-rouge">OR</code> 컨디션은 Rails4 기준으로 없다.
    <ul>
      <li>Rails5에 <code class="highlighter-rouge">.or</code>이 추가된다.</li>
      <li>Rails4에서는 <code class="highlighter-rouge">.arel_table</code>을 사용한다.</li>
    </ul>
  </li>
</ul>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby">            <span class="n">t</span> <span class="o">=</span> <span class="no">Task</span><span class="p">.</span><span class="nf">arel_table</span>
            <span class="no">Task</span><span class="p">.</span><span class="nf">where</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="ss">:complete</span><span class="p">].</span><span class="nf">eq</span><span class="p">(</span><span class="kp">true</span><span class="p">).</span><span class="nf">or</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="ss">:complete</span><span class="p">].</span><span class="nf">eq</span><span class="p">(</span><span class="kp">false</span><span class="p">))</span>
        </code></pre></figure>

 -->
      </div>
    
      <div class="post">
        <h4 class="post-title">
          <a href="/dev/rails/2016/08/20/rails-guard/">
            테스트 자동화 - guard
          </a>
        </h4>
        <div class="post-description">
          <small><span class="post-date">20 Aug 2016</span></small>
        </div>
        <!-- <h3 id="guard">Guard</h3>

<p><code class="highlighter-rouge">Gemfile</code></p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  group :test do
    gem 'guard-rspec'
  end
</code></pre></div></div>

<p><code class="highlighter-rouge">bundle exec guard init rspec</code></p>

<p><code class="highlighter-rouge">Guardfile</code></p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code># Note: The cmd option is now required due to the increasing number of ways
#       rspec may be run, below are examples of the most common uses.
#  * bundler: 'bundle exec rspec'
#  * bundler binstubs: 'bin/rspec'
#  * spring: 'bin/rspec' (This will use spring if running and you have
#                          installed the spring binstubs per the docs)
#  * zeus: 'zeus rspec' (requires the server to be started separately)
#  * 'just' rspec: 'rspec'    

guard :rspec, cmd: "zeus rspec" do
  require "guard/rspec/dsl"
  dsl = Guard::RSpec::Dsl.new(self)

  # RSpec files
  rspec = dsl.rspec
  watch(rspec.spec_helper) { rspec.spec_dir }
  watch(rspec.spec_support) { rspec.spec_dir }
  watch(rspec.spec_files)

  # Ruby files
  ruby = dsl.ruby
  dsl.watch_spec_files_for(ruby.lib_files)

  # Rails files
  rails = dsl.rails(view_extensions: %w(erb haml slim))
  dsl.watch_spec_files_for(rails.app_files)
  dsl.watch_spec_files_for(rails.views)

  watch(rails.controllers) do |m|
    [
      rspec.spec.call("routing/#{m[1]}_routing"),
      rspec.spec.call("controllers/#{m[1]}_controller"),
      rspec.spec.call("acceptance/#{m[1]}")
    ]
  end

  # Rails config changes
  watch(rails.spec_helper)     { rspec.spec_dir }
  watch(rails.routes)          { "#{rspec.spec_dir}/routing" }
  watch(rails.app_controller)  { "#{rspec.spec_dir}/controllers" }

  # Capybara features specs
  watch(rails.view_dirs)     { |m| rspec.spec.call("features/#{m[1]}") }
  watch(rails.layouts)       { |m| rspec.spec.call("features/#{m[1]}") }

  # Turnip features and steps
  watch(%r{^spec/acceptance/(.+)\.feature$})
  watch(%r{^spec/acceptance/steps/(.+)_steps\.rb$}) do |m|
    Dir[File.join("**/#{m[1]}.feature")][0] || "spec/acceptance"
  end
end
</code></pre></div></div>

<p><code class="highlighter-rouge">.gitignore</code></p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>/Spring
</code></pre></div></div>

<hr />

 -->
      </div>
    
      <div class="post">
        <h4 class="post-title">
          <a href="/dev/rails/2016/08/19/nil-empty-blank-present/">
            nil?, empty?, blank? 그리고 present?
          </a>
        </h4>
        <div class="post-description">
          <small><span class="post-date">19 Aug 2016</span></small>
        </div>
        <!-- <ul>
  <li><code class="highlighter-rouge">item.comment</code>가 존재하는지를 <code class="highlighter-rouge">.empty?</code>를 통해 확인했다.</li>
  <li><code class="highlighter-rouge">item.comment</code>가 <code class="highlighter-rouge">nil</code>인 경우에 exception이 발생한다.</li>
  <li>nil?, empty?는 ruby에서 제공한다.</li>
  <li>blank?, present?는 rails에서 제공한다.</li>
  <li>자세한 내용은 <a href="http://stackoverflow.com/questions/885414/a-concise-explanation-of-nil-v-empty-v-blank-in-ruby-on-rails">stackoverflow</a>를 참고.</li>
</ul>
 -->
      </div>
    
      <div class="post">
        <h4 class="post-title">
          <a href="/dev/rails/2016/08/19/import-css-in-scss/">
            Sass 파일에서 css 파일 import
          </a>
        </h4>
        <div class="post-description">
          <small><span class="post-date">19 Aug 2016</span></small>
        </div>
        <!-- <ul>
  <li><code class="highlighter-rouge">@import 'style.css'</code> 라고 어딘가에서 찾았고, development 환경에서는 문제없이 import된다.</li>
  <li>style.css는 lib/assets/stylesheets 에 위치해 있다.</li>
  <li>production 환경에서는 style.css에서 RoutingError가 발생했다.</li>
  <li>이유는 잘모르겠지만, <code class="highlighter-rouge">@import 'style'</code>로 바꾸니, development/production 환경에서 문제없이 import된다.</li>
  <li><code class="highlighter-rouge">@import</code>는 sass 문법이다.
    <ul>
      <li>sass guide를 찾아보니, @import 뒤에 파일명만 쓰면된다. 확장자는 필요없다.</li>
    </ul>
  </li>
  <li><code class="highlighter-rouge">@import 'style'</code>은 app/assets/stylesheets/, lib/assets/stylesheets/, vendor/assets/stylesheets/ 폴더에서 style.scss, style.sass, style.css 파일을 찾는다.</li>
</ul>

<p><a href="http://sass-lang.com/guide">Sass guide</a></p>
 -->
      </div>
    
      <div class="post">
        <h4 class="post-title">
          <a href="/dev/rails/2016/08/13/integration-test/">
            Rails Integration Test
          </a>
        </h4>
        <div class="post-description">
          <small><span class="post-date">13 Aug 2016</span></small>
        </div>
        <!-- <ul>
  <li><code class="highlighter-rouge">rails g integration_test &lt;NAME&gt;</code></li>
  <li>`get <path>, <params_hash>
</params_hash></path>    <ul>
      <li>get search_path, search: “keyword1”</li>
    </ul>
  </li>
  <li>Testing XHR (AJAX) requests</li>
</ul>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby">    <span class="nb">test</span> <span class="s2">"ajax request"</span> <span class="k">do</span>
      <span class="n">article</span> <span class="o">=</span> <span class="n">articles</span><span class="p">(</span><span class="ss">:one</span><span class="p">)</span>
      <span class="n">get</span> <span class="n">article_url</span><span class="p">(</span><span class="n">article</span><span class="p">),</span> <span class="ss">xhr: </span><span class="kp">true</span>
      <span class="n">assert_equal</span> <span class="s1">'hello world'</span><span class="p">,</span> <span class="vi">@response</span><span class="p">.</span><span class="nf">body</span>
      <span class="n">assert_equal</span> <span class="s2">"text/javascript"</span><span class="p">,</span> <span class="vi">@response</span><span class="p">.</span><span class="nf">content_type</span>
  <span class="k">end</span>
  </code></pre></figure>

<ul>
  <li>
    <h2 id="model-생성--삭제--변경없음-확인">Model 생성 / 삭제 / 변경없음 확인</h2>
  </li>
</ul>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby">  <span class="n">assert_difference</span> <span class="s1">'Model.count'</span> <span class="k">do</span>
    <span class="n">post</span> <span class="o">---</span>
  <span class="k">end</span>
  </code></pre></figure>

<ul>
  <li><code class="highlighter-rouge">.reload</code> DB의 값을 다시 읽어옴</li>
</ul>

<hr />
<p>참고링크</p>

<ul>
  <li><a href="https://robots.thoughtbot.com/how-we-test-rails-applications">How We test Rails Application</a></li>
  <li><a href="http://edgeguides.rubyonrails.org/testing.html#testing-xhr-ajax-requests">Rails guide </a></li>
</ul>
 -->
      </div>
    
      <div class="post">
        <h4 class="post-title">
          <a href="/dev/rails/2016/08/13/fast-test-with-guard-and-zeus/">
            빠른 테스트 - Guard & Zeus
          </a>
        </h4>
        <div class="post-description">
          <small><span class="post-date">13 Aug 2016</span></small>
        </div>
        <!-- <h3 id="zeus--guard"><a href="https://github.com/burke/zeus">Zeus</a> &amp; <a href="https://github.com/guard/guard">Guard</a></h3>

<p>zeus는 rails app을 미리 로딩해 두어서, test 실행 마다 로딩에 걸리는 시간을 줄일 수 있습니다.</p>

<p>guard는 파일이 변경되는 것을 인지해서, 변경된 spec 파일의 test suits만 실행시켜줍니다.</p>

<p>guard 설정은 <a href="/dev/rails/2016/08/20/rails-guard/">테스트 자동화 - guard</a>를 참고하세요.</p>

<p><code class="highlighter-rouge">Gemfile</code></p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>group :development, :test do
  gem 'zeus'
end
</code></pre></div></div>

<p><code class="highlighter-rouge">Zeus 설치 &amp; 시작</code></p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>zeus start
</code></pre></div></div>

<p><code class="highlighter-rouge">GuardFile 수정</code></p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>guard :rspec, cmd: "zeus rspec" do
...
</code></pre></div></div>

<p><code class="highlighter-rouge">Guard 시작</code></p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>guard
</code></pre></div></div>

<hr />

<p><a href="http://railscasts.com/episodes/413-fast-tests">RailsCasts</a></p>

 -->
      </div>
    
      <div class="post">
        <h4 class="post-title">
          <a href="/dev/rails/2016/08/11/naver-searchad-api-ruby/">
            Ruby - Naver 검색광고 API
          </a>
        </h4>
        <div class="post-description">
          <small><span class="post-date">11 Aug 2016</span></small>
        </div>
        <!-- <ul>
  <li>API Access License 와 Secret Key를 발급받자. (<a href="https://manage.searchad.naver.com/">네이버 검색광고</a> 에 들어가 도구 &gt; API 사용관리)</li>
  <li>Header에 다음을 추가해야 한다.
    <ul>
      <li>X-Timestamp</li>
      <li>X-API-KEY</li>
      <li>X-Customer</li>
      <li>X-Signature</li>
    </ul>
  </li>
</ul>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby">  <span class="nb">require</span> <span class="s1">'net/http'</span>
  <span class="o">...</span>

  <span class="n">service_url</span> <span class="o">=</span> <span class="s2">"https://api.naver.com"</span>
  <span class="n">uri</span> <span class="o">=</span> <span class="no">URI</span><span class="p">.</span><span class="nf">parse</span><span class="p">(</span><span class="n">service_url</span><span class="p">)</span>
  <span class="n">req</span> <span class="o">=</span> <span class="no">Net</span><span class="o">::</span><span class="no">HTTP</span><span class="o">::</span><span class="no">Get</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="n">uri</span><span class="p">)</span>
  <span class="n">http</span> <span class="o">=</span> <span class="no">Net</span><span class="o">::</span><span class="no">HTTP</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="n">uri</span><span class="p">.</span><span class="nf">host</span><span class="p">,</span> <span class="n">uri</span><span class="p">.</span><span class="nf">port</span><span class="p">)</span>
  <span class="n">http</span><span class="p">.</span><span class="nf">use_ssl</span> <span class="o">=</span> <span class="p">(</span><span class="n">uri</span><span class="p">.</span><span class="nf">scheme</span> <span class="o">==</span> <span class="s1">'https'</span><span class="p">)</span>
  <span class="n">res</span> <span class="o">=</span> <span class="n">http</span><span class="p">.</span><span class="nf">request</span><span class="p">(</span><span class="n">req</span><span class="p">)</span>
  <span class="nb">puts</span> <span class="n">res</span><span class="p">.</span><span class="nf">body</span>
  </code></pre></figure>

<ul>
  <li>X-Signature은 Secret Key를 이용 아래 data를 sha256-hmac 으로 인코딩해야 한다.
    <ul>
      <li><code class="highlighter-rouge">data</code> = <code class="highlighter-rouge">Milliseconds since Unix Epoch</code> + <code class="highlighter-rouge">'.'</code> + <code class="highlighter-rouge">http method</code> + <code class="highlighter-rouge">'.'</code> + <code class="highlighter-rouge">request_uri</code></li>
    </ul>
  </li>
</ul>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby">  <span class="nb">require</span> <span class="s1">'Base64'</span>
  <span class="nb">require</span> <span class="s1">'openssl'</span>
  <span class="o">...</span>

  <span class="n">ms_since_epoch</span> <span class="o">=</span> <span class="p">(</span><span class="no">Time</span><span class="p">.</span><span class="nf">now</span><span class="p">.</span><span class="nf">to_f</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">).</span><span class="nf">floor</span>
  <span class="n">data</span> <span class="o">=</span> <span class="n">ms_since_epoch</span><span class="p">.</span><span class="nf">to_s</span> <span class="o">+</span> <span class="s1">'.'</span> <span class="o">+</span> <span class="n">http_method</span> <span class="o">+</span> <span class="s1">'.'</span> <span class="o">+</span> <span class="n">api_path</span>
  <span class="n">digest</span> <span class="o">=</span> <span class="no">OpenSSL</span><span class="o">::</span><span class="no">Digest</span><span class="o">::</span><span class="no">Digest</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="s1">'sha256'</span><span class="p">)</span>
  <span class="n">signature</span> <span class="o">=</span> <span class="no">Base64</span><span class="p">.</span><span class="nf">encode64</span><span class="p">(</span><span class="no">OpenSSL</span><span class="o">::</span><span class="no">HMAC</span><span class="p">.</span><span class="nf">digest</span><span class="p">(</span><span class="n">digest</span><span class="p">,</span> <span class="n">secret_key</span><span class="p">,</span> <span class="n">data</span><span class="p">)).</span><span class="nf">strip</span>
  </code></pre></figure>

<ul>
  <li>parameter를 추가해서 원하는 API 결과를 얻자.</li>
</ul>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby">  <span class="n">uri</span> <span class="o">=</span> <span class="no">URI</span><span class="p">.</span><span class="nf">parse</span><span class="p">(</span><span class="s2">"https://api.naver.com/keywordstool"</span><span class="p">)</span>
  <span class="n">params</span> <span class="o">=</span> <span class="p">{</span><span class="ss">showDetail: </span><span class="s2">"1"</span><span class="p">,</span> <span class="ss">hintKeywords: </span><span class="no">Keywords</span><span class="p">.</span><span class="nf">join</span><span class="p">(</span><span class="s2">","</span><span class="p">)}</span>
  <span class="n">uri</span><span class="p">.</span><span class="nf">query</span> <span class="o">=</span> <span class="no">URI</span><span class="p">.</span><span class="nf">encode_www_form</span><span class="p">(</span> <span class="n">params</span> <span class="p">)</span>
  <span class="n">req</span> <span class="o">=</span> <span class="no">Net</span><span class="o">::</span><span class="no">HTTP</span><span class="o">::</span><span class="no">Get</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="n">uri</span><span class="p">)</span>
  </code></pre></figure>

<ul>
  <li>X-Timestamp의 값은 Signature 생성시 ms_since_epoch과 같은 값이어야 된다.</li>
  <li>(update)
    <ul>
      <li>다른 mac에서 아래 에러가 난다.</li>
    </ul>
  </li>
</ul>

<figure class="highlight"><pre><code class="language-text" data-lang="text">    .../ruby/2.3.0/net/http.rb:933:in `connect_nonblock': SSL_connect returned=1 errno=0 state=error: certificate verify failed (OpenSSL::SSL::SSLError)
    </code></pre></figure>

<ul>
  <li>왜 이런지 모르겠다. <a href="http://mislav.net/2013/07/ruby-openssl/">Googling 결과</a>는 state=SSLv3 인 에러에 대한 얘기다.</li>
  <li>우선은 아래와 같이 땜질을 해서 넘어가자.</li>
</ul>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby">      <span class="n">http</span><span class="p">.</span><span class="nf">verify_mode</span> <span class="o">=</span> <span class="no">OpenSSL</span><span class="o">::</span><span class="no">SSL</span><span class="o">::</span><span class="no">VERIFY_NONE</span>
     </code></pre></figure>

<hr />
<p>참고링크</p>

<ul>
  <li><a href="https://help.shopify.com/api/tutorials/webhooks#verify-webhook">Spotify verify webhook tutorial</a></li>
  <li><a href="https://github.com/naver/searchad-apidoc">Naver 검색광고 document</a></li>
</ul>
 -->
      </div>
    
      <div class="post">
        <h4 class="post-title">
          <a href="/dev/rails/2016/07/29/carrierwave-video-thumbnailer/">
            Carrierwave video thumbnailer
          </a>
        </h4>
        <div class="post-description">
          <small><span class="post-date">29 Jul 2016</span></small>
        </div>
        <!-- <p>video tag의 poster attribute에 동영상이 재생되기 전에 보이는 이미지를 정해 줄 수 있다.
w3school에서 poster attribute를 설정하지 않으면 동영상의 첫 frame이 사용된다고 했는데, Chrome에서는 이미지가 뜨지않았다.</p>

<p><a href="https://github.com/evrone/carrierwave-video-thumbnailer">carrierwave-video-thumbnailer gem</a>을 이용해서 간단히 poster attribute 용 이미지를 만들었다.</p>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">class</span> <span class="nc">MediaUploader</span> <span class="o">&lt;</span> <span class="no">CarrierWave</span><span class="o">::</span><span class="no">Uploader</span><span class="o">::</span><span class="no">Base</span>
  <span class="kp">include</span> <span class="no">CarrierWave</span><span class="o">::</span><span class="no">Video</span><span class="o">::</span><span class="no">Thumbnailer</span>

  <span class="n">version</span> <span class="ss">:thumb</span> <span class="k">do</span>
    <span class="n">process_extensions</span> <span class="no">VIDEO_EXTENSIONS</span><span class="p">,</span>
                        <span class="ss">thumbnail: </span><span class="p">[{</span><span class="ss">format: </span><span class="s1">'png'</span><span class="p">,</span>
                                    <span class="ss">quality: </span><span class="mi">5</span><span class="p">,</span>
                                    <span class="ss">size: </span><span class="mi">400</span><span class="p">,</span>
                                    <span class="ss">strip: </span><span class="kp">false</span><span class="p">,</span>
                                    <span class="ss">logger: </span><span class="no">Rails</span><span class="p">.</span><span class="nf">logger</span><span class="p">}]</span>

    <span class="k">def</span> <span class="nf">full_filename</span> <span class="n">for_file</span>
      <span class="n">png_name</span> <span class="n">for_file</span><span class="p">,</span> <span class="n">version_name</span>
    <span class="k">end</span>
  <span class="k">end</span></code></pre></figure>

<p><code class="highlighter-rouge">thumb</code>이라는 버전으로 만들어 두었다. 쓸 때는 <code class="highlighter-rouge">&lt;Model&gt;.media.thumb.url</code> 으로 사용하면 된다.</p>

<ul>
  <li>heroku에 ffmpegthumbnailer 설치 *
<code class="highlighter-rouge">carrierwave-video-thumbnailer gem</code>은 <code class="highlighter-rouge">ffmpegthumbnailer</code>을 이용한다.
Heroku로 배포시 buildpack 형태로 설치해줘야 한다.
buildpack은 <a href="https://elements.heroku.com/buildpacks/akomic/heroku-buildpack-ffmpegthumbnailer">Heroku Element</a>에서 검색해서 사용하면 편리하다.</li>
</ul>

<hr />
<p><small>참고링크</small></p>

<p><small><a href="/dev/heroku/2016/07/25/Heroku-multi-build-packs/">Heroku multi-buildpack 사용하기</a></small></p>

 -->
      </div>
    
      <div class="post">
        <h4 class="post-title">
          <a href="/dev/rails/2016/07/21/repopulate-non-model-form-field/">
            model이 없는 form의 입력을 validation 이후에도 유지하기.
          </a>
        </h4>
        <div class="post-description">
          <small><span class="post-date">21 Jul 2016</span></small>
        </div>
        <!-- <p>Rails는 많은 일을 해줘서, 가끔은 이게 Rails에서 해주는것인지 브라우저에서 해주는 것인지 헷갈릴 때가 있다.</p>

<p>비밀번호가 틀렸을 때, id값을 유지하는 것도 model을 사용한다면 form에 인스턴스를 사용하는 것 만으로 해결된다.</p>

<p>&lt; in Session Controller file &gt;</p>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">def</span> <span class="nf">create</span>
  <span class="k">if</span> <span class="p">[</span><span class="n">success</span><span class="p">]</span>
  <span class="k">else</span>
    <span class="n">render</span> <span class="s1">'new'</span>
  <span class="k">end</span>
<span class="k">end</span></code></pre></figure>

<p>&lt; in new.html.erb &gt;</p>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby">	<span class="n">form</span> <span class="vi">@user</span> <span class="k">do</span> <span class="o">|</span><span class="n">f</span><span class="o">|</span>
	<span class="o">...</span></code></pre></figure>

<p>Ara house의 로그인은 별도의 model없이 session을 이용하는데,
그래서 params에 email이 있는지 확인하고, 있으면 다시 input field에 넣어주는 작업이 필요하다.
이건 Rails가 해주지 않는 것 같다.</p>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby">	<span class="o">&lt;</span><span class="sx">%= f.email_field :email, value: if parmams.key?("email") then params[:email] else "" end %&gt;</span></code></pre></figure>

<p>login 실패 시, email이 input에 그대로 남아있는지 확인하는 test를 login integration test에 추가한다.</p>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">users_login_test</span><span class="p">.</span><span class="nf">rb</span>

	<span class="o">...</span>
	<span class="n">assert_select</span> <span class="s1">'form input[type=email][value="123"]'</span>
	<span class="o">...</span></code></pre></figure>

<hr />
<p><small>참고링크</small></p>

<p><small><a href="http://stackoverflow.com/questions/4129229/rails-restoring-contents-of-non-model-form-that-uses-form-tag">Stackoverflow</a></small>
<small><a href="http://stackoverflow.com/questions/17710948/how-to-assert-the-value-of-an-input-element-with-assert-select">Stackoverflow - test input value</a></small></p>
 -->
      </div>
    
      <div class="post">
        <h4 class="post-title">
          <a href="/dev/rails/2016/07/18/rotate-image/">
            EXIF 옵션에 따라 이미지 회전시키기
          </a>
        </h4>
        <div class="post-description">
          <small><span class="post-date">18 Jul 2016</span></small>
        </div>
        <!-- <p>모바일에서 세로로 찍은 사진을 <a href="https://ara-house.herokuapp.com">ara house</a>에 올리니, 데스크탑에서 제대로 보이지 않았다.
모바일에서는 브라우저가 자동으로 이미지를 회전시켜주지만, 데스크탑에서는 그렇지 않은가보다.</p>

<p><a href="https://www.railstutorial.org/">rails tutorial</a>를 충실히 따라한 ara house는 이미지 작업을 <code class="highlighter-rouge">Carrierwave gem</code>을 이용해서 구현했다.</p>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">class</span> <span class="nc">PictureUploader</span> <span class="o">&lt;</span> <span class="no">CarrierWave</span><span class="o">::</span><span class="no">Uploader</span><span class="o">::</span><span class="no">Base</span>
  <span class="kp">include</span> <span class="no">CarrierWave</span><span class="o">::</span><span class="no">MiniMagick</span>
  <span class="o">...</span>
  <span class="n">process</span> <span class="ss">:auto_orient</span>
  <span class="k">def</span> <span class="nf">auto_orient</span>
    <span class="n">manipulate!</span> <span class="k">do</span> <span class="o">|</span><span class="n">image</span><span class="o">|</span>
      <span class="n">image</span><span class="p">.</span><span class="nf">tap</span><span class="p">(</span><span class="o">&amp;</span><span class="ss">:auto_orient</span><span class="p">)</span>
    <span class="k">end</span>
  <span class="k">end</span></code></pre></figure>

<p><code class="highlighter-rouge">process</code>를 이용해서 이미지가 업로드 될 때 callback method를 걸어둘 수 있다.</p>

<p><code class="highlighter-rouge">manipulate!</code>는 이미지 프로세싱에 사용하는 MiniMagick command를 사용할 수 있게 해준다.</p>

<p><code class="highlighter-rouge">image.tap(&amp;:auto_orient)</code>는 MiniMagick의 <code class="highlighter-rouge">-auto_orient</code> command을 실행시킨다. 이 command가 EXIF에 따라서 적절히 이미지를 회전시켜주는 고마운 아이이다.</p>

<p><code class="highlighter-rouge">.tap</code>은 object를 단순히 block으로 넘기고, 결과값을 다시 return해주는 method이다.</p>

<p><code class="highlighter-rouge">def auto_orient</code>를 아래와 같이 module에 method를 추가하는 형태로 하고 싶었는데, 파일을 어디에 둬야될지 몰라서 <code class="highlighter-rouge">PictureUploader</code>에 넣어뒀다.</p>

<p>아는 분 계시면 좀 알려주세요.</p>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">module</span> <span class="nn">CarrierWave</span>
  <span class="k">module</span> <span class="nn">MiniMagick</span>
    <span class="k">def</span> <span class="nf">auto_orient</span>
      <span class="n">manipulate!</span> <span class="k">do</span> <span class="o">|</span><span class="n">image</span><span class="o">|</span>
        <span class="n">image</span><span class="p">.</span><span class="nf">tap</span><span class="p">(</span><span class="o">&amp;</span><span class="ss">:auto_orient</span><span class="p">)</span>
      <span class="k">end</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span></code></pre></figure>

<hr />
<p><small>참고링크</small></p>

<p><small><a href="http://www.imagemagick.org/script/command-line-options.php#auto-orient">MiniMagick auto_orient method</a></small></p>

<p><small><a href="https://gist.github.com/tanraya/7438337">Carrierwave auto_orient</a></small></p>

 -->
      </div>
    
  
    <div class="category">
      <a href="#react">REACT (2)</a>
    </div>
    
      <div class="post">
        <h4 class="post-title">
          <a href="/dev/react/javascript/2019/05/28/manage-constants-in-javascript/">
            Javascript에서 constants 관리하기
          </a>
        </h4>
        <div class="post-description">
          <small><span class="post-date">28 May 2019</span></small>
        </div>
        <!-- <p><code class="highlighter-rouge">/components/users/constants.js</code></p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">userStatesActive</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="kd">const</span> <span class="nx">userStatesInActive</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
<span class="kd">const</span> <span class="nx">userStatesLabels</span> <span class="o">=</span> <span class="p">{</span>
  <span class="p">[</span><span class="nx">userStatesActive</span><span class="p">]:</span> <span class="s2">"active user"</span><span class="p">,</span>
  <span class="p">[</span><span class="nx">userStatesActive</span><span class="p">]:</span> <span class="s2">"active user"</span>
<span class="p">};</span>
<span class="k">export</span> <span class="k">default</span> <span class="p">{</span>
  <span class="nx">userStatesActive</span><span class="p">,</span>
  <span class="nx">userStatesInActive</span><span class="p">,</span>
  <span class="nx">userStatesLabels</span>
<span class="p">};</span>
</code></pre></div></div>

<p><code class="highlighter-rouge">/components/users/userStates.jsx</code></p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="p">{</span><span class="nx">userStatesLabels</span><span class="p">}</span> <span class="k">from</span> <span class="s1">'./constants'</span>

<span class="p">...</span>

  <span class="nx">render</span><span class="p">{</span>
    <span class="kd">const</span> <span class="p">{</span><span class="nx">state</span><span class="p">}</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">;</span>
    <span class="k">return</span> <span class="p">(</span>
      <span class="o">&lt;</span><span class="nx">span</span><span class="o">&gt;</span><span class="p">{</span><span class="nx">userStatesLabels</span><span class="p">[</span><span class="nx">state</span><span class="p">]}</span><span class="o">&lt;</span><span class="sr">/span</span><span class="err">&gt;
</span>    <span class="p">)</span>
  <span class="p">};</span>
</code></pre></div></div>
 -->
      </div>
    
      <div class="post">
        <h4 class="post-title">
          <a href="/dev/react/eslint/vscode/2019/05/09/eslint-setup/">
            React + ESLint + VSCode
          </a>
        </h4>
        <div class="post-description">
          <small><span class="post-date">09 May 2019</span></small>
        </div>
        <!-- <h2 id="vscode-eslint-설치">VSCode eslint 설치</h2>

<ul>
  <li>command + shift + p</li>
  <li>Install Extensions</li>
  <li>Search ‘ESLint’</li>
  <li>Click Install</li>
</ul>

<h2 id="저장시-eslint-자동-고침-설정">저장시 eslint 자동 고침 설정</h2>

<ul>
  <li>command + ,</li>
  <li>Search ‘ESLint’</li>
  <li>Turn on auto fix on save</li>
</ul>

<h2 id="eslint-config-airbnb-적용">eslint-config-airbnb 적용</h2>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>// Package 확인
npm info "eslint-config-airbnb@latest" peerDependencies
// with CRA v2.0
npm install eslint-config-airbnb --save
// without CRA
npx install-peerdeps --dev eslint-config-airbnb
</code></pre></div></div>

<h2 id="eslint-config-prettier-적용">eslint-config-prettier 적용</h2>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>npm install eslint-config-prettier --save
</code></pre></div></div>

<p><code class="highlighter-rouge">.eslintrc</code></p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  extends: [
    prettier
  ]
</code></pre></div></div>

<h2 id="eslint-config">eslint config</h2>

<p><code class="highlighter-rouge">.eslintrc</code> 파일 생성</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>module.exports = {
  env: {
    browser: true,
    es6: true,
    jest: true
  },
  extends: [
    "eslint:recommended",
    "plugin:react/recommended",
    "airbnb",
    "prettier",
    "prettier/babel",
    "prettier/react",
    "prettier/standard",
    "prettier/unicorn",
    "prettier/vue"
  ],
  globals: {
    Atomics: "readonly",
    SharedArrayBuffer: "readonly"
  },
  parser: "babel-eslint",
  parserOptions: {
    ecmaFeatures: {
      jsx: true
    },
    ecmaVersion: 2018,
    sourceType: "module"
  },
  plugins: ["react"],
  rules: {
    "react/prefer-stateless-function": 0,
    "import/no-named-as-default": 0,
    "react/jsx-filename-extension": 0,
    "import/no-extraneous-dependencies": [2, { devDependencies: true }]
  }
};

</code></pre></div></div>

<h2 id="특정-lint-rule-제거하기">특정 lint rule 제거하기</h2>

<p><code class="highlighter-rouge">.eslintrc</code></p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code> rules: {
    "react/prefer-stateless-function": 0,
 }
</code></pre></div></div>

<h2 id="dev-save-module-이-project-외부에-있다고-나올-때">dev save module 이 project 외부에 있다고 나올 때</h2>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  rules: {
    "import/no-extraneous-dependencies": [2, { devDependencies: true }]
  }
</code></pre></div></div>

<h2 id="jest-사용시-it-이-undefined-로-나올-때">Jest 사용시, ‘it’ 이 undefined 로 나올 때</h2>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  env: {
    jest: true
  },
</code></pre></div></div>

<h2 id="document-undefined">document undefined</h2>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  env: {
    browser: true
  }
</code></pre></div></div>

<hr />

<p>credit : <a href="https://velog.io/@velopert/eslint-and-prettier-in-react">Velopert-리액트 프로젝트에 ESLint 와 Prettier 끼얹기</a></p>
 -->
      </div>
    
  
    <div class="category">
      <a href="#rspec">RSPEC (4)</a>
    </div>
    
      <div class="post">
        <h4 class="post-title">
          <a href="/dev/rspec/2017/01/14/render-parital-rspec/">
            Rspec - partial rendering 테스트 하기
          </a>
        </h4>
        <div class="post-description">
          <small><span class="post-date">14 Jan 2017</span></small>
        </div>
        <!-- <p>view에서 유저일 때는 광고를 보여주지 않는 부분을 테스트.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;%= render partial: "layouts/gdn_main_top" if not logged_in? %&gt;
</code></pre></div></div>

<p>controller.rspec</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>describe 'Visitor access' do
    describe '#show' do
      render_views
      it 'shows gdn ads' do
        get :show, id: @category
        expect(response).to render_template(partial: "layouts/_gdn_main_top")
      end
    end
  end

  describe 'Use access' do
    before(:each) do
      log_in_as(create(:user))
    end
    describe '#show' do
      render_views
      it 'shows gdn ads' do
        get :show, id: @category
        expect(response).not_to render_template(partial: "layouts/_gdn_main_top")
      end
    end
  end
</code></pre></div></div>

<p>controller spec에서는 view를 rendering하지 않는다.
<code class="highlighter-rouge">render_views</code> 를 통해 특정 테스트에서 view를 rendering할 수 있다.</p>

<p>partial이 rendering되었는지는 <code class="highlighter-rouge">render_template</code> 에 partial 옵션을 줘서 확인한다.</p>

<hr />

<p><a href="https://www.relishapp.com/rspec/rspec-rails/v/3-0/docs/controller-specs/render-views">rspec doc - render views</a></p>

 -->
      </div>
    
      <div class="post">
        <h4 class="post-title">
          <a href="/dev/rspec/2016/12/10/rspec-selective-test/">
            Rspec - 원하는 테스트만 실행하기
          </a>
        </h4>
        <div class="post-description">
          <small><span class="post-date">10 Dec 2016</span></small>
        </div>
        <!-- <p>spec_helper.rb</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>config.filter_run_when_matching :focus
</code></pre></div></div>

<ul>
  <li><code class="highlighter-rouge">it</code>, <code class="highlighter-rouge">describe</code>, <code class="highlighter-rouge">context</code> 뒤에 :focus를 붙이면 해당 test만 실행</li>
  <li>:focus가 붙은 text가 하나도 없으면, 모든 test를 실행</li>
</ul>

<hr />
 -->
      </div>
    
      <div class="post">
        <h4 class="post-title">
          <a href="/dev/rspec/2016/12/10/rspec-mock-referrer/">
            Rspec 에서 referrer 설정하기
          </a>
        </h4>
        <div class="post-description">
          <small><span class="post-date">10 Dec 2016</span></small>
        </div>
        <!-- <p>referrer 설정하는 법</p>

<p>1) Mocking</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>allow(controller.request).to receive(:referrer).and_return("http://example.com")
</code></pre></div></div>

<hr />
 -->
      </div>
    
      <div class="post">
        <h4 class="post-title">
          <a href="/dev/rails/test/rspec/2016/12/06/rspec-controller/">
            Rails Controller Test with Rspec
          </a>
        </h4>
        <div class="post-description">
          <small><span class="post-date">06 Dec 2016</span></small>
        </div>
        <!-- <h3 id="controller-테스트-범위">Controller 테스트 범위</h3>

<ol>
  <li>Controller의 CRUD 관련 매소드가 예상한것과 같이 동작한다.</li>
  <li>CRUD외 다른 메소드가 예상한 것과 같이 동작한다.</li>
  <li>nested attribute</li>
  <li>nested routing</li>
</ol>

<p><br /></p>

<h3 id="controller-method를-호출-하는-방법">Controller method를 호출 하는 방법</h3>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;HTTP verb&gt; &lt;controller method name&gt; &lt;params&gt;

get :index

get :edit, id: 1

get :show, id: 1

post :create, name: 'a', brand: 'b'

delete :destroy, id: 1
</code></pre></div></div>

<p><br /></p>

<h3 id="controller-method에서-선언된-변수에-접근하는-방법">Controller method에서 선언된 변수에 접근하는 방법</h3>

<p><code class="highlighter-rouge">assign(:variable)</code></p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>expect(assign(:items)).to be [item1, item2]
</code></pre></div></div>

<p><br /></p>

<h3 id="controller-method로-부터-반환되는-값">Controller method로 부터 반환되는 값</h3>

<p><code class="highlighter-rouge">response</code></p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>expect(response).to redirect_to user_path
expect(response).to render_template :index
</code></pre></div></div>

<p><br />
<br /></p>

<h3 id="1-crud-method-test">1. CRUD method test</h3>

<h4 id="a-get-request">a. GET Request</h4>

<ol>
  <li>원하는 데이터가 instance variable에 제대로 할당되어야 한다.</li>
  <li>액션에 맞는 템플릿을 렌더링하여야 한다.</li>
</ol>

<p>Method : #index, #new, #edit, #show</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>describe'#show'do
    it "assigns the requested contact to @contact" do
        contact = create(:contact)
        get :show, id: contact
        expect(assigns(:contact)).to eq contact
    end
    it "renders the :show template" do
        contact = create(:contact)
        get :show, id: contact 
        expect(response).to render_template :show
    end 
end
</code></pre></div></div>

<p><br /></p>

<h4 id="b-post-request">b. POST request</h4>

<ol>
  <li>valid parameter가 주어졌을 때
    <ul>
      <li>Database에 새로운 record 생성</li>
      <li>원하는 path로 redirect</li>
      <li>(옵션) Flash message 제대로 설정</li>
    </ul>
  </li>
  <li>invalid parameter가 주어졌을 때
    <ul>
      <li>Database에 새로운 record를 생성하지 않음</li>
      <li>원하는 contents rendering</li>
      <li>(옵션) Flash message 제대로 설정</li>
    </ul>
  </li>
</ol>

<p>_</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>describe '#create.html' do
  context "with valid attributes" do
    it "saves the new item into the database" do
      expect {
        post :create, item: attributes_for(:item)
        }.to change(Item, :count).by(1)
    end
    it "redirects to items#index" do
      post :create, item: attributes_for(:item)
      expect(response).to redirect_to items_path
    end
    it "sets flash message" do
      post :create, item: attributes_for(:item)
      expect(flash[:success]).to match("create")
    end
  end
  context "with invalid attributes" do
    it "does not save the new item into the database" do
      expect {
        post :create, item: attributes_for(:invalid_item)
      }.not_to change(Item, :count)
    end
    it "re-renders the :new template" do
      sub_menu = create(:sub_menu)
      post :create, item: attributes_for(:invalid_item)
      
      expect(response).to render_template :new
    end
  end
</code></pre></div></div>

<p>Ajax request</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>xhr :post, :create, item: attributes_for(:item)
</code></pre></div></div>

<p>status check</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>expect(response.status).to be(404)
</code></pre></div></div>

<p><br /></p>

<h4 id="c-patch-request">c. PATCH request</h4>

<p>1) valid attributes</p>
<ul>
  <li>requested object</li>
  <li>DB update</li>
  <li>redirect</li>
  <li>Flash message (success)</li>
</ul>

<p>2) invalid attributes</p>
<ul>
  <li>DB update (not changed)</li>
  <li>render</li>
  <li>Flash message (error)</li>
</ul>

<p>업데이트된 record값을 다시 가져오기 : <code class="highlighter-rouge">reload</code></p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>describe 'update' do
  context "with valid attributes" do
    it "locates the requested @item" do
      patch :update, id: @item, item: attributes_for(:item)
      expect(assigns(:item)).to eq(@item)
    end
    it "changes @item's attributes" do
      patch :update, id: @item, item: attributes_for(:item, name: "!")
          
      @item.reload

      expect(@item.name).to eq "!"
    end
    it "redirects to item#index" do
      patch :update, id: @item, item: attributes_for(:item)
      expect(response).to redirect_to items_path
    end
  end
  context "with invalid attributes" do
    it "does not change the @item's attributes" do
      name = @item.name
      patch :update, id: @item, item: attributes_for(:invalid_item)
      expect(@item.reload.name).to eq(name)
    end
    it "re-renders the :edit template" do
      patch :update, id: @item, item: attributes_for(:invalid_item)
      expect(response).to render_template :edit
    end
    it 'sets flash message' do
      patch :update, id: @item, item: attributes_for(:invalid_item)
      expect(flash[:danger][:name]).not_to be_nil
    end
  end
end
</code></pre></div></div>

<p><br /></p>

<h4 id="d-delete-request">d. DELETE request</h4>

<ol>
  <li>잘 지워졌는</li>
  <li>지우고나서 redirect</li>
</ol>

<p>_</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>describe '#destroy' do
  it "deletes the item" do
    expect {
      delete :destroy, id: @item
    }.to change(Item, :count).by(-1)
  end
  it "redirects to item#index" do
    delete :destroy, id: @item
    expect(response).to redirect_to items_path
  end
end
</code></pre></div></div>

<p>###2. Non-CRUD method test
###3. Nested Attributes
###4. Nested Routes</p>

<hr />
 -->
      </div>
    
  
    <div class="category">
      <a href="#ruby">RUBY (5)</a>
    </div>
    
      <div class="post">
        <h4 class="post-title">
          <a href="/dev/rails/ruby/2017/01/20/irb-encoding/">
            irb, rails console에서의 한글 encoding 문제 해결
          </a>
        </h4>
        <div class="post-description">
          <small><span class="post-date">20 Jan 2017</span></small>
        </div>
        <!-- <ul>
  <li>기본 encoding : UTF-8</li>
  <li>한글 사용을 위해서는 <code class="highlighter-rouge">readline</code> 패키지 필요</li>
  <li>Ruby를 설치할 때 마다 readline 경로를 명시해야되나, rbenv plugin을 사용하면 자동으로 경로가 지정됨</li>
</ul>

<p><br /></p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>brew install readline
git clone git://github.com/tpope/rbenv-readline.git ~/.rbenv/plugins/rbenv-readline
rbenv install &lt;ruby_version&gt;
</code></pre></div></div>

<p>이미 설치되어 있는 경우, 해당 버전의 ruby를 삭제하고 재설치</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>rbenv uninstall &lt;ruby_version&gt;
rbenv install &lt;ruby_version&gt;
</code></pre></div></div>

<p>irb에서는 한글이 제대로 입력되는데, rails console에서는 그대로 UTF-8로 나오는 경우에, 재부팅을 하고 나니 제대로 한글이 입력되더라.</p>

<hr />

<p>all credit to <a href="https://blog.iamseapy.com/archives/177">https://blog.iamseapy.com/archives/177</a></p>

 -->
      </div>
    
      <div class="post">
        <h4 class="post-title">
          <a href="/dev/ruby/2017/01/20/install-rbenv/">
            루비 버전 관리 - rbenv Mac 설치
          </a>
        </h4>
        <div class="post-description">
          <small><span class="post-date">20 Jan 2017</span></small>
        </div>
        <!-- <p>(rbenv github)<a href="https://github.com/rbenv/rbenv">1</a>
(ruby-build)<a href="https://github.com/rbenv/ruby-build#readme">2</a> : rbenv install 명령어를 사용가능하게 하는 plugin</p>

<h3 id="설치">설치</h3>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git clone https://github.com/rbenv/rbenv.git ~/.rbenv
git clone https://github.com/rbenv/ruby-build.git ~/.rbenv/plugins/ruby-build
echo 'export PATH="$HOME/.rbenv/bin:$PATH"' &gt;&gt; ~/.bash_profile
</code></pre></div></div>

<h3 id="간단한-사용법">간단한 사용법</h3>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>rbenv install -l        // 설치가능한 모든 ruby version list
rbenv install 2.2.5     // 2.2.5 버전 ruby 설치
rbenv uninstall 2.2.5   // 2.2.5 버전 ruby 삭제
rbenv local 2.2.5       // 해당 폹더에서 2.2.5 버전 사용
rbenv local             // 해당 폴더 루비 버전 확인
</code></pre></div></div>

<p>–</p>

 -->
      </div>
    
      <div class="post">
        <h4 class="post-title">
          <a href="/dev/ruby/2017/01/13/ruby-sort/">
            Ruby Sorting - nil값이 있는 경우
          </a>
        </h4>
        <div class="post-description">
          <small><span class="post-date">13 Jan 2017</span></small>
        </div>
        <!-- <h3 id="sort">Sort</h3>

<p><code class="highlighter-rouge">array.sort</code> 는 <code class="highlighter-rouge">array.sort { |x, y| x &lt;=&gt; y }</code> 와 동일</p>

<p>x, y는 sorting algorithm에서 선택하는 array의 두 element</p>

<p><code class="highlighter-rouge">&lt;=&gt;</code> 연산자의 뜻은</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>return -1 if x &lt; y
return 0 if x = y
return 1 if x &gt; y
</code></pre></div></div>

<p><br /></p>

<h3 id="nil값을-가지는-경우의-sorting">nil값을 가지는 경우의 sorting</h3>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>array = [1, 2, nil, 3, 5]
array.sort { |a, b| a &amp;&amp; b ? a&lt;=&gt;b : a ? -1 : 1 }
--&gt; [1, 2, 3, 5, nil]
</code></pre></div></div>

<p><code class="highlighter-rouge">a &amp;&amp; b ? a &lt;=&gt; b</code></p>

<p>a, b 둘다 존재하면 정상적으로 a&lt;=&gt;b 연산으로 sorting</p>

<p><br /></p>

<p><code class="highlighter-rouge">a ? -1 : 1</code></p>

<p>a가 nil인 경우, 1을 반환 (즉 a &gt; b 인 것으로 처리)</p>

<p>b가 nil인 경우, -1을 반환 (즉 a &lt; b 인 것으로 처리)</p>

<p>–&gt; nil이 제일 큰 수로 취급해서 ascending order로 sorting한 경우 가장 마지막에 위치하게 됨.</p>

<p><br /></p>

<hr />

<p><a href="http://stackoverflow.com/questions/2637419/how-does-arraysort-work-when-a-block-is-passed">StackOverflow: how-does-arraysort-work-when-a-block-is-passed</a></p>

<p><a href="http://stackoverflow.com/questions/808318/sorting-a-ruby-array-of-objects-by-an-attribute-that-could-be-nil">StackOverflow: sorting-a-ruby-array-of-objects-by-an-attribute-that-could-be-nil</a></p>

 -->
      </div>
    
      <div class="post">
        <h4 class="post-title">
          <a href="/dev/ruby/2017/01/05/ruby-regex/">
            Ruby Regex
          </a>
        </h4>
        <div class="post-description">
          <small><span class="post-date">05 Jan 2017</span></small>
        </div>
        <!-- <p>regex를 사용하기 전에, 특정 문자열을 바꾸는 경우라면, 간단히 아래 함수를 사용할 수도 있다.</p>

<p>.sub</p>

<p>첫 번째 matched element만 변경</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>"123 1231 123".sub(" ","")       //"1231231 123"
</code></pre></div></div>

<p>.gsub</p>

<p>모든 matched elements를 변경</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>"123 1231 123".gsub(" ","")       //"1231231123"
</code></pre></div></div>

<h2 id="pattern-matching">Pattern matching</h2>

<p>regex 패턴 매칭 여부만 알면 된다면, =~ operation으로 가증
pattern이 발견되면 패턴이 시작되는 character의 index를 반환하고
pattern이 없다면 nil을 반환한다.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>/123/ =~ '12345'    // 0
/123/ =~ '012345'    // 1
/123/ =~ '2345'    // nil
</code></pre></div></div>

<h2 id="match"><a href="https://ruby-doc.org/core-2.2.0/Regexp.html">match</a></h2>

 -->
      </div>
    
      <div class="post">
        <h4 class="post-title">
          <a href="/dev/ruby/rails/2016/09/22/call-methods-only-if-exists/">
            tip - nil이 아닌경우에 method를 실행
          </a>
        </h4>
        <div class="post-description">
          <small><span class="post-date">22 Sep 2016</span></small>
        </div>
        <!-- <p>object가 nil이 아닌 경우에만 method를 실행하고 싶을 때가 있다.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>self.send(:method) if self.respond_to?(:method)
</code></pre></div></div>

<p>Rails에는 <code class="highlighter-rouge">.try()</code>가 있다.</p>

<hr />

<p><a href="http://stackoverflow.com/questions/15787610/call-method-only-if-it-exists">http://stackoverflow.com/questions/15787610/call-method-only-if-it-exists</a>
<a href="http://everydayrails.com/2011/04/28/rails-try-method.html">http://everydayrails.com/2011/04/28/rails-try-method.html</a></p>
 -->
      </div>
    
  
    <div class="category">
      <a href="#seo">SEO (1)</a>
    </div>
    
      <div class="post">
        <h4 class="post-title">
          <a href="/dev/jekyll/seo/2016/11/13/jekyll-sitemap/">
            Jekyll 이용한 Gibhub pag에서 sitemap 생성
          </a>
        </h4>
        <div class="post-description">
          <small><span class="post-date">13 Nov 2016</span></small>
        </div>
        <!-- <p>_config.yml 파일에 아래 <em>jekyll-sitemap</em> gem을 추가해주면, github page에서 자동으로 sitemap.xml을 생성합니다.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>//_config.yml
    gems:
        - jekyll-sitemap
</code></pre></div></div>

<hr />

<p><a href="https://help.github.com/articles/sitemaps-for-github-pages/">https://help.github.com/articles/sitemaps-for-github-pages/</a></p>
 -->
      </div>
    
  
    <div class="category">
      <a href="#sql">SQL (1)</a>
    </div>
    
      <div class="post">
        <h4 class="post-title">
          <a href="/dev/rails/sql/2016/09/28/duplicated-records-of-sql-when-using-limit-and-offset/">
            Pagination - 다른 페이지에 같은 record가 나오는 문제
          </a>
        </h4>
        <div class="post-description">
          <small><span class="post-date">28 Sep 2016</span></small>
        </div>
        <!-- <p><a href="https://github.com/mislav/will_paginate">will_paginate</a> gem을 이용하는데, 다른 페이지에 같은 record가 올라오는 경우가 있었다.
문제는 infinite scrolling을 넣으며 ajax로 다음 페이지를 붙이다 보니, 중복되게 반복되는 경우가 발생했다.
gem의 문제인가 해서 psql로 직접 sql을 날려보니, sql 결과에서도 같은 record가 나타났다.</p>

<h3 id="before">Before</h3>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>pnm_development=# SELECT  "sub_menus".*, "menus".name FROM "sub_menus" INNER JOIN "menus" ON "menus"."id" = "sub_menus"."menu_id" WHERE (menus.category_id = 1)  ORDER BY menus.name collate "C" asc LIMIT 10 OFFSET 10;

 id |    name    |         created_at         |         updated_at         | menu_id | description |        name         
----+------------+----------------------------+----------------------------+---------+-------------+---------------------
  6 | 물티슈     | 2016-08-10 14:12:25.575423 | 2016-08-10 14:12:25.575423 |       2 |             | 물티슈와 가제손수건
 49 | 바운서     | 2016-08-17 05:47:20.868362 | 2016-08-17 05:47:20.875056 |      16 |             | 바운서
 53 | 국산 분유  | 2016-08-29 06:54:39.305488 | 2016-08-29 06:54:39.315016 |      19 |             | 분유
 54 | 해외 분유  | 2016-08-29 06:54:54.123748 | 2016-08-29 06:54:54.130446 |      19 |             | 분유
 26 | 수유등     | 2016-08-10 14:12:25.698298 | 2016-08-10 14:12:25.698298 |       7 |             | 수유-모유
 23 | 수유패드   | 2016-08-10 14:12:25.681545 | 2016-08-10 14:12:25.681545 |       7 |             | 수유-모유
 22 | 수유브라   | 2016-08-10 14:12:25.677182 | 2016-08-10 14:12:25.677182 |       7 |             | 수유-모유
 21 | 수유복     | 2016-08-10 14:12:25.672055 | 2016-08-10 14:12:25.672055 |       7 |             | 수유-모유
 25 | 유두보호기 | 2016-08-10 14:12:25.694233 | 2016-08-10 14:12:25.694233 |       7 |             | 수유-모유
 20 | 수유쿠션   | 2016-08-10 14:12:25.668275 | 2016-08-10 14:12:25.668275 |       7 |             | 수유-모유
(10 rows)

pnm_development=# SELECT  "sub_menus".*, "menus".name FROM "sub_menus" INNER JOIN "menus" ON "menus"."id" = "sub_menus"."menu_id" WHERE (menus.category_id = 1)  ORDER BY menus.name collate "C" asc
 LIMIT 10 OFFSET 20;

 id |     name     |         created_at         |         updated_at         | menu_id | description |     name      
----+--------------+----------------------------+----------------------------+---------+-------------+---------------
 20 | 수유쿠션     | 2016-08-10 14:12:25.668275 | 2016-08-10 14:12:25.668275 |       7 |             | 수유-모유
 26 | 수유등       | 2016-08-10 14:12:25.698298 | 2016-08-10 14:12:25.698298 |       7 |             | 수유-모유
 19 | 유축기       | 2016-08-10 14:12:25.664174 | 2016-08-10 14:12:25.664174 |       7 |             | 수유-모유
 16 | 젖병소독기   | 2016-08-10 14:12:25.642145 | 2016-08-10 14:12:25.642145 |       6 |             | 수유-분유
 17 | 분유포트     | 2016-08-10 14:12:25.650437 | 2016-08-10 14:12:25.650437 |       6 |             | 수유-분유
 56 | 겉싸개       | 2016-08-29 13:41:40.355506 | 2016-08-29 13:41:40.363311 |      20 |             | 아기 의류
 55 | 속싸개       | 2016-08-29 13:41:29.740309 | 2016-08-29 13:41:29.748772 |      20 |             | 아기 의류
 33 | 기저귀정리함 | 2016-08-17 05:31:54.731063 | 2016-08-17 05:31:54.738381 |      12 |             | 아기가구
 34 | 아기수납장   | 2016-08-17 05:32:08.658293 | 2016-08-17 05:32:08.668742 |      12 |             | 아기가구
 39 | 힙시트       | 2016-08-17 05:33:23.976077 | 2016-08-17 05:33:23.983078 |      15 |             | 아기띠/힙시트
(10 rows)
</code></pre></div></div>

<p>문제가 되는 id 20번 record.</p>

<p>sql에서의 row 순서는 <code class="highlighter-rouge">ORDER BY</code>로 sort하지 않는 이상 정해져 있지 않다.<a href="http://stackoverflow.com/questions/15162593/postgresql-strange-collision-of-order-by-and-limit-offset">stackoverflow</a>
뭐가 나올지 알 수 없다는 말이네.</p>

<p>sub_menu에 대한 정렬을 추가해서 해결했다.</p>

<h3 id="after">after</h3>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>pnm_development=# SELECT  "sub_menus".*, "menus".name FROM "sub_menus" INNER JOIN "menus" ON "menus"."id" = "sub_menus"."menu_id" WHERE (menus.category_id = 1)  ORDER BY menus.name collate "C" asc, `sub_menus.name collate "C" asc LIMIT 10 OFFSET 10;

 id |    name    |         created_at         |         updated_at         | menu_id | description |        name         
----+------------+----------------------------+----------------------------+---------+-------------+---------------------
  6 | 물티슈     | 2016-08-10 14:12:25.575423 | 2016-08-10 14:12:25.575423 |       2 |             | 물티슈와 가제손수건
 49 | 바운서     | 2016-08-17 05:47:20.868362 | 2016-08-17 05:47:20.875056 |      16 |             | 바운서
 53 | 국산 분유  | 2016-08-29 06:54:39.305488 | 2016-08-29 06:54:39.315016 |      19 |             | 분유
 54 | 해외 분유  | 2016-08-29 06:54:54.123748 | 2016-08-29 06:54:54.130446 |      19 |             | 분유
 24 | 모유저장팩 | 2016-08-10 14:12:25.689986 | 2016-08-10 14:12:25.689986 |       7 |             | 수유-모유
 26 | 수유등     | 2016-08-10 14:12:25.698298 | 2016-08-10 14:12:25.698298 |       7 |             | 수유-모유
 21 | 수유복     | 2016-08-10 14:12:25.672055 | 2016-08-10 14:12:25.672055 |       7 |             | 수유-모유
 22 | 수유브라   | 2016-08-10 14:12:25.677182 | 2016-08-10 14:12:25.677182 |       7 |             | 수유-모유
 27 | 수유의자   | 2016-08-10 14:12:25.70253  | 2016-08-10 14:12:25.70253  |       7 |             | 수유-모유
 20 | 수유쿠션   | 2016-08-10 14:12:25.668275 | 2016-08-10 14:12:25.668275 |       7 |             | 수유-모유
(10 rows)

pnm_development=# SELECT  "sub_menus".*, "menus".name FROM "sub_menus" INNER JOIN "menus" ON "menus"."id" = "sub_menus"."menu_id" WHERE (menus.category_id = 1)  ORDER BY menus.name collate "C" asc, sub_menus.name collate "C" asc LIMIT 10 OFFSET 20;
 
 id |     name     |         created_at         |         updated_at         | menu_id | description |     name      
----+--------------+----------------------------+----------------------------+---------+-------------+---------------
 23 | 수유패드     | 2016-08-10 14:12:25.681545 | 2016-08-10 14:12:25.681545 |       7 |             | 수유-모유
 25 | 유두보호기   | 2016-08-10 14:12:25.694233 | 2016-08-10 14:12:25.694233 |       7 |             | 수유-모유
 19 | 유축기       | 2016-08-10 14:12:25.664174 | 2016-08-10 14:12:25.664174 |       7 |             | 수유-모유
 17 | 분유포트     | 2016-08-10 14:12:25.650437 | 2016-08-10 14:12:25.650437 |       6 |             | 수유-분유
 16 | 젖병소독기   | 2016-08-10 14:12:25.642145 | 2016-08-10 14:12:25.642145 |       6 |             | 수유-분유
 56 | 겉싸개       | 2016-08-29 13:41:40.355506 | 2016-08-29 13:41:40.363311 |      20 |             | 아기 의류
 55 | 속싸개       | 2016-08-29 13:41:29.740309 | 2016-08-29 13:41:29.748772 |      20 |             | 아기 의류
 33 | 기저귀정리함 | 2016-08-17 05:31:54.731063 | 2016-08-17 05:31:54.738381 |      12 |             | 아기가구
 34 | 아기수납장   | 2016-08-17 05:32:08.658293 | 2016-08-17 05:32:08.668742 |      12 |             | 아기가구
 38 | 아기띠       | 2016-08-17 05:33:14.93707  | 2016-08-17 05:33:14.942893 |      15 |             | 아기띠/힙시트
(10 rows)
</code></pre></div></div>

 -->
      </div>
    
  
    <div class="category">
      <a href="#sublimetext">SUBLIMETEXT (2)</a>
    </div>
    
      <div class="post">
        <h4 class="post-title">
          <a href="/dev/sublimetext/2016/10/25/sublimetext3-edit-multiple-lines/">
            SublimeText3 - 여러 줄 한번에 수정하기
          </a>
        </h4>
        <div class="post-description">
          <small><span class="post-date">25 Oct 2016</span></small>
        </div>
        <!-- <h3 id="command--shift--l--split-into-lines">Command + shift + L : split into lines</h3>

<ol>
  <li>수정하려는 lines을 선택</li>
  <li>command + shift + L</li>
  <li>line 마다 cursor가 생깁니다.</li>
</ol>

<p><img src="https://ci3.googleusercontent.com/proxy/A8Sb4ajRl9iQ_ikUB1ityk1tCAoNI5i1ZnS2izN7l899NVZJtSIT5a2N-Qt93cz5dPKZ1qK35rvooslX5M_IYgLn56tdVPUlYYUkiJTE5Ry-CMrE=s0-d-e1-ft#http://f.cl.ly/items/3w1A323O451P391m223K/wrap-with-quotes.gif" alt="sublimtext-split-into-lines" /></p>

<p class="center">[source: http://sublimetexttips.com/]</p>

<hr />

<p><a href="https://www.sublimetext.com/docs/3/multiple_selection_with_the_keyboard.html">https://www.sublimetext.com/docs/3/multiple_selection_with_the_keyboard.html</a></p>
 -->
      </div>
    
      <div class="post">
        <h4 class="post-title">
          <a href="/dev/sublimetext/2016/09/10/my-sublime-package-usges/">
            Sublime Package
          </a>
        </h4>
        <div class="post-description">
          <small><span class="post-date">10 Sep 2016</span></small>
        </div>
        <!-- <p><code class="highlighter-rouge">Jekyll</code></p>

<p>단순히 highlight snippet 때문에 사용. (ST2는 지원하지 않는다.)</p>

<p><code class="highlighter-rouge">MarkdownEditing</code></p>

<ul>
  <li>markdown tag (`, ** 등등) 둘러 쌓인 부분이 highlight된다.</li>
  <li>link같은 경우엔 link name이 강조되고, 실제 url 부분이 dim처리 된다.</li>
  <li>markdown으로 editing 할 때 훨씬 가독성이 좋아진다.</li>
</ul>

<p><code class="highlighter-rouge">SublimeERB</code></p>

<ul>
  <li>ruby or rails 개발 시 필수</li>
  <li>&lt;% %&gt; erb tag를 단축키(command + shift + .)를 이용해서 만들 수 있게 해준다.</li>
</ul>

<p>keybinding</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[
    { "keys": ["command+shift+."], "command": "erb" }
]
</code></pre></div></div>

<p><code class="highlighter-rouge">rails partial</code></p>

<ul>
  <li>View 파일의 특정부분을 선택하고 alt + p 를 누르면 partial file을 만들 수 있다.</li>
</ul>

<p><code class="highlighter-rouge">SideBarEnhancements</code></p>
<ul>
  <li>필수 package</li>
  <li>sublime sidebar에서 파일 이동이 가능해집니다! (ST2는 지원하지 않음)</li>
</ul>
 -->
      </div>
    
  
    <div class="category">
      <a href="#test">TEST (5)</a>
    </div>
    
      <div class="post">
        <h4 class="post-title">
          <a href="/dev/rails/test/rspec/2016/12/06/rspec-controller/">
            Rails Controller Test with Rspec
          </a>
        </h4>
        <div class="post-description">
          <small><span class="post-date">06 Dec 2016</span></small>
        </div>
        <!-- <h3 id="controller-테스트-범위">Controller 테스트 범위</h3>

<ol>
  <li>Controller의 CRUD 관련 매소드가 예상한것과 같이 동작한다.</li>
  <li>CRUD외 다른 메소드가 예상한 것과 같이 동작한다.</li>
  <li>nested attribute</li>
  <li>nested routing</li>
</ol>

<p><br /></p>

<h3 id="controller-method를-호출-하는-방법">Controller method를 호출 하는 방법</h3>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;HTTP verb&gt; &lt;controller method name&gt; &lt;params&gt;

get :index

get :edit, id: 1

get :show, id: 1

post :create, name: 'a', brand: 'b'

delete :destroy, id: 1
</code></pre></div></div>

<p><br /></p>

<h3 id="controller-method에서-선언된-변수에-접근하는-방법">Controller method에서 선언된 변수에 접근하는 방법</h3>

<p><code class="highlighter-rouge">assign(:variable)</code></p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>expect(assign(:items)).to be [item1, item2]
</code></pre></div></div>

<p><br /></p>

<h3 id="controller-method로-부터-반환되는-값">Controller method로 부터 반환되는 값</h3>

<p><code class="highlighter-rouge">response</code></p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>expect(response).to redirect_to user_path
expect(response).to render_template :index
</code></pre></div></div>

<p><br />
<br /></p>

<h3 id="1-crud-method-test">1. CRUD method test</h3>

<h4 id="a-get-request">a. GET Request</h4>

<ol>
  <li>원하는 데이터가 instance variable에 제대로 할당되어야 한다.</li>
  <li>액션에 맞는 템플릿을 렌더링하여야 한다.</li>
</ol>

<p>Method : #index, #new, #edit, #show</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>describe'#show'do
    it "assigns the requested contact to @contact" do
        contact = create(:contact)
        get :show, id: contact
        expect(assigns(:contact)).to eq contact
    end
    it "renders the :show template" do
        contact = create(:contact)
        get :show, id: contact 
        expect(response).to render_template :show
    end 
end
</code></pre></div></div>

<p><br /></p>

<h4 id="b-post-request">b. POST request</h4>

<ol>
  <li>valid parameter가 주어졌을 때
    <ul>
      <li>Database에 새로운 record 생성</li>
      <li>원하는 path로 redirect</li>
      <li>(옵션) Flash message 제대로 설정</li>
    </ul>
  </li>
  <li>invalid parameter가 주어졌을 때
    <ul>
      <li>Database에 새로운 record를 생성하지 않음</li>
      <li>원하는 contents rendering</li>
      <li>(옵션) Flash message 제대로 설정</li>
    </ul>
  </li>
</ol>

<p>_</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>describe '#create.html' do
  context "with valid attributes" do
    it "saves the new item into the database" do
      expect {
        post :create, item: attributes_for(:item)
        }.to change(Item, :count).by(1)
    end
    it "redirects to items#index" do
      post :create, item: attributes_for(:item)
      expect(response).to redirect_to items_path
    end
    it "sets flash message" do
      post :create, item: attributes_for(:item)
      expect(flash[:success]).to match("create")
    end
  end
  context "with invalid attributes" do
    it "does not save the new item into the database" do
      expect {
        post :create, item: attributes_for(:invalid_item)
      }.not_to change(Item, :count)
    end
    it "re-renders the :new template" do
      sub_menu = create(:sub_menu)
      post :create, item: attributes_for(:invalid_item)
      
      expect(response).to render_template :new
    end
  end
</code></pre></div></div>

<p>Ajax request</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>xhr :post, :create, item: attributes_for(:item)
</code></pre></div></div>

<p>status check</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>expect(response.status).to be(404)
</code></pre></div></div>

<p><br /></p>

<h4 id="c-patch-request">c. PATCH request</h4>

<p>1) valid attributes</p>
<ul>
  <li>requested object</li>
  <li>DB update</li>
  <li>redirect</li>
  <li>Flash message (success)</li>
</ul>

<p>2) invalid attributes</p>
<ul>
  <li>DB update (not changed)</li>
  <li>render</li>
  <li>Flash message (error)</li>
</ul>

<p>업데이트된 record값을 다시 가져오기 : <code class="highlighter-rouge">reload</code></p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>describe 'update' do
  context "with valid attributes" do
    it "locates the requested @item" do
      patch :update, id: @item, item: attributes_for(:item)
      expect(assigns(:item)).to eq(@item)
    end
    it "changes @item's attributes" do
      patch :update, id: @item, item: attributes_for(:item, name: "!")
          
      @item.reload

      expect(@item.name).to eq "!"
    end
    it "redirects to item#index" do
      patch :update, id: @item, item: attributes_for(:item)
      expect(response).to redirect_to items_path
    end
  end
  context "with invalid attributes" do
    it "does not change the @item's attributes" do
      name = @item.name
      patch :update, id: @item, item: attributes_for(:invalid_item)
      expect(@item.reload.name).to eq(name)
    end
    it "re-renders the :edit template" do
      patch :update, id: @item, item: attributes_for(:invalid_item)
      expect(response).to render_template :edit
    end
    it 'sets flash message' do
      patch :update, id: @item, item: attributes_for(:invalid_item)
      expect(flash[:danger][:name]).not_to be_nil
    end
  end
end
</code></pre></div></div>

<p><br /></p>

<h4 id="d-delete-request">d. DELETE request</h4>

<ol>
  <li>잘 지워졌는</li>
  <li>지우고나서 redirect</li>
</ol>

<p>_</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>describe '#destroy' do
  it "deletes the item" do
    expect {
      delete :destroy, id: @item
    }.to change(Item, :count).by(-1)
  end
  it "redirects to item#index" do
    delete :destroy, id: @item
    expect(response).to redirect_to items_path
  end
end
</code></pre></div></div>

<p>###2. Non-CRUD method test
###3. Nested Attributes
###4. Nested Routes</p>

<hr />
 -->
      </div>
    
      <div class="post">
        <h4 class="post-title">
          <a href="/dev/rails/test/2016/11/30/railscast-how-to-test/">
            Integration test or Unit test
          </a>
        </h4>
        <div class="post-description">
          <small><span class="post-date">30 Nov 2016</span></small>
        </div>
        <!-- <p>Integration_test에서는 사용자가 신경 쓸만한 부분을 테스트한다.</p>

<ul>
  <li>메일을 받는다</li>
  <li>메일 주소를 넣는다.</li>
</ul>

<p>사용자가 신경쓰지 않는 부분들은 Unit test 레벨에 넘긴다.</p>

<ul>
  <li>메일에 올바른 password_reset token을 받는다.</li>
</ul>

<hr />
<p><a href="http://railscasts.com/episodes/275-how-i-test">railscast</a></p>

 -->
      </div>
    
      <div class="post">
        <h4 class="post-title">
          <a href="/dev/rails/test/2016/11/30/rails-test-toc/">
            Rails Test 0 Table of Contents
          </a>
        </h4>
        <div class="post-description">
          <small><span class="post-date">30 Nov 2016</span></small>
        </div>
        <!-- <p><code class="highlighter-rouge">Test Philasophy</code></p>

<p>https://github.com/lelylan/betterspecs/issues/5</p>

<p><br /></p>

<p><code class="highlighter-rouge">Rspec style guide</code></p>

<p><a href="/2016/12/02/rspec-style-guide/">Rspec Style Guide</a></p>

<p><br /></p>

<p><code class="highlighter-rouge">Test Environment</code></p>

<ul>
  <li>
    <p><a href="/dev/rails/2016/08/20/rails-guard/">Guard 설정</a></p>
  </li>
  <li>
    <p><a href="/dev/rails/2016/08/13/fast-test-with-guard-and-zeus/">빠른 테스트 설정 - Zeus &amp; Guard </a></p>
  </li>
</ul>

<p><br /></p>

<p><code class="highlighter-rouge">Model test</code></p>

<ul>
  <li>
    <p><a href="/dev/rails/test/2016/11/30/rails-test-model/">Rails model test with Rspec</a></p>
  </li>
  <li>
    <p><a href="/dev/rails/test/2016/11/30/factory_girl/">Factory_girl 사용법 정리</a></p>
  </li>
  <li>
    <p><a href="/dev/rails/2016/12/02/vcr-webmocking/">VCR - 빠른 3rd party API 테스트</a></p>
  </li>
</ul>

<p><br /></p>

<p><code class="highlighter-rouge">Controller test</code></p>

<ul>
  <li><a href="/dev/rails/test/rspec/2016/12/06/rspec-controller/">Rails controller test with Rspec</a></li>
</ul>

<h3 id="integration-test">Integration-test</h3>

<ul>
  <li><a href="/dev/rails/test/2016/11/30/railscast-how-to-test/">Integration test에서는 어떤 것을 테스트해야 될까</a></li>
</ul>

<h3 id="etc">etc</h3>

<ul>
  <li><a href="/2016/12/02/how-to-test-crawling-codes/">Crawling code를 테스트하는 방법</a></li>
</ul>
 -->
      </div>
    
      <div class="post">
        <h4 class="post-title">
          <a href="/dev/rails/test/2016/11/30/rails-test-model/">
            Rails Test 1 Model
          </a>
        </h4>
        <div class="post-description">
          <small><span class="post-date">30 Nov 2016</span></small>
        </div>
        <!-- <p>Model에서 테스트 해야 할 것.</p>

<ol>
  <li>유효한 attritutes를 넘겼을 때 model의 create method가 유효해야한다.</li>
  <li>유효하지 않은 데이터는 유효성 검사를 통과하지 않아야 한다.</li>
  <li>클래스 매소드(+scope)와 인스턴스 매소드가 예상한것과 같이 동작한다.</li>
</ol>

<p><br /></p>

<p><em>item.rb</em></p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>class Item &lt; ActiveRecord::Base
    ...
    validate :name, presence: true
</code></pre></div></div>

<p><br /></p>

<p>1) 유효한 attritutes를 넘겼을 때 model의 create method가 유효해야한다.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>context 'with valid attritues' do
    it '#create' do

        expect {
            Item.create(name: "A")
        }.to change(Item, :count).by(1)
</code></pre></div></div>

<p><br /></p>

<p>2) 유효하지 않은 데이터는 유효성 검사를 통과하지 않아야 한다.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>item = Item.new()
item.valid?
expect(item.errors[:name]).to include("can't be blank")
</code></pre></div></div>

<p><br /></p>

<p>3) 클래스 매소드, scope, 인스턴스 매소드가 예상한것과 같이 동작한다.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>it '#instance_method' do
end

it '::class_method' do
end
</code></pre></div></div>

<p><br /></p>

<hr />
<p><a href="https://leanpub.com/everydayrailsrspec">Everyday Rails testing with Rspec</a></p>

 -->
      </div>
    
      <div class="post">
        <h4 class="post-title">
          <a href="/dev/rails/test/2016/11/30/factory_girl/">
            Gem - Factory_girl
          </a>
        </h4>
        <div class="post-description">
          <small><span class="post-date">30 Nov 2016</span></small>
        </div>
        <!-- <p><small>FactoryGirl Rails v4.4 기준입니다.</small></p>

<p><br /></p>

<h3 id="fixture-쓰지-말고-factorygirl-쓰자">Fixture 쓰지 말고, FactoryGirl 쓰자.</h3>

<ul>
  <li>Fixture는 Active Record를 우회해서 validation이 안된다.</li>
  <li>데이터가 쉽게 변경되어서 test code만큼 test db 관리에 신경써야 된다.</li>
</ul>

<p><br /></p>

<h3 id="valid--invalid-factory">Valid / invalid factory</h3>

<p>한 모델에 대해 factory를 만들 때 기본적으로 valid / invalid factory를 생성해둔다.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code># app/models/item.rb
class Item &lt; ActiveRecord::Base
  validates :name, presence: true
  ...
end


# spec/factories.rb
factory :item do
  sequence(:name) { |n| "Item_#{n}"}
  ...

  factory :invalid_item do
    name nil
  end
end
</code></pre></div></div>

<p>valid/invalid factory는 <code class="highlighter-rouge">attributes_for</code> method를 이용해서 controller spec에서 사용한다.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code># spec/controllers/item_controller_spec.rb
context "with valid attributes" do
  it "saves the new item into the database" do
    expect {
      post :create, item: attributes_for(:item)
      }.to change(Item, :count).by(1)
  end
end
context "with invalid attributes" do
  it "does not save the new item into the database" do
    expect {
      post :create, item: attributes_for(:invalid_item)
    }.not_to change(Item, :count)
  end
end
</code></pre></div></div>

<p><br /></p>

<h3 id="association">Association</h3>

<p>nested_attribute를 설정한 경우, factory에도 nested attribute를 받아서 assocation factory를 생성하게 할 수 있다.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code># app/models/item.rb
class Item &lt; ActiveRecord::Base
  ...
  accepts_nested_attributes_for :keywords, allow_destroy: true
  ...

  #strong parameter
  
  def item_params
    params.require(:item).permit(:id, :name, keywords_attributes: [:id, :name, '_destroy')
  end
</code></pre></div></div>

<p>associated factory에 넘길 parameter와 생성할 assocated factory 갯수를 <code class="highlighter-rouge">ignore</code>로 설정해준다.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code># spec/factories.rb

factory :item do
  sequence(:name) { |n| "Item_#{n}"}

  factory :item_with_keywords do
    ignore do
      keywords_count 1
      nmc 0
    end
    after(:create) do |item, evaluator|
      create_list(:keyword, evaluator.keywords_count, {item: item, nmc: evaluator.nmc})
    end
  end
end

factory :keyword do
    sequence(:name) { |n| "Keyword_#{n}"}
  end
</code></pre></div></div>

<p>factory 생성시에 strong parameter와 같이 nested attributes를 함께 <code class="highlighter-rouge">create</code> method에 넘겨준다.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>item = create(:item, keywords_attributes: [attributes_for(:keyword)] )

post :create, item: attributes_for(:item, keywords_attributes: [attributes_for(:keyword)]))
</code></pre></div></div>

<p><br /></p>

<h3 id="faker-gem">Faker Gem</h3>

<p><a href="https://github.com/stympy/faker">faker</a> 를 이용하면 이름/이메일/주소 등 실제 데이터같은 샘플 데이터를 얻을 수 있다.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code># Gemfile
group :development, :test do
  gem 'faker', '~&gt; 1.4.3'
end

# spec/factories.rb
factory :user do
  name Faker::Name.name
end
</code></pre></div></div>

<h3 id="내가-겪은-trouble">내가 겪은 Trouble</h3>

<p><code class="highlighter-rouge">has_secure_password</code> 를 사용했을 때, factory_girl로 만든 <code class="highlighter-rouge">user</code>로 login하는데 문제가 있었다. 원인은 아직모르겠으나, factory를 사용하지 않고, ActiveRecord를 직접 생성하는 것으로 우회했다.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code># Not working
factory :user do
  factory :admin do
  end
end

# Workaround
factory :user do
end

factory :admin, class: User do
end
</code></pre></div></div>

<p><br /></p>

<hr />

<p><a href="https://github.com/thoughtbot/factory_girl/blob/master/GETTING_STARTED.md#defining-factories">Model과 다른 이름의 factory 만드는 guide</a>
<a href="http://ricostacruz.com/cheatsheets/factory_girl.html">FactoryGirl Cheat Sheet</a></p>

 -->
      </div>
    
  
    <div class="category">
      <a href="#ux">UX (1)</a>
    </div>
    
      <div class="post">
        <h4 class="post-title">
          <a href="/dev/ux/2017/03/31/gmail-touch-region/">
            Gmail Touch region 구현
          </a>
        </h4>
        <div class="post-description">
          <small><span class="post-date">31 Mar 2017</span></small>
        </div>
        <!-- <p><img src="https://scontent-icn1-1.xx.fbcdn.net/v/t1.0-9/17553501_10158514881355327_4577364518862071458_n.jpg?oh=4d3823b9caed401fb6c309ef86199598&amp;oe=59535369" alt="gmail-touch-region" />
padding으로 size를 잡고
negative margin으로 layout을 수정함</p>
 -->
      </div>
    
  
    <div class="category">
      <a href="#vscode">VSCODE (1)</a>
    </div>
    
      <div class="post">
        <h4 class="post-title">
          <a href="/dev/react/eslint/vscode/2019/05/09/eslint-setup/">
            React + ESLint + VSCode
          </a>
        </h4>
        <div class="post-description">
          <small><span class="post-date">09 May 2019</span></small>
        </div>
        <!-- <h2 id="vscode-eslint-설치">VSCode eslint 설치</h2>

<ul>
  <li>command + shift + p</li>
  <li>Install Extensions</li>
  <li>Search ‘ESLint’</li>
  <li>Click Install</li>
</ul>

<h2 id="저장시-eslint-자동-고침-설정">저장시 eslint 자동 고침 설정</h2>

<ul>
  <li>command + ,</li>
  <li>Search ‘ESLint’</li>
  <li>Turn on auto fix on save</li>
</ul>

<h2 id="eslint-config-airbnb-적용">eslint-config-airbnb 적용</h2>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>// Package 확인
npm info "eslint-config-airbnb@latest" peerDependencies
// with CRA v2.0
npm install eslint-config-airbnb --save
// without CRA
npx install-peerdeps --dev eslint-config-airbnb
</code></pre></div></div>

<h2 id="eslint-config-prettier-적용">eslint-config-prettier 적용</h2>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>npm install eslint-config-prettier --save
</code></pre></div></div>

<p><code class="highlighter-rouge">.eslintrc</code></p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  extends: [
    prettier
  ]
</code></pre></div></div>

<h2 id="eslint-config">eslint config</h2>

<p><code class="highlighter-rouge">.eslintrc</code> 파일 생성</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>module.exports = {
  env: {
    browser: true,
    es6: true,
    jest: true
  },
  extends: [
    "eslint:recommended",
    "plugin:react/recommended",
    "airbnb",
    "prettier",
    "prettier/babel",
    "prettier/react",
    "prettier/standard",
    "prettier/unicorn",
    "prettier/vue"
  ],
  globals: {
    Atomics: "readonly",
    SharedArrayBuffer: "readonly"
  },
  parser: "babel-eslint",
  parserOptions: {
    ecmaFeatures: {
      jsx: true
    },
    ecmaVersion: 2018,
    sourceType: "module"
  },
  plugins: ["react"],
  rules: {
    "react/prefer-stateless-function": 0,
    "import/no-named-as-default": 0,
    "react/jsx-filename-extension": 0,
    "import/no-extraneous-dependencies": [2, { devDependencies: true }]
  }
};

</code></pre></div></div>

<h2 id="특정-lint-rule-제거하기">특정 lint rule 제거하기</h2>

<p><code class="highlighter-rouge">.eslintrc</code></p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code> rules: {
    "react/prefer-stateless-function": 0,
 }
</code></pre></div></div>

<h2 id="dev-save-module-이-project-외부에-있다고-나올-때">dev save module 이 project 외부에 있다고 나올 때</h2>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  rules: {
    "import/no-extraneous-dependencies": [2, { devDependencies: true }]
  }
</code></pre></div></div>

<h2 id="jest-사용시-it-이-undefined-로-나올-때">Jest 사용시, ‘it’ 이 undefined 로 나올 때</h2>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  env: {
    jest: true
  },
</code></pre></div></div>

<h2 id="document-undefined">document undefined</h2>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  env: {
    browser: true
  }
</code></pre></div></div>

<hr />

<p>credit : <a href="https://velog.io/@velopert/eslint-and-prettier-in-react">Velopert-리액트 프로젝트에 ESLint 와 Prettier 끼얹기</a></p>
 -->
      </div>
    
  
    <div class="category">
      <a href="#web">WEB (1)</a>
    </div>
    
      <div class="post">
        <h4 class="post-title">
          <a href="/dev/web/2016/07/29/chrome-video-tag/">
            Chrome에서 video tag 사용
          </a>
        </h4>
        <div class="post-description">
          <small><span class="post-date">29 Jul 2016</span></small>
        </div>
        <!-- <p>Chrome limits the number of videos/audio files to 4 or 6 (I can’t remember which) so, as brianchirls mentions, you need to set the preload attribute, although you need to set it to none.</p>

<p>My recommendation is to provide a poster image (via the poster attribute) for all your videos and to set preload=”none” to all of them. That way the browser only actually tries to load them if the user actively clicks the play button.</p>

<p>Alternatively you could set the first 4/6 videos with preload=”metadata” and the rest to preload=”none”.</p>
 -->
      </div>
    
  
  </div>





<!--   <div class="category-posts-container">
    
    <div class="category-posts">
      <h2 id="aws">aws</h2>
      <ul>
        
          <a href="/dev/aws/2018/05/27/copy-aws-rds-pg-to-local/" class="category-post">
            <li>
              AWS RDS를 로컬에 복사하기
              <small>27 May 2018</small>
            </li></a>
        
      </ul>
    </div>
    
    <div class="category-posts">
      <h2 id="bootstrap">bootstrap</h2>
      <ul>
        
          <a href="/dev/rails/bootstrap/2016/08/21/initial-settings-rails-bootstrap/" class="category-post">
            <li>
              Rails(레일즈) bootstrap 세팅.
              <small>21 Aug 2016</small>
            </li></a>
        
          <a href="/dev/bootstrap/2016/07/24/bootrap-collapse/" class="category-post">
            <li>
              Bootstrap collapse의 event handler 사용하기
              <small>24 Jul 2016</small>
            </li></a>
        
      </ul>
    </div>
    
    <div class="category-posts">
      <h2 id="css">css</h2>
      <ul>
        
          <a href="/dev/css/2016/11/03/remove-webkit-padding-start/" class="category-post">
            <li>
              webkit-pading-start 제거하기
              <small>03 Nov 2016</small>
            </li></a>
        
      </ul>
    </div>
    
    <div class="category-posts">
      <h2 id="eslint">eslint</h2>
      <ul>
        
          <a href="/dev/react/eslint/vscode/2019/05/09/eslint-setup/" class="category-post">
            <li>
              React + ESLint + VSCode
              <small>09 May 2019</small>
            </li></a>
        
      </ul>
    </div>
    
    <div class="category-posts">
      <h2 id="git">git</h2>
      <ul>
        
          <a href="/dev/git/2017/01/18/git-pull-remote-branch/" class="category-post">
            <li>
              Git - Remote branch로 local branch 만들기
              <small>18 Jan 2017</small>
            </li></a>
        
          <a href="/dev/git/2016/12/23/git-merge-vs-rebase/" class="category-post">
            <li>
              Git - merge vs. rebase
              <small>23 Dec 2016</small>
            </li></a>
        
          <a href="/dev/git/2016/08/19/git-remove-staging-files/" class="category-post">
            <li>
              git local strorage에 staging 파일을 제거.
              <small>19 Aug 2016</small>
            </li></a>
        
      </ul>
    </div>
    
    <div class="category-posts">
      <h2 id="google analytics">google analytics</h2>
      <ul>
        
          <a href="/dev/google%20analytics/2016/12/19/prevent-ghost-spam-in-google-analytics/" class="category-post">
            <li>
              .xyz 때문에 짜증이 나신다면 - GA에서 스팸제거하기
              <small>19 Dec 2016</small>
            </li></a>
        
          <a href="/dev/rails/google%20analytics/2016/09/09/turbolinks-google-analytics/" class="category-post">
            <li>
              Turbolinks & Google analytics
              <small>09 Sep 2016</small>
            </li></a>
        
      </ul>
    </div>
    
    <div class="category-posts">
      <h2 id="google sheet">google sheet</h2>
      <ul>
        
          <a href="/dev/google%20sheet/2016/12/14/google-sheet-return-blank-cell/" class="category-post">
            <li>
              Google Sheet - 함수에서 blank cell 반환하기
              <small>14 Dec 2016</small>
            </li></a>
        
      </ul>
    </div>
    
    <div class="category-posts">
      <h2 id="google-chart">google-chart</h2>
      <ul>
        
          <a href="/dev/google-chart/2018/05/06/google-chart/" class="category-post">
            <li>
              Google Chart 로 그래프 그리기
              <small>06 May 2018</small>
            </li></a>
        
      </ul>
    </div>
    
    <div class="category-posts">
      <h2 id="heroku">heroku</h2>
      <ul>
        
          <a href="/dev/heroku/2017/03/02/heroku-no-app-option/" class="category-post">
            <li>
              Heroku - app option을 사용하라고 error 발생시
              <small>02 Mar 2017</small>
            </li></a>
        
          <a href="/dev/rails/heroku/2017/03/01/heroku-rails-migration-when-release/" class="category-post">
            <li>
              Heroku - Deploy시에 자동으로 migration 하기
              <small>01 Mar 2017</small>
            </li></a>
        
          <a href="/dev/heroku/2017/02/13/heroku-ssl-lets-encrypted/" class="category-post">
            <li>
              Heroku SSL 적용 - Let's encrypt CA
              <small>13 Feb 2017</small>
            </li></a>
        
          <a href="/dev/heroku/2017/01/11/heroku-database-upgrade/" class="category-post">
            <li>
              Heroku database 업그레이드
              <small>11 Jan 2017</small>
            </li></a>
        
          <a href="/dev/heroku/2017/01/05/heroku-restart/" class="category-post">
            <li>
              Heroku 서버 재시작
              <small>05 Jan 2017</small>
            </li></a>
        
          <a href="/dev/heroku/2016/11/30/set-timezone-on-heroku/" class="category-post">
            <li>
              Heroku에서 Timezone 설정하기
              <small>30 Nov 2016</small>
            </li></a>
        
          <a href="/dev/heroku/2016/10/28/godaddy-heroku-dns-forwarding/" class="category-post">
            <li>
              Godaddy에서 Heroku로 DNS 설정하기
              <small>28 Oct 2016</small>
            </li></a>
        
          <a href="/dev/rails/heroku/2016/09/21/Heroku-database-dump-out/" class="category-post">
            <li>
              Heroku database로 local database 세팅하기
              <small>21 Sep 2016</small>
            </li></a>
        
          <a href="/dev/heroku/2016/07/25/Heroku-multi-build-packs/" class="category-post">
            <li>
              Heroku에 ffmpeg 설치하기 (Multi buildpack 사용하기)
              <small>25 Jul 2016</small>
            </li></a>
        
      </ul>
    </div>
    
    <div class="category-posts">
      <h2 id="html">html</h2>
      <ul>
        
          <a href="/dev/html/2016/07/19/set-viewport/" class="category-post">
            <li>
              모바일 Layout - View port
              <small>19 Jul 2016</small>
            </li></a>
        
      </ul>
    </div>
    
    <div class="category-posts">
      <h2 id="javascript">javascript</h2>
      <ul>
        
          <a href="/dev/react/javascript/2019/05/28/manage-constants-in-javascript/" class="category-post">
            <li>
              Javascript에서 constants 관리하기
              <small>28 May 2019</small>
            </li></a>
        
          <a href="/dev/javascript/2017/04/14/javascript-namespace/" class="category-post">
            <li>
              Javascript - Namespace 사용하기
              <small>14 Apr 2017</small>
            </li></a>
        
          <a href="/dev/javascript/2016/12/23/check-undefined/" class="category-post">
            <li>
              Javascript 'undefined' 체크
              <small>23 Dec 2016</small>
            </li></a>
        
          <a href="/dev/javascript/2016/12/09/javascript-encoding/" class="category-post">
            <li>
              Javascript Unicdoe/UTF-8 인코딩
              <small>09 Dec 2016</small>
            </li></a>
        
      </ul>
    </div>
    
    <div class="category-posts">
      <h2 id="jekyll">jekyll</h2>
      <ul>
        
          <a href="/dev/jekyll/2017/02/14/jekyll-search/" class="category-post">
            <li>
              Jekyll에 Search 기능 넣기 Lunrjs
              <small>14 Feb 2017</small>
            </li></a>
        
          <a href="/dev/jekyll/markdown/2017/01/14/newline-markdown/" class="category-post">
            <li>
              markdown에서 한줄 띄어쓰기
              <small>14 Jan 2017</small>
            </li></a>
        
          <a href="/dev/jekyll/2016/11/30/jekyll-post-url/" class="category-post">
            <li>
              Jekyll에서 다른 post 링크를 넣는 방법
              <small>30 Nov 2016</small>
            </li></a>
        
          <a href="/dev/jekyll/2016/11/30/jekyll-forloop-index/" class="category-post">
            <li>
              Jekyll에서 forloop index 알아내기
              <small>30 Nov 2016</small>
            </li></a>
        
          <a href="/dev/jekyll/seo/2016/11/13/jekyll-sitemap/" class="category-post">
            <li>
              Jekyll 이용한 Gibhub pag에서 sitemap 생성
              <small>13 Nov 2016</small>
            </li></a>
        
          <a href="/dev/jekyll/2016/11/13/jekyll-disqus/" class="category-post">
            <li>
              Jekyll에 disqus 추가하기
              <small>13 Nov 2016</small>
            </li></a>
        
          <a href="/dev/jekyll/2016/09/10/Jekyll-tag-never-closed/" class="category-post">
            <li>
              Liquid syntax error - 'highlight' tag was never closed
              <small>10 Sep 2016</small>
            </li></a>
        
          <a href="/dev/jekyll/2016/08/14/jekyll-sub-category/" class="category-post">
            <li>
              Jekyll - category array를 sub-category처럼 사용하기
              <small>14 Aug 2016</small>
            </li></a>
        
      </ul>
    </div>
    
    <div class="category-posts">
      <h2 id="jquery">jquery</h2>
      <ul>
        
          <a href="/dev/jquery/2017/02/16/jquery-event/" class="category-post">
            <li>
              JQuery Event
              <small>16 Feb 2017</small>
            </li></a>
        
      </ul>
    </div>
    
    <div class="category-posts">
      <h2 id="markdown">markdown</h2>
      <ul>
        
          <a href="/dev/jekyll/markdown/2017/01/14/newline-markdown/" class="category-post">
            <li>
              markdown에서 한줄 띄어쓰기
              <small>14 Jan 2017</small>
            </li></a>
        
      </ul>
    </div>
    
    <div class="category-posts">
      <h2 id="pg">pg</h2>
      <ul>
        
          <a href="/dev/rails/pg/2016/12/14/postgresql-korean-sort/" class="category-post">
            <li>
              Postgresql 한글 정렬
              <small>14 Dec 2016</small>
            </li></a>
        
      </ul>
    </div>
    
    <div class="category-posts">
      <h2 id="rails">rails</h2>
      <ul>
        
          <a href="/dev/rails/2018/05/28/rails-habtm-different-table-name/" class="category-post">
            <li>
              Rails HABTM convention과 다른 table을 이용하기
              <small>28 May 2018</small>
            </li></a>
        
          <a href="/dev/rails/2018/05/27/rails-dev-env/" class="category-post">
            <li>
              Rails 개발환경 설정 하기
              <small>27 May 2018</small>
            </li></a>
        
          <a href="/dev/rails/2017/04/07/rails-permanent-login/" class="category-post">
            <li>
              Rails - 로그인 유지하기
              <small>07 Apr 2017</small>
            </li></a>
        
          <a href="/dev/rails/2017/03/27/rails-controller-name-in-view/" class="category-post">
            <li>
              Rails - View에서 현재 controller 이름 사용하기
              <small>27 Mar 2017</small>
            </li></a>
        
          <a href="/dev/rails/2017/03/27/rails-bug-current-page-no-route/" class="category-post">
            <li>
              Rails bug - current_page? No route matches
              <small>27 Mar 2017</small>
            </li></a>
        
          <a href="/dev/rails/2017/03/03/rails-habtm/" class="category-post">
            <li>
              Rails - has_and_belongs_to_many
              <small>03 Mar 2017</small>
            </li></a>
        
          <a href="/dev/rails/heroku/2017/03/01/heroku-rails-migration-when-release/" class="category-post">
            <li>
              Heroku - Deploy시에 자동으로 migration 하기
              <small>01 Mar 2017</small>
            </li></a>
        
          <a href="/dev/rails/2017/02/28/how-to-disable-ssl-and-rails-force-ssl/" class="category-post">
            <li>
              Rails - SSL 제거시 발생한 문제 (config.force_ssl의 비밀)
              <small>28 Feb 2017</small>
            </li></a>
        
          <a href="/dev/rails/2017/02/27/rails-datatable-pagination/" class="category-post">
            <li>
              Rails - jQuery DataTable pagination
              <small>27 Feb 2017</small>
            </li></a>
        
          <a href="/dev/rails/2017/02/22/rails-libreadline-error/" class="category-post">
            <li>
              Rails - libreadline 에러 해결하기
              <small>22 Feb 2017</small>
            </li></a>
        
          <a href="/dev/rails/2017/02/13/rails-cache-per-user-role/" class="category-post">
            <li>
              Rails - 유저 role 별로 cache 사용
              <small>13 Feb 2017</small>
            </li></a>
        
          <a href="/dev/rails/2017/02/09/omniauth-facebook/" class="category-post">
            <li>
              Omniauth Facebook
              <small>09 Feb 2017</small>
            </li></a>
        
          <a href="/dev/rails/2017/02/06/ngrok-test-local-app-in-mobile/" class="category-post">
            <li>
              Mobile에서 localhost 테스트하기
              <small>06 Feb 2017</small>
            </li></a>
        
          <a href="/dev/rails/ruby/2017/01/20/irb-encoding/" class="category-post">
            <li>
              irb, rails console에서의 한글 encoding 문제 해결
              <small>20 Jan 2017</small>
            </li></a>
        
          <a href="/dev/rails/2016/12/31/rails-preload-nested-association/" class="category-post">
            <li>
              Preload/Eagerload Nest Association
              <small>31 Dec 2016</small>
            </li></a>
        
          <a href="/dev/rails/2016/12/31/jquery-append-prepend-after-before/" class="category-post">
            <li>
              jQuery Dom붙이기 한 방에 이해!! - append, prepend, after, before
              <small>31 Dec 2016</small>
            </li></a>
        
          <a href="/dev/rails/pg/2016/12/14/postgresql-korean-sort/" class="category-post">
            <li>
              Postgresql 한글 정렬
              <small>14 Dec 2016</small>
            </li></a>
        
          <a href="/dev/rails/test/rspec/2016/12/06/rspec-controller/" class="category-post">
            <li>
              Rails Controller Test with Rspec
              <small>06 Dec 2016</small>
            </li></a>
        
          <a href="/dev/rails/2016/12/02/vcr-webmocking/" class="category-post">
            <li>
              VCR - 빠른 3rd party API 테스트
              <small>02 Dec 2016</small>
            </li></a>
        
          <a href="/dev/rails/test/2016/11/30/railscast-how-to-test/" class="category-post">
            <li>
              Integration test or Unit test
              <small>30 Nov 2016</small>
            </li></a>
        
          <a href="/dev/rails/test/2016/11/30/rails-test-toc/" class="category-post">
            <li>
              Rails Test 0 Table of Contents
              <small>30 Nov 2016</small>
            </li></a>
        
          <a href="/dev/rails/test/2016/11/30/rails-test-model/" class="category-post">
            <li>
              Rails Test 1 Model
              <small>30 Nov 2016</small>
            </li></a>
        
          <a href="/dev/rails/test/2016/11/30/factory_girl/" class="category-post">
            <li>
              Gem - Factory_girl
              <small>30 Nov 2016</small>
            </li></a>
        
          <a href="/dev/rails/2016/11/28/nokogiri/" class="category-post">
            <li>
              Gem Nokogiri - 웹페이지 크롤링
              <small>28 Nov 2016</small>
            </li></a>
        
          <a href="/dev/rails/2016/11/13/rails-new-line-in-text-area-input/" class="category-post">
            <li>
              Rails - text-area 줄바꿈 입력값 보여주기
              <small>13 Nov 2016</small>
            </li></a>
        
          <a href="/dev/rails/2016/11/12/rails-truncate/" class="category-post">
            <li>
              Rails - 20자 이상 자르고 말줄임표 붙이기
              <small>12 Nov 2016</small>
            </li></a>
        
          <a href="/dev/rails/2016/11/12/rails-fast-asset-pipelie-with-sassc/" class="category-post">
            <li>
              Rails - dev 모드에서 sass 컴파일 속도 높이기
              <small>12 Nov 2016</small>
            </li></a>
        
          <a href="/dev/rails/2016/11/11/rails-gem-ratyrate/" class="category-post">
            <li>
              별점넣기 - Rails Gem Ratyrate
              <small>11 Nov 2016</small>
            </li></a>
        
          <a href="/dev/rails/2016/11/08/gem-act-as-votable/" class="category-post">
            <li>
              좋아요/싫어요 투표 기능 gem - acts_as_votable
              <small>08 Nov 2016</small>
            </li></a>
        
          <a href="/dev/rails/2016/11/07/gem-act-as-commentable-with-threading/" class="category-post">
            <li>
              대댓글 기능 gem - act_as_commentable_with_threading
              <small>07 Nov 2016</small>
            </li></a>
        
          <a href="/dev/rails/2016/10/23/el-capitan-sourcetree-command-line-tool/" class="category-post">
            <li>
              Mac OS X 10.11(El capitan)에서 SourceTree CLT 설치 실패시
              <small>23 Oct 2016</small>
            </li></a>
        
          <a href="/dev/rails/2016/10/21/rails4-pg-string-array-form/" class="category-post">
            <li>
              Rails4에서 PG String Array type 사용하기
              <small>21 Oct 2016</small>
            </li></a>
        
          <a href="/dev/rails/2016/10/21/rails-turbolink-instagram-embed/" class="category-post">
            <li>
              Turbolink - 인스타그램 embed가 load되지 않을 때
              <small>21 Oct 2016</small>
            </li></a>
        
          <a href="/dev/rails/2016/10/07/sitemap/" class="category-post">
            <li>
              Sitemap
              <small>07 Oct 2016</small>
            </li></a>
        
          <a href="/dev/rails/sql/2016/09/28/duplicated-records-of-sql-when-using-limit-and-offset/" class="category-post">
            <li>
              Pagination - 다른 페이지에 같은 record가 나오는 문제
              <small>28 Sep 2016</small>
            </li></a>
        
          <a href="/dev/rails/2016/09/27/kakao-sdk-with-turbolink/" class="category-post">
            <li>
              Turbolinks - Kakao sdk
              <small>27 Sep 2016</small>
            </li></a>
        
          <a href="/dev/rails/2016/09/23/omniauth/" class="category-post">
            <li>
              Omniauth
              <small>23 Sep 2016</small>
            </li></a>
        
          <a href="/dev/ruby/rails/2016/09/22/call-methods-only-if-exists/" class="category-post">
            <li>
              tip - nil이 아닌경우에 method를 실행
              <small>22 Sep 2016</small>
            </li></a>
        
          <a href="/dev/rails/heroku/2016/09/21/Heroku-database-dump-out/" class="category-post">
            <li>
              Heroku database로 local database 세팅하기
              <small>21 Sep 2016</small>
            </li></a>
        
          <a href="/dev/rails/2016/09/17/rails-set-development-database-as-postgresql/" class="category-post">
            <li>
              Development DB를 Postresql로 세팅
              <small>17 Sep 2016</small>
            </li></a>
        
          <a href="/dev/rails/2016/09/13/Rails4-nested-form/" class="category-post">
            <li>
              Rails4 - nested form
              <small>13 Sep 2016</small>
            </li></a>
        
          <a href="/dev/rails/2016/09/10/user-login/" class="category-post">
            <li>
              Rails4 User Login - 처음부터
              <small>10 Sep 2016</small>
            </li></a>
        
          <a href="/dev/rails/google%20analytics/2016/09/09/turbolinks-google-analytics/" class="category-post">
            <li>
              Turbolinks & Google analytics
              <small>09 Sep 2016</small>
            </li></a>
        
          <a href="/dev/rails/2016/08/28/turbolinks-load-event/" class="category-post">
            <li>
              document ready & Turbolinks
              <small>28 Aug 2016</small>
            </li></a>
        
          <a href="/dev/rails/2016/08/25/rails-active-model-serializer/" class="category-post">
            <li>
              Tips - Rails(레일즈) active model serializer
              <small>25 Aug 2016</small>
            </li></a>
        
          <a href="/dev/rails/bootstrap/2016/08/21/initial-settings-rails-bootstrap/" class="category-post">
            <li>
              Rails(레일즈) bootstrap 세팅.
              <small>21 Aug 2016</small>
            </li></a>
        
          <a href="/dev/rails/2016/08/20/rails-scope/" class="category-post">
            <li>
              Rails(레일즈) scope
              <small>20 Aug 2016</small>
            </li></a>
        
          <a href="/dev/rails/2016/08/20/rails-guard/" class="category-post">
            <li>
              테스트 자동화 - guard
              <small>20 Aug 2016</small>
            </li></a>
        
          <a href="/dev/rails/2016/08/19/nil-empty-blank-present/" class="category-post">
            <li>
              nil?, empty?, blank? 그리고 present?
              <small>19 Aug 2016</small>
            </li></a>
        
          <a href="/dev/rails/2016/08/19/import-css-in-scss/" class="category-post">
            <li>
              Sass 파일에서 css 파일 import
              <small>19 Aug 2016</small>
            </li></a>
        
          <a href="/dev/rails/2016/08/13/integration-test/" class="category-post">
            <li>
              Rails Integration Test
              <small>13 Aug 2016</small>
            </li></a>
        
          <a href="/dev/rails/2016/08/13/fast-test-with-guard-and-zeus/" class="category-post">
            <li>
              빠른 테스트 - Guard & Zeus
              <small>13 Aug 2016</small>
            </li></a>
        
          <a href="/dev/rails/2016/08/11/naver-searchad-api-ruby/" class="category-post">
            <li>
              Ruby - Naver 검색광고 API
              <small>11 Aug 2016</small>
            </li></a>
        
          <a href="/dev/rails/2016/07/29/carrierwave-video-thumbnailer/" class="category-post">
            <li>
              Carrierwave video thumbnailer
              <small>29 Jul 2016</small>
            </li></a>
        
          <a href="/dev/rails/2016/07/21/repopulate-non-model-form-field/" class="category-post">
            <li>
              model이 없는 form의 입력을 validation 이후에도 유지하기.
              <small>21 Jul 2016</small>
            </li></a>
        
          <a href="/dev/rails/2016/07/18/rotate-image/" class="category-post">
            <li>
              EXIF 옵션에 따라 이미지 회전시키기
              <small>18 Jul 2016</small>
            </li></a>
        
      </ul>
    </div>
    
    <div class="category-posts">
      <h2 id="react">react</h2>
      <ul>
        
          <a href="/dev/react/javascript/2019/05/28/manage-constants-in-javascript/" class="category-post">
            <li>
              Javascript에서 constants 관리하기
              <small>28 May 2019</small>
            </li></a>
        
          <a href="/dev/react/eslint/vscode/2019/05/09/eslint-setup/" class="category-post">
            <li>
              React + ESLint + VSCode
              <small>09 May 2019</small>
            </li></a>
        
      </ul>
    </div>
    
    <div class="category-posts">
      <h2 id="rspec">rspec</h2>
      <ul>
        
          <a href="/dev/rspec/2017/01/14/render-parital-rspec/" class="category-post">
            <li>
              Rspec - partial rendering 테스트 하기
              <small>14 Jan 2017</small>
            </li></a>
        
          <a href="/dev/rspec/2016/12/10/rspec-selective-test/" class="category-post">
            <li>
              Rspec - 원하는 테스트만 실행하기
              <small>10 Dec 2016</small>
            </li></a>
        
          <a href="/dev/rspec/2016/12/10/rspec-mock-referrer/" class="category-post">
            <li>
              Rspec 에서 referrer 설정하기
              <small>10 Dec 2016</small>
            </li></a>
        
          <a href="/dev/rails/test/rspec/2016/12/06/rspec-controller/" class="category-post">
            <li>
              Rails Controller Test with Rspec
              <small>06 Dec 2016</small>
            </li></a>
        
      </ul>
    </div>
    
    <div class="category-posts">
      <h2 id="ruby">ruby</h2>
      <ul>
        
          <a href="/dev/rails/ruby/2017/01/20/irb-encoding/" class="category-post">
            <li>
              irb, rails console에서의 한글 encoding 문제 해결
              <small>20 Jan 2017</small>
            </li></a>
        
          <a href="/dev/ruby/2017/01/20/install-rbenv/" class="category-post">
            <li>
              루비 버전 관리 - rbenv Mac 설치
              <small>20 Jan 2017</small>
            </li></a>
        
          <a href="/dev/ruby/2017/01/13/ruby-sort/" class="category-post">
            <li>
              Ruby Sorting - nil값이 있는 경우
              <small>13 Jan 2017</small>
            </li></a>
        
          <a href="/dev/ruby/2017/01/05/ruby-regex/" class="category-post">
            <li>
              Ruby Regex
              <small>05 Jan 2017</small>
            </li></a>
        
          <a href="/dev/ruby/rails/2016/09/22/call-methods-only-if-exists/" class="category-post">
            <li>
              tip - nil이 아닌경우에 method를 실행
              <small>22 Sep 2016</small>
            </li></a>
        
      </ul>
    </div>
    
    <div class="category-posts">
      <h2 id="seo">seo</h2>
      <ul>
        
          <a href="/dev/jekyll/seo/2016/11/13/jekyll-sitemap/" class="category-post">
            <li>
              Jekyll 이용한 Gibhub pag에서 sitemap 생성
              <small>13 Nov 2016</small>
            </li></a>
        
      </ul>
    </div>
    
    <div class="category-posts">
      <h2 id="sql">sql</h2>
      <ul>
        
          <a href="/dev/rails/sql/2016/09/28/duplicated-records-of-sql-when-using-limit-and-offset/" class="category-post">
            <li>
              Pagination - 다른 페이지에 같은 record가 나오는 문제
              <small>28 Sep 2016</small>
            </li></a>
        
      </ul>
    </div>
    
    <div class="category-posts">
      <h2 id="sublimetext">sublimetext</h2>
      <ul>
        
          <a href="/dev/sublimetext/2016/10/25/sublimetext3-edit-multiple-lines/" class="category-post">
            <li>
              SublimeText3 - 여러 줄 한번에 수정하기
              <small>25 Oct 2016</small>
            </li></a>
        
          <a href="/dev/sublimetext/2016/09/10/my-sublime-package-usges/" class="category-post">
            <li>
              Sublime Package
              <small>10 Sep 2016</small>
            </li></a>
        
      </ul>
    </div>
    
    <div class="category-posts">
      <h2 id="test">test</h2>
      <ul>
        
          <a href="/dev/rails/test/rspec/2016/12/06/rspec-controller/" class="category-post">
            <li>
              Rails Controller Test with Rspec
              <small>06 Dec 2016</small>
            </li></a>
        
          <a href="/dev/rails/test/2016/11/30/railscast-how-to-test/" class="category-post">
            <li>
              Integration test or Unit test
              <small>30 Nov 2016</small>
            </li></a>
        
          <a href="/dev/rails/test/2016/11/30/rails-test-toc/" class="category-post">
            <li>
              Rails Test 0 Table of Contents
              <small>30 Nov 2016</small>
            </li></a>
        
          <a href="/dev/rails/test/2016/11/30/rails-test-model/" class="category-post">
            <li>
              Rails Test 1 Model
              <small>30 Nov 2016</small>
            </li></a>
        
          <a href="/dev/rails/test/2016/11/30/factory_girl/" class="category-post">
            <li>
              Gem - Factory_girl
              <small>30 Nov 2016</small>
            </li></a>
        
      </ul>
    </div>
    
    <div class="category-posts">
      <h2 id="ux">ux</h2>
      <ul>
        
          <a href="/dev/ux/2017/03/31/gmail-touch-region/" class="category-post">
            <li>
              Gmail Touch region 구현
              <small>31 Mar 2017</small>
            </li></a>
        
      </ul>
    </div>
    
    <div class="category-posts">
      <h2 id="vscode">vscode</h2>
      <ul>
        
          <a href="/dev/react/eslint/vscode/2019/05/09/eslint-setup/" class="category-post">
            <li>
              React + ESLint + VSCode
              <small>09 May 2019</small>
            </li></a>
        
      </ul>
    </div>
    
    <div class="category-posts">
      <h2 id="web">web</h2>
      <ul>
        
          <a href="/dev/web/2016/07/29/chrome-video-tag/" class="category-post">
            <li>
              Chrome에서 video tag 사용
              <small>29 Jul 2016</small>
            </li></a>
        
      </ul>
    </div>
    
  </div> -->

      </div>
    </div>
  </body>
</html>
